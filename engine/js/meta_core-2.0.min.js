/*!
 * Start Bootstrap - Clean Blog v5.0.5 (https://startbootstrap.com/template-overviews/clean-blog)
 * Copyright 2013-2019 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap-clean-blog/blob/master/LICENSE)
 */

var COMPILED=!1,goog=goog||{};goog.global=this,goog.DEBUG=!0,goog.LOCALE="en",goog.TRUSTED_SITE=!0,goog.provide=function(e){if(!COMPILED){if(goog.isProvided_(e))throw Error('Namespace "'+e+'" already declared.');delete goog.implicitNamespaces_[e];for(var t=e;(t=t.substring(0,t.lastIndexOf(".")))&&!goog.getObjectByName(t);)goog.implicitNamespaces_[t]=!0}goog.exportPath_(e)},goog.setTestOnly=function(e){if(COMPILED&&!goog.DEBUG)throw e=e||"",Error(": "+e)},COMPILED||(goog.isProvided_=function(e){return!goog.implicitNamespaces_[e]&&!!goog.getObjectByName(e)},goog.implicitNamespaces_={}),goog.exportPath_=function(e,t,o){var r,n=e.split("."),s=o||goog.global;n[0]in s||!s.execScript||s.execScript("var "+n[0]);for(;n.length&&(r=n.shift());)!n.length&&goog.isDef(t)?s[r]=t:s=s[r]?s[r]:s[r]={}},goog.getObjectByName=function(e,t){for(var o,r=e.split("."),n=t||goog.global;o=r.shift();){if(!goog.isDefAndNotNull(n[o]))return null;n=n[o]}return n},goog.globalize=function(e,t){var o=t||goog.global;for(var r in e)o[r]=e[r]},goog.addDependency=function(e,t,o){if(!COMPILED){for(var r,n,s=e.replace(/\\/g,"/"),i=goog.dependencies_,a=0;r=t[a];a++)i.nameToPath[r]=s,s in i.pathToNames||(i.pathToNames[s]={}),i.pathToNames[s][r]=!0;for(var l=0;n=o[l];l++)s in i.requires||(i.requires[s]={}),i.requires[s][n]=!0}},goog.ENABLE_DEBUG_LOADER=!0,goog.require=function(e){if(!COMPILED){if(goog.isProvided_(e))return;if(goog.ENABLE_DEBUG_LOADER){var t=goog.getPathFromDeps_(e);if(t)return goog.included_[t]=!0,void goog.writeScripts_()}var o="goog.require could not find: "+e;throw goog.global.console&&goog.global.console.error(o),Error(o)}},goog.basePath="",goog.global.CLOSURE_BASE_PATH,goog.global.CLOSURE_NO_DEPS,goog.global.CLOSURE_IMPORT_SCRIPT,goog.nullFunction=function(){},goog.identityFunction=function(e,t){return e},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(e){e.getInstance=function(){return e.instance_?e.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=e),e.instance_=new e)}},goog.instantiatedSingletons_=[],!COMPILED&&goog.ENABLE_DEBUG_LOADER&&(goog.included_={},goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var e=goog.global.document;return void 0!==e&&"write"in e},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var e=goog.global.document.getElementsByTagName("script"),t=e.length-1;t>=0;--t){var o=e[t].src,r=o.lastIndexOf("?"),n=-1==r?o.length:r;if("base.js"==o.substr(n-7,7))return void(goog.basePath=o.substr(0,n-7))}},goog.importScript_=function(e){var t=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;!goog.dependencies_.written[e]&&t(e)&&(goog.dependencies_.written[e]=!0)},goog.writeScriptTag_=function(e){if(goog.inHtmlDocument_()){var t=goog.global.document;if("complete"==t.readyState){if(/\bdeps.js$/.test(e))return!1;throw Error('Cannot write "'+e+'" after document load')}return t.write('<script type="text/javascript" src="'+e+'"><\/script>'),!0}return!1},goog.writeScripts_=function(){var e=[],t={},o=goog.dependencies_;function r(n){if(!(n in o.written))if(n in o.visited)n in t||(t[n]=!0,e.push(n));else{if(o.visited[n]=!0,n in o.requires)for(var s in o.requires[n])if(!goog.isProvided_(s)){if(!(s in o.nameToPath))throw Error("Undefined nameToPath for "+s);r(o.nameToPath[s])}n in t||(t[n]=!0,e.push(n))}}for(var n in goog.included_)o.written[n]||r(n);for(var s=0;s<e.length;s++){if(!e[s])throw Error("Undefined script input");goog.importScript_(goog.basePath+e[s])}},goog.getPathFromDeps_=function(e){return e in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[e]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js")),goog.typeOf=function(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var o=Object.prototype.toString.call(e);if("[object Window]"==o)return"object";if("[object Array]"==o||"number"==typeof e.length&&void 0!==e.splice&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==o||void 0!==e.call&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&void 0===e.call)return"object";return t},goog.isDef=function(e){return void 0!==e},goog.isNull=function(e){return null===e},goog.isDefAndNotNull=function(e){return null!=e},goog.isArray=function(e){return"array"==goog.typeOf(e)},goog.isArrayLike=function(e){var t=goog.typeOf(e);return"array"==t||"object"==t&&"number"==typeof e.length},goog.isDateLike=function(e){return goog.isObject(e)&&"function"==typeof e.getFullYear},goog.isString=function(e){return"string"==typeof e},goog.isBoolean=function(e){return"boolean"==typeof e},goog.isNumber=function(e){return"number"==typeof e},goog.isFunction=function(e){return"function"==goog.typeOf(e)},goog.isObject=function(e){var t=typeof e;return"object"==t&&null!=e||"function"==t},goog.getUid=function(e){return e[goog.UID_PROPERTY_]||(e[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.removeUid=function(e){"removeAttribute"in e&&e.removeAttribute(goog.UID_PROPERTY_);try{delete e[goog.UID_PROPERTY_]}catch(e){}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(e){var t=goog.typeOf(e);if("object"==t||"array"==t){if(e.clone)return e.clone();var o="array"==t?[]:{};for(var r in e)o[r]=goog.cloneObject(e[r]);return o}return e},goog.bindNative_=function(e,t,o){return e.call.apply(e.bind,arguments)},goog.bindJs_=function(e,t,o){if(!e)throw new Error;if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return function(){var o=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(o,r),e.apply(t,o)}}return function(){return e.apply(t,arguments)}},goog.bind=function(e,t,o){return Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(e,t){var o=Array.prototype.slice.call(arguments,1);return function(){var t=Array.prototype.slice.call(arguments);return t.unshift.apply(t,o),e.apply(this,t)}},goog.mixin=function(e,t){for(var o in t)e[o]=t[o]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(e){if(goog.global.execScript)goog.global.execScript(e,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),void 0!==goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(e);else{var t=goog.global.document,o=t.createElement("script");o.type="text/javascript",o.defer=!1,o.appendChild(t.createTextNode(e)),t.body.appendChild(o),t.body.removeChild(o)}}},goog.evalWorksForGlobals_=null,goog.cssNameMapping_,goog.cssNameMappingStyle_,goog.getCssName=function(e,t){var o,r=function(e){return goog.cssNameMapping_[e]||e};return o=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?r:function(e){for(var t=e.split("-"),o=[],n=0;n<t.length;n++)o.push(r(t[n]));return o.join("-")}:function(e){return e},t?e+"-"+o(t):o(e)},goog.setCssNameMapping=function(e,t){goog.cssNameMapping_=e,goog.cssNameMappingStyle_=t},goog.global.CLOSURE_CSS_NAME_MAPPING,!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING),goog.getMsg=function(e,t){var o=t||{};for(var r in o){var n=(""+o[r]).replace(/\$/g,"$$$$");e=e.replace(new RegExp("\\{\\$"+r+"\\}","gi"),n)}return e},goog.getMsgWithFallback=function(e,t){return e},goog.exportSymbol=function(e,t,o){goog.exportPath_(e,t,o)},goog.exportProperty=function(e,t,o){e[t]=o},goog.inherits=function(e,t){function o(){}o.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new o,e.prototype.constructor=e},goog.base=function(e,t,o){var r=arguments.callee.caller;if(r.superClass_)return r.superClass_.constructor.apply(e,Array.prototype.slice.call(arguments,1));for(var n=Array.prototype.slice.call(arguments,2),s=!1,i=e.constructor;i;i=i.superClass_&&i.superClass_.constructor)if(i.prototype[t]===r)s=!0;else if(s)return i.prototype[t].apply(e,n);if(e[t]===r)return e.constructor.prototype[t].apply(e,n);throw Error("goog.base called from a method of one name to a method of a different name")},goog.scope=function(e){e.call(goog.global)},goog.provide("solunea.meta.util.Base64");var Base64={code:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e,t){t=void 0!==t&&t;var o,r,n,s,i,a,l,c,u=[],d="",p=Base64.code;if((a=(l=t?Utf8.encode(e):e).length%3)>0)for(;a++<3;)d+="=",l+="\0";for(a=0;a<l.length;a+=3)r=(o=l.charCodeAt(a)<<16|l.charCodeAt(a+1)<<8|l.charCodeAt(a+2))>>18&63,n=o>>12&63,s=o>>6&63,i=63&o,u[a/3]=p.charAt(r)+p.charAt(n)+p.charAt(s)+p.charAt(i);return c=(c=u.join("")).slice(0,c.length-d.length)+d},decode:function(e,t){t=void 0!==t&&t;var o,r,n,s,i,a,l,c,u=[],d=Base64.code;if(null==(c=t?Utf8.decode(e):e))return c;for(var p=0;p<c.length;p+=4)o=(a=d.indexOf(c.charAt(p))<<18|d.indexOf(c.charAt(p+1))<<12|(s=d.indexOf(c.charAt(p+2)))<<6|(i=d.indexOf(c.charAt(p+3))))>>>16&255,r=a>>>8&255,n=255&a,u[p/4]=String.fromCharCode(o,r,n),64==i&&(u[p/4]=String.fromCharCode(o,r)),64==s&&(u[p/4]=String.fromCharCode(o));return l=u.join(""),t?Utf8.decode(l):l},isValid:function(e){return!!/^([0-9a-zA-Z+\/]{4})*(([0-9a-zA-Z+\/]{2}==)|([0-9a-zA-Z+\/]{3}=))?$/.test(e)}};goog.provide("solunea.meta.util.Strings"),solunea.meta.util.Strings=function(e){this.func=e};var Strings=solunea.meta.util.Strings;Strings.pad=function(e,t){return(e=e.toString()).length<t?Strings.pad("0"+e,t):e},goog.provide("solunea.meta.util.Utf8");var Utf8={encode:function(e){var t=e.replace(/[\u0080-\u07ff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(192|t>>6,128|63&t)});return t=t.replace(/[\u0800-\uffff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(224|t>>12,128|t>>6&63,128|63&t)})},decode:function(e){var t=e.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(e){var t=(15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2);return String.fromCharCode(t)});return t=t.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(e){var t=(31&e.charCodeAt(0))<<6|63&e.charCodeAt(1);return String.fromCharCode(t)})}};goog.provide("solunea.meta.controlers.lms.Saver_scorm_12"),goog.require("solunea.meta.util.Strings"),goog.require("solunea.meta.util.Base64"),goog.require("solunea.meta.util.Utf8"),solunea.meta.controlers.lms.Saver_scorm_12=function(e,t){this.tracker=e,this.lmsController=t};var Saver_scorm_12=solunea.meta.controlers.lms.Saver_scorm_12;Saver_scorm_12.prototype.saveProgression=function(){this.tracker.doLMSSetValue("cmi.core.lesson_location",this.lmsController.scope.currentContentID);var e=this.lmsController.scope.session_time,t=this.lmsController.scope.total_time+this.lmsController.scope.session_time;this.tracker.doLMSSetValue("cmi.core.session_time",this.formatTimeForScorm(e)),this.tracker.doLMSSetValue("cmi.core.total_time",this.formatTimeForScorm(t)),100==this.lmsController.scope.navController.getProgression()?(this.tracker.doLMSSetValue("cmi.core.lesson_status","completed"),this.tracker.doLMSSetValue("cmi.core.exit","")):"completed"!=this.tracker.doLMSGetValue("cmi.core.lesson_status")&&(this.tracker.doLMSSetValue("cmi.core.lesson_status","incomplete"),this.tracker.doLMSSetValue("cmi.core.exit","suspend"));for(var o=[],r=this.lmsController.scope.actController.getContentsNode(),n=0;n<r.length;n++){var s=r[n],i={};i.id=s["@attributes"].id,i.s=s.seen,null!=s.copiedFrom&&(i.cf=s.copiedFrom),null!=s.score&&(i.sc=s.score,i.scm=s.scoremax),o.push(i)}if(this.lmsController.scope.actController.isRandomized(!0)){var a=[],l=this.lmsController.scope.actController.getContentsTreeNode();for(n=0;n<l.length;n++)a.push(l[n]["@attributes"].contentid);o.push(a)}var c=JSON.stringify(o);c.length>=4096&&this.lmsController.scope.pushNotification(this.lmsController.scope.getLocalisedString("message_lms_error_4","modal")),this.tracker.doLMSSetValue("cmi.suspend_data",Base64.encode(c,!0)),this.lmsController.commitEnabled&&this.tracker.doLMSCommit(),this.lmsController.handleError()},Saver_scorm_12.prototype.doLMSFinish=function(){this.tracker.doLMSFinish()},Saver_scorm_12.prototype.forceCompleted=function(){this.tracker.doLMSSetValue("cmi.core.lesson_status","completed"),this.tracker.doLMSSetValue("cmi.core.exit",""),this.lmsController.commitEnabled&&this.tracker.doLMSCommit(),this.lmsController.handleError()},Saver_scorm_12.prototype.retrieveProgression=function(){var e=this.tracker.doLMSGetValue("cmi.core.total_time");if(this.lmsController.scope.total_time=parseInt(this.formatTimeFromScorm(e)),isNaN(this.lmsController.scope.total_time)&&(this.lmsController.scope.total_time=0),""!=this.tracker.doLMSGetValue("cmi.core.lesson_location")&&(this.lmsController.scope.locationToRetrieve=this.tracker.doLMSGetValue("cmi.core.lesson_location")),Base64.isValid(this.tracker.doLMSGetValue("cmi.suspend_data")))var t=Base64.decode(this.tracker.doLMSGetValue("cmi.suspend_data"),!0);else t=this.tracker.doLMSGetValue("cmi.suspend_data");if(null!=t&&""!=t){for(var o=JSON.parse(t),r=this.lmsController.scope.actController.getContentsNode(),n=0;n<r.length;n++)for(var s=r[n],i=0;i<o.length;i++){if(null!=(l=o[i]).id)s["@attributes"].id==l.id&&(null!=l.sc&&(s.score=parseInt(l.sc),s.scoremax=parseInt(l.scm)),l.s?s.seen=!0:s.seen=!1);else var a=l}for(i=0;i<o.length;i++){var l;if(null!=(l=o[i]).id&&null!=l.cf){this.lmsController.scope.actController.copyContent(l.cf,l.id);s=this.lmsController.scope.navController.getContentByID(l.id);null!=l.sc&&(s.score=parseInt(l.sc),s.scoremax=parseInt(l.scm)),l.s?s.seen=!0:s.seen=!1,null!=l.backup&&(s.backup=l.backup)}}null!=a&&this.lmsController.scope.actController.replaceContents(a)}this.lmsController.handleError()},Saver_scorm_12.prototype.saveSuccess=function(){for(var e=this.lmsController.scope.navController.getThemes(),t=0,o=0,r=0;r<e.length;r++)null!=e[r].score&&(t+=e[r].score,o+=e[r].scoremax);var n=100*t/o;this.lmsController.searchMasteryScore(),n<this.lmsController.mastery_score?this.tracker.doLMSSetValue("cmi.core.lesson_status","failed"):this.tracker.doLMSSetValue("cmi.core.lesson_status","passed"),this.tracker.doLMSSetValue("cmi.core.score.min","0"),this.tracker.doLMSSetValue("cmi.core.score.max","100"),this.tracker.doLMSSetValue("cmi.core.score.raw",n),this.lmsController.commitEnabled&&this.tracker.doLMSCommit(),this.lmsController.handleError()},Saver_scorm_12.prototype.formatTimeForScorm=function(e){var t=Strings.pad(Math.floor(e/1e3%60),2),o=Strings.pad(Math.floor(e/1e3/60%60),2);return Strings.pad(Math.floor(e/1e3/3600),4)+":"+o+":"+t+".00"},Saver_scorm_12.prototype.formatTimeFromScorm=function(e){e=e.split(":");var t=0;t=parseInt(e[0]),t*=36e5;var o=0;o=parseInt(e[1]),o*=6e4;var r=0;return r=parseInt(e[2].split(".")[0]),t+o+(r*=1e3)},Saver_scorm_12.prototype.searchMasteryScore=function(){var e=this.tracker.doLMSGetValue("cmi.student_data.mastery_score");if("not implemented"==e||""==e||void 0===e){if(e=null,null!=this.lmsController.scope.manifestJson){var t=Objects.searchInObject(this.lmsController.scope.manifestJson,"adlcp:masteryscore");t.length>0&&(e=t[0]["@content"],e=parseFloat(e),console.log("mastery score found from manifest:"+e))}if(null==e||""==e){e=null;var o=this.lmsController.scope.actJson.act.contentsTree["@attributes"].masteryScore;null==o?(e=50,console.log("mastery score not found, using default:"+e)):(e=o,console.log("mastery score found from act file."+e))}}else(e=parseFloat(e))<=1&&(e*=100),console.log("mastery score found from LMS:"+e);return e},Saver_scorm_12.prototype.fullSuspendDataSupport=function(){return!0},Saver_scorm_12.prototype.getCorrectResponses=function(e){var t=[],o="",r=[],n=e.learningData;switch(e.type){case"classification":for(var s=0;s<n.length;s++){var i=n[s];r.push(i.key.split("_")[1]+"."+i.correct.split("_")[2])}o=r.join(","),t.push(o);break;case"matching":for(s=0;s<n.length;s++){i=n[s];r.push(i.key.split("_")[1]+"."+i.correct[0].split("_")[1])}o=r.join(","),t.push(o);break;case"circle":case"choice":$.each(n,function(e,t){t.correct&&r.push(t.key.split("_")[1])}),o=r.join(","),t.push(o);break;case"fill-in":for(s=0;s<n.learnerResponses.length;s++){i=n.learnerResponses[s];r=[];for(var a=0;a<i.correct.length;a++){var l=i.correct[a];l=l.replace("[","").replace("]",""),r.push(l)}o=r.join(" "),t.push(o)}}return t},Saver_scorm_12.prototype.getStudentResponses=function(e){var t="",o=[],r=e.learningData;switch(e.type){case"matching":for(var n=0;n<r.length;n++){var s=r[n];null!==s.dockedTo&&s.dockedTo.length>0&&(Array.isArray(s.dockedTo)?o.push(s.key+"[.]"+s.dockedTo[0]):o.push(s.key+"[.]"+s.dockedTo))}t=o.join(",");break;case"circle":case"choice":$.each(r,function(e,t){t.selected&&o.push(t.key.split("_")[1])}),t=o.join(",");break;case"fill-in":$.each(r.resultMap,function(e,t){o.push(t)}),t=o.join(" ")}return t},Saver_scorm_12.prototype.getScormInteractionType=function(e){switch(e.type){case"classification":return"matching";case"circle":case"derouler":return"choice";default:return e.type}},Saver_scorm_12.prototype.setInteraction=function(e){var t=this.lmsController.scope.navController.getContentByID(this.lmsController.scope.currentContentID);if(null==t.backup.count){var o=parseInt(this.tracker.doLMSGetValue("cmi.interactions._count"));t.backup.count=o}if(void 0!==this.lmsController.scope.navController.scope.currentContentParams.items){var r=[];angular.forEach(this.lmsController.scope.navController.scope.currentContentParams.items,function(e,t){r.push({id:t,description:{fr:void 0!==e.value?e.value:e.text}})}),this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".choices",r)}if(void 0!==this.lmsController.scope.navController.scope.currentContentParams.anchors){var n=[];angular.forEach(this.lmsController.scope.navController.scope.currentContentParams.anchors,function(e,t){n.push({id:t,description:{fr:void 0!==e.value?e.value:e.text}})}),this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".target",n)}this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".id",t.backup.id),this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".description",e.description),e.type=this.getScormInteractionType(e),this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".type",e.type);for(var s=this.getCorrectResponses(e),i=0;i<s.length;i++){var a=s[i];this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".correct_responses."+i+".pattern",a)}this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".student_response",this.getStudentResponses(e)),e.success?this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".result","correct"):!1===e.success?this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".result","wrong"):this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".result","neutral"),this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".latency",this.formatTimeForScorm(1e3*t.backup.time)),this.lmsController.commitEnabled&&this.tracker.doLMSCommit(),this.lmsController.handleError()},goog.provide("solunea.meta.controlers.lms.LMS_INJECT"),solunea.meta.controlers.lms.LMS_INJECT=function(){};var LMS_INJECT=solunea.meta.controlers.lms.LMS_INJECT,syfadisSendRequestPromise=null,newSyfadisSendRequest=function(e,t){clearTimeout(o);var o=setTimeout(function(){alert(angular.element($(".body").get(0)).scope().getLocalisedString("message_lms_error_5_syfadis"))},3e4);this.enter2("sendRequest",e,t);var r=null,n=null;if("Initialize"==e){n="http://www.techniques.org/escorte4js/Initialize",r=this.newDocument(window.parent.SOAPENV_ENVELOPE);var s=this.newElement(window.parent.SOAPENV_BODY,window.parent.SOAP_ENVELOPE_NS,r);r.documentElement.appendChild(s);var i=this.newElement("Initialize",window.parent.ESCORTE4JS_NS,r);if(s.appendChild(i),this.courseId||this.scoId||this.learnerId||this.sessionId){var a=this.newElement(window.parent.ESCORTE4JS,window.parent.ESCORTE4JS_NS,r);this.setAttribute(a,"course",this.courseId),this.setAttribute(a,"sco",this.scoId),this.setAttribute(a,"learner",this.learnerId),this.setAttribute(a,"session",this.sessionId),i.appendChild(a)}}else if("Terminate"==e){n="http://www.techniques.org/escorte4js/Terminate",this.escorte4js=this.escorte4js.parentNode.removeChild(this.escorte4js);var l=this.newElement("Terminate",window.parent.ESCORTE4JS_NS);l.appendChild(this.escorte4js);s=this.getElement(this.doc.documentElement,window.parent.SOAPENV_BODY);this.removeChildren(s),s.appendChild(l),this.setAttribute(this.escorte4js,"course",this.courseId),this.setAttribute(this.escorte4js,"sco",this.scoId),this.setAttribute(this.escorte4js,"learner",this.learnerId),this.setAttribute(this.escorte4js,"session",this.sessionId),this.setAttribute(this.escorte4js,"adlNavRequest",this.adlNavRequest),r=this.doc}else if("Commit"==e){n="http://www.techniques.org/escorte4js/Commit",null!=this.escorte4js.parentNode&&(this.escorte4js=this.escorte4js.parentNode.removeChild(this.escorte4js));var c=this.newElement("Commit",window.parent.ESCORTE4JS_NS);c.appendChild(this.escorte4js);s=this.getElement(this.doc.documentElement,window.parent.SOAPENV_BODY);this.removeChildren(s),s.appendChild(c),this.setAttribute(this.escorte4js,"course",this.courseId),this.setAttribute(this.escorte4js,"sco",this.scoId),this.setAttribute(this.escorte4js,"learner",this.learnerId),this.setAttribute(this.escorte4js,"session",this.sessionId),this.setAttribute(this.escorte4js,"adlNavRequest",null),r=this.doc}else if("Quit"==e){n="http://www.techniques.org/escorte4js/Quit",r=this.newDocument(window.parent.SOAPENV_ENVELOPE);s=this.newElement(window.parent.SOAPENV_BODY,window.parent.SOAP_ENVELOPE_NS,r);r.documentElement.appendChild(s);var u=this.newElement("Quit",window.parent.ESCORTE4JS_NS,r);if(s.appendChild(u),this.courseId||this.learnerId||this.sessionId){a=this.newElement(window.parent.ESCORTE4JS,window.parent.ESCORTE4JS_NS,r);this.setAttribute(a,"course",this.courseId),this.setAttribute(a,"learner",this.learnerId),this.setAttribute(a,"session",this.sessionId),u.appendChild(a)}}var d=null!=this.msxmlHttpProgId?new ActiveXObject(this.msxmlHttpProgId):new XMLHttpRequest,p=this;if(d.onreadystatechange=function(){var r=window.parent.isHttpErrorCode(d.status);if(4==d.readyState){if(clearTimeout(o),angular.element($(".body").get(0)).scope().lmsController.commitCallback(),p.DEBUG){p.debug2("Received HTTP POST response from ["+p.soapAddressLocation+"] : "+window.parent.trim(d.responseText));var n=d.responseXML;p.DEBUG&&"Initialize"==e&&window.parent.syfLogger.receive(n.documentElement)}n=d.responseXML;var s=p.getElement(n.documentElement,window.parent.SOAPENV_BODY),i=p.getElement(s,window.parent.SOAPENV_FAULT);if(null==i)if("Initialize"==e)if(p.doc=n,p.escorte4js=p.getElement(s,window.parent.ESCORTE4JS),null==p.escorte4js&&s.hasChildNodes()&&(p.escorte4js=p.getElement(s.childNodes[0],window.parent.ESCORTE4JS)),null!=p.escorte4js){var a=p.escorte4js.getAttributeNode("sco");null!=a&&(p.scoId=String(a.nodeValue)),null!=(a=p.escorte4js.getAttributeNode("course"))&&(p.courseId=String(a.nodeValue)),null!=(a=p.escorte4js.getAttributeNode("learner"))&&(p.learnerId=String(a.nodeValue)),null!=(a=p.escorte4js.getAttributeNode("session"))&&(p.sessionId=String(a.nodeValue)),p.cocd=p.getElement(p.escorte4js,"cocd"),null!=p.cocd?p.errorCode=window.parent.NO_ERROR:(p.errorCode=window.parent.GENERAL_INITIALIZATION_FAILURE,p.errorDiag="Initialize request failed missing cocd:cocd element in SOAP body; response from server: "+d.responseText,p.error(e,t,p.errorDiag))}else p.errorCode=window.parent.GENERAL_INITIALIZATION_FAILURE,p.errorDiag="Initialize request failed, missing escorte4js element in SOAP body; response from server: "+d.responseText,p.error(e,t,p.errorDiag);else"Terminate"==e?p.errorCode=window.parent.NO_ERROR:"Commit"==e?p.errorCode=window.parent.NO_ERROR:"Quit"==e&&(p.errorCode=window.parent.NO_ERROR);else p.errorCode=p.getElementText(i,"faultcode"),0==p.errorCode.indexOf("es4js:")&&(p.errorCode=p.errorCode.substring(6)),p.errorDiag=p.getElementText(i,"faultstring"),p.error(e,t,"Failed to "+e+" on the server due to: "+trim(p.errorDiag))}else r&&(p.errorCode="Initialize"==e?window.parent.GENERAL_INITIALIZATION_FAILURE:"Terminate"==e?window.parent.GENERAL_TERMINATION_FAILURE:"Commit"==e?window.parent.GENERAL_COMMIT_FAILURE:window.parent.GENERAL_EXCEPTION,p.errorDiag=e+" request failed; response from server: ("+d.status+") "+d.statusText,p.error(e,t,p.errorDiag),window.parent.ScormHelper.alertUser())},d.open("POST",this.soapAddressLocation,!1),d.setRequestHeader("Content-type","text/xml; charset=utf-8"),null!=n&&d.setRequestHeader("SOAPAction",n),"SFR"==this.browserType||"CHR"==this.browserType){var h=(new window.parent.eSCORTE4JS_XMLBuf).xml2str(r);this.DEBUG&&this.debug2("Safari is Sending HTTP POST request to ["+this.soapAddressLocation+"] :"+h),d.send(h)}else{var g=r;null!=this.msxmlHttpProgId&&(g=r.xml),d.send(g)}return window.parent.syfadis.config.googleAnalytics&&window.parent.syfadis.config.googleAnalytics.playerErrorEnabled&&window.parent.ga("send","event","player",e,d.status),this.exit("sendRequest",e),this.errorCode};goog.provide("solunea.meta.controlers.lms.API_SCORM_2004"),goog.require("solunea.meta.controlers.lms.LMS_INJECT"),solunea.meta.controlers.lms.API_SCORM_2004=function(e,t){this.API_NAME="API_1484_11",this.LOGGER=console,this._NoError=0,this._GeneralException=101,this._GeneralInitializationFailure=102,this._AlreadyInitialized=103,this._ContentInstanceTerminated=104,this._GeneralTerminationFailure=111,this._TerminationBefInitialization=112,this._TerminationAftInitialization=113,this._RetrieveDataBefInitialization=122,this._RetrieveDataAftInitialization=123,this._StoreDataBefInitialization=132,this._StoreDataAftInitialization=133,this._CommitBefInitialization=142,this._CommitAftInitialization=143,this._GeneralArgumentError=201,this._GeneralGetFailure=301,this._GeneralSetFailure=351,this._GeneralCommitFailure=391,this._UndefinedDataModelElement=401,this._DataModelElementValNotInitialized=403,this._DataModelElementIsReadOnly=404,this._DataModelElementIsWriteOnly=405,this._DataModelElementTypeMismatch=406,this._DataModelElementValOutOfRange=407,this.commitAvaiable=!0,this.apiHandle=null,this.API=null,this.findAPITries=0,this.refCurrWindow=null,null!=e?this.refCurrWindow=e:this.displayError(0),this.apiFinder=null,null!=t?(this.apiFinder=t,this.apiFinder.setAPIName(this.API_NAME)):this.displayError(1)};var API_SCORM_2004=solunea.meta.controlers.lms.API_SCORM_2004;API_SCORM_2004.prototype.displayError=function(e,t){t?console.log(e):(this.currentErrorCode=e,this.errorState=!0)},API_SCORM_2004.prototype.doLMSInitialize=function(){var e=this.getAPIHandle();if(null==e)return this.displayError(2),"false";null!=window.parent.SYFADIS_API_OBJECT&&(window.parent.SYFADIS_API_OBJECT.sendRequest=newSyfadisSendRequest);var t=e.Initialize("");return"true"!=t.toString()&&this.displayError(3),t=this.checkErrorMessage(t)},API_SCORM_2004.prototype.doLMSFinish=function(){var e=this.getAPIHandle();if(null==e)return this.displayError(2),"false";var t=e.Terminate("");return"true"!=t.toString()&&this.displayError(3),t=this.checkErrorMessage(t)},API_SCORM_2004.prototype.doLMSGetValue=function(e){var t=this.getAPIHandle();if(null==t)return this.displayError(2),"";var o=t.GetValue(e);if(this.doLMSGetLastError()==this._NoError)return o.toString();this.displayError(3)},API_SCORM_2004.prototype.doLMSSetValue=function(e,t){var o=this.getAPIHandle();if(null!=o){var r=o.SetValue(e,t);if("true"==r.toString())return r.toString();this.displayError(3)}else this.displayError(2)},API_SCORM_2004.prototype.doLMSCommit=function(){var e=this.getAPIHandle();if(null==e)return this.displayError(2),"false";var t=e.Commit("");if("true"!=t)this.displayError(3);else{this.commitAvaiable=!1;var o=this;clearTimeout(this.commitAvaiableTimer),this.commitAvaiableTimer=setTimeout(function(){o.commitAvaiable=!0},32e3)}this.doLMSGetDiagnostic();return t=this.checkErrorMessage(t)},API_SCORM_2004.prototype.isCommitAvaiable=function(){return this.commitAvaiable},API_SCORM_2004.prototype.doLMSGetLastError=function(){var e=this.getAPIHandle();return null==e?(this.displayError(2),"false"):e.GetLastError().toString()},API_SCORM_2004.prototype.doLMSGetErrorString=function(e){var t=this.getAPIHandle();return null==t?(this.displayError(2),"false"):t.GetErrorString(e).toString()},API_SCORM_2004.prototype.doLMSGetDiagnostic=function(e){var t=this.getAPIHandle();return null==t&&this.displayError(2),t.GetDiagnostic(e).toString()},API_SCORM_2004.prototype.LMSIsInitialized=function(){var e=this.getAPIHandle();if(null==e)return this.displayError(2),!1;e.GetValue("cmi.learner_name");return e.GetLastError().toString()!=this._NotInitialized},API_SCORM_2004.prototype.errorHandler=function(){if(null!=this.getAPIHandle()){var e=this.doLMSGetLastError();if(e!=this._NoError){this.doLMSGetErrorString(e);"\n",this.doLMSGetDiagnostic(e),this.displayError(3)}return e}this.displayError(2)},API_SCORM_2004.prototype.getAPIHandle=function(){return null==this.apiHandle&&(this.apiHandle=this.apiFinder.getAPI(this.refCurrWindow)),this.apiHandle},API_SCORM_2004.prototype.checkErrorMessage=function(e){return-1!=e.indexOf("true")?"true":"false"},API_SCORM_2004.prototype.toString=function(){return"[API_SCORM_2004]"},goog.provide("solunea.meta.controlers.lms.Saver_scorm_local"),solunea.meta.controlers.lms.Saver_scorm_local=function(e){this.lmsController=e};var Saver_scorm_local=solunea.meta.controlers.lms.Saver_scorm_local;Saver_scorm_local.prototype.saveProgression=function(){},Saver_scorm_local.prototype.retrieveProgression=function(){},Saver_scorm_local.prototype.saveSuccess=function(){},Saver_scorm_local.prototype.formatTimeForScorm=function(e){var t=Math.floor(e/1e3%60),o=Math.floor(e/1e3/60%60),r=Math.floor(e/1e3/3600),n="PT";return e>0?(r>0&&(n=n+r+"H"),o>0&&(n=n+o+"M"),t>=0&&(n=n+t+"S")):n+="0S",n},Saver_scorm_local.prototype.formatTimeFromScorm=function(e){var t=e.indexOf("T");if(t>-1){e.substr(t+1);for(var o=null,r=null,n=null,s="",i=0,a=e.length;i<a;){var l=e.substr(i,1);if(isNaN(l)){switch(l){case"h":case"H":o=s;break;case"n":case"M":r=s;break;case"s":case"S":n=s}s=""}else s+=l;i++}}var c=0;null!=o&&(c=parseInt(o),c*=36e5);var u=0;null!=r&&(u=parseInt(r),u*=6e4);var d=0;return null!=n&&(d=parseInt(n),d*=1e3),c+u+d},Saver_scorm_local.prototype.searchMasteryScore=function(){var e,t=null;null!=this.lmsController.scope.manifestJson&&((e=Objects.searchInObject(this.lmsController.scope.manifestJson,"imsss:minNormalizedMeasure")).length>0&&(t=e[0]["@content"],t=100*parseFloat(t),console.log("mastery score found from manifest:"+t)));null!=t&&""!=t||null==this.lmsController.scope.manifestJson||(e=Objects.searchInObject(this.lmsController.scope.manifestJson,"adlcp:masteryscore")).length>0&&(t=e[0]["@content"],t=parseFloat(t),console.log("mastery score found from manifest:"+t));if(null==t||""==t){t=null;var o=this.lmsController.scope.actJson.act.contentsTree["@attributes"].masteryScore;null==o?(t=50,console.log("mastery score not found, using default"+t)):(t=o,console.log("mastery score found from act file."+t))}return t},Saver_scorm_local.prototype.fullSuspendDataSupport=function(){return!1},Saver_scorm_local.prototype.setInteraction=function(e){},goog.provide("solunea.meta.util.Objects"),solunea.meta.util.Objects=function(e){this.func=e};var Objects=solunea.meta.util.Objects;Objects.searchInObject=function(e,t){var o=[];for(var r in e)e.hasOwnProperty(r)&&(r==t?o.push(e[r]):"object"==typeof e[r]&&(o=o.concat(Objects.searchInObject(e[r],t))));return o},goog.provide("solunea.meta.util.Delegate"),solunea.meta.util.Delegate=function(e){this.func=e};var Delegate=solunea.meta.util.Delegate;Delegate.prototype.createDelegate=function(e){return Delegate.create(e,this.func)},Delegate.create=function(e,t){var o=function(){var e=arguments.callee.target;return arguments.callee.func.apply(e,arguments)};return o.target=e,o.func=t,o},goog.provide("solunea.meta.controlers.lms.API_SCORM_FINDER"),solunea.meta.controlers.lms.API_SCORM_FINDER=function(){this._API_NAME=null};var API_SCORM_FINDER=solunea.meta.controlers.lms.API_SCORM_FINDER;API_SCORM_FINDER.prototype.findAPIinFrame=function(e){var t=null;if(e.length>0)for(var o=0;o<e.length;o++){var r=e.frames[o];if(null!=r[this._API_NAME]){t=r;break}}return t},API_SCORM_FINDER.prototype.findAPI=function(e){var t=e[this._API_NAME];if(null==t){var o=this.findAPIinFrame(e);null!=o&&(t=o[this._API_NAME])}return t},API_SCORM_FINDER.prototype.find=function(e){var t=null;return null==(t=this.findAPI(e))&&null!=e.parent&&e.parent!=e&&(this.findAPIParent++,this.findAPIParent>7?alert("Error finding API -- too deeply nested parent."):t=this.find(e.parent)),null==t&&null!=e.opener&&e.opener!=e&&(this.findAPIOpener++,this.findAPIOpener>7?alert("Error finding API -- too deeply nested opener."):t=this.find(e.opener)),t},API_SCORM_FINDER.prototype.getAPI=function(e){this.findAPIParent=0,this.findAPIOpener=0;var t=null;return null!=this._API_NAME?null!=e?t=this.find(e):alert("API_SCORM.getAPI(); - window reference missing"):alert("API_SCORM.getAPI(); - API name missing"),t},API_SCORM_FINDER.prototype.setAPIName=function(e){this._API_NAME=e},goog.provide("solunea.meta.controlers.lms.Saver_scorm_2004"),goog.require("solunea.meta.util.Base64"),solunea.meta.controlers.lms.Saver_scorm_2004=function(e,t){this.tracker=e,this.lmsController=t};var Saver_scorm_2004=solunea.meta.controlers.lms.Saver_scorm_2004;Saver_scorm_2004.prototype.saveProgression=function(){this.tracker.doLMSSetValue("cmi.location",this.lmsController.scope.currentContentID);var e,t=this.lmsController.scope.session_time,o=this.lmsController.scope.total_time+this.lmsController.scope.session_time;if(this.tracker.doLMSSetValue("cmi.session_time",this.formatTimeForScorm(t)),this.tracker.doLMSSetValue("cmi.total_time",this.formatTimeForScorm(o)),"completeIfFailed"===this.lmsController.scope.completionMode?e=100==this.lmsController.scope.navController.getProgression():"incompleteIfFailed"===this.lmsController.scope.completionMode&&(e="passed"==this.tracker.doLMSGetValue("cmi.success_status")),e)this.tracker.doLMSSetValue("cmi.completion_status","completed"),this.tracker.doLMSSetValue("cmi.exit","suspend");else{var r="passed"==this.tracker.doLMSGetValue("cmi.success_status")?"completed":"incomplete";this.tracker.doLMSSetValue("cmi.completion_status",r),this.tracker.doLMSSetValue("cmi.exit","suspend")}0==this.lmsController.scope.navController.getQuiz().length?("incompleteIfFailed"===this.lmsController.scope.completionMode&&100==this.lmsController.scope.navController.getProgression()&&this.tracker.doLMSSetValue("cmi.completion_status","completed"),this.tracker.doLMSSetValue("cmi.success_status","unknown")):"passed"!=this.tracker.doLMSGetValue("cmi.success_status")&&"failed"!=this.tracker.doLMSGetValue("cmi.success_status")&&this.tracker.doLMSSetValue("cmi.success_status","unknown");for(var n=[],s=this.lmsController.scope.actController.getContentsNode(),i=0;i<s.length;i++){var a=s[i],l={};l.id=a["@attributes"].id,l.s=a.seen,null!=a.copiedFrom&&(l.cf=a.copiedFrom),null!=a.score&&(l.sc=a.score,l.scm=a.scoremax),null!=a.backup&&(l.backup=a.backup),n.push(l)}if(this.lmsController.scope.actController.isRandomized(!0)){var c=[],u=this.lmsController.scope.actController.getContentsTreeNode();for(i=0;i<u.length;i++)c.push(u[i]["@attributes"].contentid);n.push(c)}var d=JSON.stringify(n);this.tracker.doLMSSetValue("cmi.suspend_data",Base64.encode(d,!0)),this.lmsController.commitEnabled&&this.tracker.doLMSCommit(),this.lmsController.handleError()},Saver_scorm_2004.prototype.doLMSFinish=function(){this.tracker.doLMSFinish()},Saver_scorm_2004.prototype.forceCompleted=function(){"completeIfFailed"===this.lmsController.scope.completionMode?(this.tracker.doLMSSetValue("cmi.completion_status","completed"),this.tracker.doLMSSetValue("cmi.exit","suspend"),this.lmsController.commitEnabled&&this.tracker.doLMSCommit(),this.lmsController.handleError()):this.lmsController.scope.completionMode},Saver_scorm_2004.prototype.retrieveProgression=function(){var e=this.tracker.doLMSGetValue("cmi.total_time");if(this.lmsController.scope.total_time=parseInt(this.formatTimeFromScorm(e)),isNaN(this.lmsController.scope.total_time)&&(this.lmsController.scope.total_time=0),""!=this.tracker.doLMSGetValue("cmi.location")&&(this.lmsController.scope.locationToRetrieve=this.tracker.doLMSGetValue("cmi.location")),Base64.isValid(this.tracker.doLMSGetValue("cmi.suspend_data")))var t=Base64.decode(this.tracker.doLMSGetValue("cmi.suspend_data"),!0);else t=this.tracker.doLMSGetValue("cmi.suspend_data");if(null!=t&&""!=t){for(var o=JSON.parse(t),r=this.lmsController.scope.actController.getContentsNode(),n=0;n<r.length;n++)for(var s=r[n],i=0;i<o.length;i++){if(null!=(l=o[i]).id)null!=l.id&&s["@attributes"].id==l.id&&(null!=l.sc&&(s.score=parseInt(l.sc),s.scoremax=parseInt(l.scm)),l.s?s.seen=!0:s.seen=!1,null!=l.backup&&(s.backup=l.backup));else var a=l}for(i=0;i<o.length;i++){var l;if(null!=(l=o[i]).id&&null!=l.cf){this.lmsController.scope.actController.copyContent(l.cf,l.id);s=this.lmsController.scope.navController.getContentByID(l.id);null!=l.sc&&(s.score=parseInt(l.sc),s.scoremax=parseInt(l.scm)),l.s?s.seen=!0:s.seen=!1,null!=l.backup&&(s.backup=l.backup)}}null!=a&&this.lmsController.scope.actController.replaceContents(a)}this.lmsController.handleError()},Saver_scorm_2004.prototype.saveSuccess=function(){for(var e=this.lmsController.scope.navController.getThemes(),t=0,o=0,r=0;r<e.length;r++)null!=e[r].score&&(t+=e[r].score,o+=e[r].scoremax);var n=100*t/o;this.lmsController.searchMasteryScore(),n<this.lmsController.mastery_score?this.tracker.doLMSSetValue("cmi.success_status","failed"):this.tracker.doLMSSetValue("cmi.success_status","passed"),this.tracker.doLMSSetValue("cmi.score.min","0"),this.tracker.doLMSSetValue("cmi.score.max","100"),this.tracker.doLMSSetValue("cmi.score.raw",n),this.tracker.doLMSSetValue("cmi.score.scaled",(n/100).toFixed(2)),this.lmsController.commitEnabled&&this.tracker.doLMSCommit(),this.lmsController.handleError()},Saver_scorm_2004.prototype.formatTimeForScorm=function(e){var t=Math.floor(e/1e3%60),o=Math.floor(e/1e3/60%60),r=Math.floor(e/1e3/3600),n="PT";return e>0?(r>0&&(n=n+r+"H"),o>0&&(n=n+o+"M"),t>=0&&(n=n+t+"S")):n+="0S",n},Saver_scorm_2004.prototype.formatTimeFromScorm=function(e){var t=e.indexOf("T");if(t>-1){e.substr(t+1);for(var o=null,r=null,n=null,s="",i=0,a=e.length;i<a;){var l=e.substr(i,1);if(isNaN(l)){switch(l){case"h":case"H":o=s;break;case"n":case"M":r=s;break;case"s":case"S":n=s}s=""}else s+=l;i++}}var c=0;null!=o&&(c=parseInt(o),c*=36e5);var u=0;null!=r&&(u=parseInt(r),u*=6e4);var d=0;return null!=n&&(d=parseInt(n),d*=1e3),c+u+d},Saver_scorm_2004.prototype.searchMasteryScore=function(){var e=this.tracker.doLMSGetValue("cmi.scaled_passing_score");if("not implemented"==e||""==e||void 0===e){if(e=null,null!=this.lmsController.scope.manifestJson){var t=Objects.searchInObject(this.lmsController.scope.manifestJson,"imsss:minNormalizedMeasure");t.length>0&&(e=t[0]["@content"],e=100*parseFloat(e),console.log("mastery score found from manifest:"+e))}if(null==e||""==e){e=null;var o=this.lmsController.scope.actJson.act.contentsTree["@attributes"].masteryScore;null==o?(e=50,console.log("mastery score not found, using default"+e)):(e=o,console.log("mastery score found from act file."+e))}}else(e=parseFloat(e))<=1&&(e*=100),console.log("mastery score found from LMS:"+e);return e},Saver_scorm_2004.prototype.fullSuspendDataSupport=function(){return!0},Saver_scorm_2004.prototype.getCorrectResponses=function(e){var t=[],o="",r=[],n=e.learningData;switch(e.type){case"classification":for(var s=0;s<n.length;s++){var i=n[s];r.push(i.key+"[.]"+i.correct)}o=r.join("[,]"),t.push(o);break;case"matching":for(s=0;s<n.length;s++){i=n[s];r.push(i.key+"[.]"+i.correct[0])}o=r.join("[,]"),t.push(o);break;case"circle":case"choice":$.each(n,function(e,t){t.correct&&r.push(t.key)}),o=r.join("[,]"),t.push(o);break;case"fill-in":var a=[];for(s=0;s<n.learnerResponses.length;s++){i=n.learnerResponses[s];r=[];for(var l=0;l<i.correct.length;l++){var c=i.correct[l];c=c.replace("[","").replace("]",""),r.push(c)}o=r.join("|#|"),a.push(o)}t.push("{case_matters:"+n.useCase+"}"+a.join("[,]"))}return t},Saver_scorm_2004.prototype.getStudentResponses=function(e){var t="",o=[],r=e.learningData;switch(e.type){case"matching":for(var n=0;n<r.length;n++){var s=r[n];null!==s.dockedTo&&s.dockedTo.length>0&&(Array.isArray(s.dockedTo)?o.push(s.key+"[.]"+s.dockedTo[0]):o.push(s.key+"[.]"+s.dockedTo))}t=o.join("[,]");break;case"circle":case"choice":$.each(r,function(e,t){t.selected&&o.push(t.key)}),t=o.join("[,]");break;case"fill-in":$.each(r.resultMap,function(e,t){o.push(t)}),t=o.join("[,]"),t="{case_matters:"+r.useCase+"}"+t}return t},Saver_scorm_2004.prototype.getScormInteractionType=function(e){switch(e.type){case"classification":return"matching";case"circle":case"derouler":return"choice";default:return e.type}},Saver_scorm_2004.prototype.setInteraction=function(e){var t=this.lmsController.scope.navController.getContentByID(this.lmsController.scope.currentContentID);if(null==t.backup.count){var o=parseInt(this.tracker.doLMSGetValue("cmi.interactions._count"));t.backup.count=o}if(void 0!==this.lmsController.scope.navController.scope.currentContentParams.items){var r=[];angular.forEach(this.lmsController.scope.navController.scope.currentContentParams.items,function(e,t){r.push({id:t,description:{fr:void 0!==e.value?e.value:e.text}})}),this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".choices",r)}if(void 0!==this.lmsController.scope.navController.scope.currentContentParams.anchors){var n=[];angular.forEach(this.lmsController.scope.navController.scope.currentContentParams.anchors,function(e,t){n.push({id:t,description:{fr:void 0!==e.value?e.value:e.text}})}),this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".target",n)}this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".id",t.backup.id),this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".description",e.description),e.type=this.getScormInteractionType(e),this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".type",e.type);for(var s=this.getCorrectResponses(e),i=0;i<s.length;i++){var a=s[i];this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".correct_responses."+i+".pattern",a)}this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".learner_response",this.getStudentResponses(e)),e.success?this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".result","correct"):!1===e.success?this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".result","incorrect"):this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".result","neutral"),this.tracker.doLMSSetValue("cmi.interactions."+t.backup.count+".latency",this.formatTimeForScorm(1e3*t.backup.time)),this.lmsController.commitEnabled&&this.tracker.doLMSCommit(),this.lmsController.handleError()},goog.provide("solunea.meta.controlers.lms.API_SCORM_12"),solunea.meta.controlers.lms.API_SCORM_12=function(e,t){this.API_NAME="API",this.LOGGER=console,this._NoError=0,this._GeneralException=101,this._ServerBusy=102,this._InvalidArgumentError=201,this._ElementCannotHaveChildren=202,this._ElementIsNotAnArray=203,this._NotInitialized=301,this._NotImplementedError=401,this._InvalidSetValue=402,this._ElementIsReadOnly=403,this._ElementIsWriteOnly=404,this._IncorrectDataType=405,this.commitAvaiable=!0,this.apiHandle=null,this.API=null,this.findAPITries=0,this.refCurrWindow=null,null!=e?this.refCurrWindow=e:this.displayError("# API_SCORM_12(); - r�f�rence vers la fen�tre courante manquante - impossible de localiser l'API de communication"),this.apiFinder=null,null!=t?(this.apiFinder=t,this.apiFinder.setAPIName(this.API_NAME)):this.displayError("# API_SCORM_12(); - l'api Finder est manquant - impossible de localiser l'API de communication")};var API_SCORM_12=solunea.meta.controlers.lms.API_SCORM_12;API_SCORM_12.prototype.displayError=function(e,t){t?console.log(e):(this.currentErrorCode=e,this.errorState=!0)},API_SCORM_12.prototype.doLMSInitialize=function(){var e=this.getAPIHandle();if(null==e)return this.displayError(2),"false";null!=window.parent.SYFADIS_API_OBJECT&&(window.parent.SYFADIS_API_OBJECT.sendRequest=newSyfadisSendRequest);var t=e.LMSInitialize("");return"true"!=t.toString()&&this.displayError(3),t.toString()},API_SCORM_12.prototype.doLMSFinish=function(){var e=this.getAPIHandle();if(null==e)return this.displayError(2),"false";var t=e.LMSFinish("");return"true"!=t.toString()&&this.displayError(3),t.toString()},API_SCORM_12.prototype.doLMSGetValue=function(e){var t=this.getAPIHandle();if(null==t)return this.displayError(2),"false";var o=t.LMSGetValue(e);return this.doLMSGetLastError()!=this._NoError?(this.displayError(3),"false"):o.toString()},API_SCORM_12.prototype.doLMSSetValue=function(e,t){var o=this.getAPIHandle();if(null==o)return this.displayError(2),"false";var r=e.split(".");if("interactions"===r[1]&&"description"===r[3])return!0;var n=o.LMSSetValue(e,t);return"true"!=n.toString()?(this.displayError(3),"false"):n.toString()},API_SCORM_12.prototype.doLMSCommit=function(){var e=this.getAPIHandle();if(null==e)return this.displayError(2),"false";var t=e.LMSCommit("");if("true"!=t)return this.displayError(3),"false";this.commitAvaiable=!1;var o=this;return clearTimeout(this.commitAvaiableTimer),this.commitAvaiableTimer=setTimeout(function(){o.commitAvaiable=!0},32e3),t.toString()},API_SCORM_12.prototype.isCommitAvaiable=function(){return this.commitAvaiable},API_SCORM_12.prototype.doLMSGetLastError=function(){var e=this.getAPIHandle();return null==e?(this.displayError(2),"false"):e.LMSGetLastError().toString()},API_SCORM_12.prototype.doLMSGetErrorString=function(e){var t=this.getAPIHandle();return null==t?(this.displayError(2),"false"):t.LMSGetErrorString(e).toString()},API_SCORM_12.prototype.doLMSGetDiagnostic=function(e){var t=this.getAPIHandle();return null==t?(this.displayError(2),"false"):t.LMSGetDiagnostic(e).toString()},API_SCORM_12.prototype.LMSIsInitialized=function(){var e=this.getAPIHandle();if(null==e)return this.displayError(2),"false";e.LMSGetValue("cmi.core.student_name");return this.doLMSGetLastError()!=this._NotInitialized},API_SCORM_12.prototype.errorHandler=function(){if(null!=this.getAPIHandle()){var e=this.doLMSGetLastError();if(e!=this._NoError){this.doLMSGetErrorString(e);"\n",this.doLMSGetDiagnostic(e),this.displayError(3)}return e}this.displayError(2)},API_SCORM_12.prototype.getAPIHandle=function(){return null==this.apiHandle&&(this.apiHandle=this.apiFinder.getAPI(this.refCurrWindow)),this.apiHandle},API_SCORM_12.prototype.toString=function(){return"[API_SCORM_12]"},goog.provide("solunea.meta.controlers.LmsController"),goog.require("solunea.meta.controlers.lms.API_SCORM_2004"),goog.require("solunea.meta.controlers.lms.API_SCORM_12"),goog.require("solunea.meta.controlers.lms.API_SCORM_FINDER"),goog.require("solunea.meta.controlers.lms.Saver_scorm_2004"),goog.require("solunea.meta.controlers.lms.Saver_scorm_12"),goog.require("solunea.meta.controlers.lms.Saver_scorm_local"),goog.require("solunea.meta.util.Delegate"),goog.require("solunea.meta.util.Objects"),solunea.meta.controlers.LmsController=function(e){this.scope=e};var LmsController=solunea.meta.controlers.LmsController;LmsController.prototype.init=function(e,t){if(this.lmsActivated=e,this.lmsType=t,this.enableCommit(!0),this.lmsActivated)switch(this.scope.pushNotification(this.scope.getLocalisedString("message_connection_lms"),"modal"),this.lmsType){case"scorm_2004":this.tracker=new API_SCORM_2004(window,new API_SCORM_FINDER),this.saver=new Saver_scorm_2004(this.tracker,this),"false"==this.tracker.doLMSInitialize()?confirm(this.scope.getLocalisedString("message_no_lms"))&&(this.init(!this.scope.scorm,this.lmsType),this.scope.$apply()):this.waitForLMS();break;case"scorm_12":this.tracker=new API_SCORM_12(window,new API_SCORM_FINDER),this.saver=new Saver_scorm_12(this.tracker,this),"false"==this.tracker.doLMSInitialize()?confirm(this.scope.getLocalisedString("message_no_lms"))&&(this.init(!this.scope.scorm,this.lmsType),this.scope.$apply()):this.waitForLMS();break;default:this.lmsActivated=!1,this.saver=new Saver_scorm_local(this),this.scope.pushNotification(this.scope.getLocalisedString("message_connection_lms_unknown"),"modal")}else this.saver=new Saver_scorm_local(this),this.scope.startSessionTimer(),this.scope.closeNotification(),this.searchMasteryScore(),this.scope.onLMSInited()},LmsController.prototype.waitForLMS=function(){this.handleError()||(this.tracker.LMSIsInitialized()?(this.scope.startSessionTimer(),this.scope.closeNotification(),this.searchMasteryScore(),this.scope.onLMSInited()):setTimeout(Delegate.create(this,this.waitForLMS),100))},LmsController.prototype.searchMasteryScore=function(){this.mastery_score=this.saver.searchMasteryScore()},LmsController.prototype.enableCommit=function(e){this.commitEnabled=e},LmsController.prototype.saveAndWait=function(){!this.scope.waitForCommit&&this.lmsActivated&&(this.enableCommit(!1),this.forceCompleted(),"completeIfFailed"===this.scope.$parent.completionMode?(this.saveProgression(),this.saveSuccess()):"incompleteIfFailed"===this.scope.$parent.completionMode&&(this.saveSuccess(),this.saveProgression()),this.scope.waitForCommit=!0,this.commitAndWait())},LmsController.prototype.commitAndWait=function(){if(null==window.parent.SYFADIS_API_OBJECT)this.saver.tracker.doLMSCommit(),this.commitCallback();else if(this.saver.tracker.isCommitAvaiable())this.saver.tracker.doLMSCommit(),this.scope.waitForCommit||this.commitCallback();else{var e=this;this.commitTimeout=setTimeout(function(){e.commitAndWait()},1e3)}},LmsController.prototype.commitCallback=function(){this.enableCommit(!0),this.scope.waitForCommit=!1,this.scope.$apply()},LmsController.prototype.forceCompleted=function(){this.lmsActivated&&this.tracker.LMSIsInitialized()&&this.saver.forceCompleted()},LmsController.prototype.saveProgression=function(){this.lmsActivated&&this.tracker.LMSIsInitialized()&&(this.saver.saveProgression(),this.saver.fullSuspendDataSupport()||this.saveBackupToLocalStorage())},LmsController.prototype.saveSuccess=function(){this.lmsActivated&&this.tracker.LMSIsInitialized()&&this.saver.saveSuccess()},LmsController.prototype.doLMSFinish=function(){this.lmsActivated&&this.tracker.LMSIsInitialized()&&this.tracker.doLMSFinish()},LmsController.prototype.retrieveProgression=function(){this.lmsActivated&&this.tracker.LMSIsInitialized()&&(this.saver.retrieveProgression(),this.saver.fullSuspendDataSupport()||this.getBackupFromLocalStorage())},LmsController.prototype.saveBackupToLocalStorage=function(){for(var e=this.scope.actController.getContentsNode(),t=0;t<e.length;t++){var o=e[t];null!=o.backup&&localStorage.setItem(o["@attributes"].id,JSON.stringify(o.backup))}},LmsController.prototype.getBackupFromLocalStorage=function(){for(var e=this.scope.actController.getContentsNode(),t=0;t<e.length;t++){var o=e[t],r=JSON.parse(localStorage.getItem(o["@attributes"].id));null!=r&&(o.backup=r)}},LmsController.prototype.setInteraction=function(e){this.lmsActivated&&this.tracker.LMSIsInitialized()&&this.saver.setInteraction(e)},LmsController.prototype.handleError=function(){if(this.tracker.errorState&&"No error"!=this.tracker.doLMSGetErrorString(this.tracker.doLMSGetLastError())){var e=this.scope.getLocalisedString("message_lms_error_"+this.tracker.currentErrorCode);return 3==this.tracker.currentErrorCode?this.scope.$apply():(this.scope.pushNotification(e,"modal"),this.scope.$apply()),this.tracker.LMSIsInitialized()?console.log(e+" - "+this.tracker.doLMSGetErrorString(this.tracker.doLMSGetLastError())):console.log(e),this.tracker.errorState=!1,!0}return this.tracker.errorState=!1,this.scope.closeNotification(),this.scope.$apply(),!1},goog.provide("solunea.meta.controlers.NavController"),solunea.meta.controlers.NavController=function(e){this.scope=e};var NavController=solunea.meta.controlers.NavController;NavController.prototype.displayContent=function(e,t,o){var r=this;this.scope.currentContentID=parseInt(e);var n=this.getContentByID(e);n.seen=!0;t?this.scope.changeContentURL(n.rlc.filename["@content"]):($("#content_displayer").removeClass("content_anim_in").removeClass("next").removeClass("prev"),$("#content_displayer").addClass("content_anim_out"),"next"==o?$("#content_displayer").addClass("next"):"prev"==o&&$("#content_displayer").addClass("prev"),setTimeout(function(){r.scope.showLoading=!0,r.scope.changeContentURL(n.rlc.filename["@content"]),r.scope.$apply()},500))},NavController.prototype.getContentByID=function(e){for(var t=this.scope.actController.getContentsNode(),o=0;o<t.length;o++)if(parseInt(t[o]["@attributes"].id)==parseInt(e))return t[o];return-1},NavController.prototype.nextContent=function(){var e=this.getCurrentContentPosition(),t=this.scope.actJson.act.contentsTree.node[e+1];this.scope.showNext=!1,null!=t&&this.displayContent(t["@attributes"].contentid,!1,"next")},NavController.prototype.previousContent=function(){var e=this.getCurrentContentPosition(),t=this.scope.actJson.act.contentsTree.node[e-1];null!=t&&this.displayContent(t["@attributes"].contentid,!1,"prev")},NavController.prototype.onContentChanged=function(){this.scope.showLoading=!1,$("#content_displayer").removeClass("content_anim_out"),$("#content_displayer").addClass("content_anim_in");var e=this.getCurrentContentPosition();this.scope.showPrev=!0,this.scope.showNext=!0,0==e&&(this.scope.showPrev=!1),e>=this.scope.actJson.act.contentsTree.node.length-1&&(this.scope.showNext=!1),"bilan"==this.getContentByID(this.scope.currentContentID)["@attributes"].type?this.scope.lmsController.saveAndWait():this.scope.lmsController.saveProgression(),this.scope.refreshProgress()},NavController.prototype.getCurrentContentPosition=function(){var e=0;if(void 0!==this.scope.actJson)for(var t=this.scope.actJson.act.contentsTree.node,o=0;o<t.length;o++)if(parseInt(t[o]["@attributes"].contentid)==this.scope.currentContentID){e=o;break}return e},NavController.prototype.getCurrentContentID=function(){var e=this.getCurrentContentPosition();return this.scope.actJson.act.contentsTree.node[e]["@attributes"].contentid},NavController.prototype.getQuizStartID=function(){for(var e=0,t=this.scope.actJson.act.contentsTree.node,o=0;o<t.length;o++){var r=this.getContentByID(t[o]["@attributes"].contentid);if("quiz"==r["@attributes"].type){e=r["@attributes"].id;break}e<this.firstRandomScreen&&(e=this.firstRandomScreen)}return e},NavController.prototype.getThemes=function(){for(var e=[],t=this.scope.actController.getContentsNodeInTree(),o=0;o<t.length;o++){var r=t[o];if("quiz"==r["@attributes"].type&&null!=r.backup){for(var n=r["@attributes"].theme,s=!1,i=0;i<e.length;i++)e[i].id==n&&(s=!0,e[i].score+=r.score,e[i].scoremax+=r.scoremax,e[i].time+=r.backup.time);if(!s){var a={};a.score=r.score,a.scoremax=r.scoremax,a.time=r.backup.time,a.id=n,e.push(a)}}}return e},NavController.prototype.getQuiz=function(){for(var e=[],t=this.scope.actController.getContentsNode(),o=0;o<t.length;o++){var r=t[o];"quiz"==r["@attributes"].type&&e.push(r)}return e},NavController.prototype.getPrevious=function(){return this.previousScore},NavController.prototype.getProgression=function(){for(var e=0,t=0,o=this.scope.actJson.act.contentsTree.node,r=this.scope.actController.getContentsNode(),n=0;n<o.length;n++){for(var s=o[n],i=null,a=0;a<r.length;a++){var l=r[a];s["@attributes"].contentid==l["@attributes"].id&&(i=l)}null!=i&&i.seen&&e++,t++}return 100*e/t},goog.provide("solunea.meta.controlers.ActController"),solunea.meta.controlers.ActController=function(e){var t=this;this.scope=e,$.ajax({url:e.act,dataType:"xml",success:function(o){var r=t.xmlToJson(o);e.actJson=r,e.onActInited(),e.checkIfAContentIsDisplayed()}})};var ActController=solunea.meta.controlers.ActController;function shuffleAr(e){var t,o,r;for(r=e.length;r;r--)t=Math.floor(Math.random()*r),o=e[r-1],e[r-1]=e[t],e[t]=o}function searchIndex(e,t){for(var o=0;o<t.length;++o)if(t[o].name==e){o;break}}ActController.prototype.loadManifest=function(){if(this.scope.scorm){var e=this;$.ajax({url:"imsmanifest.xml",dataType:"xml",success:function(t){var o=e.xmlToJson(t);e.scope.manifestJson=o,e.scope.onManifestLoaded()}})}else this.scope.onManifestLoaded()},ActController.prototype.getMenuItemsNode=function(){var e=[];try{if(null!=this.scope.actJson)if(null!=this.scope.actJson.act.menus.menu.item.length){var t=this.scope.actJson.act.menus.menu.item;angular.forEach(t,function(t,o){e.push(t)})}else{t=this.scope.actJson.act.menus.menu.item;e.push(t)}}catch(e){}return e},ActController.prototype.getResourcesNode=function(){var e=[];if(null!=this.scope.actJson&&null!=this.scope.actJson.act.resources.resource){if(null!=this.scope.actJson.act.resources.resource.length)var t=this.scope.actJson.act.resources.resource;else t=this.scope.actJson.act.resources;angular.forEach(t,function(t,o){e.push(t)})}return e},ActController.prototype.getContentsNodeInTree=function(){for(var e=[],t=this.scope.actJson.act.contentsTree.node,o=this.getContentsNode(),r=0;r<t.length;r++){for(var n=t[r],s=null,i=0;i<o.length;i++){var a=o[i];n["@attributes"].contentid==a["@attributes"].id&&(s=a)}null!=s&&e.push(s)}return e},ActController.prototype.getContentsNode=function(){var e=[];if(null!=this.scope.actJson){if(null!=this.scope.actJson.act.contents.content.length)var t=this.scope.actJson.act.contents.content;else t=this.scope.actJson.act.contents;angular.forEach(t,function(t,o){e.push(t)})}return e},ActController.prototype.getContentsTreeNode=function(){var e=[];if(null!=this.scope.actJson)if(null!=this.scope.actJson.act.contents.content.length){var t=this.scope.actJson.act.contentsTree.node;angular.forEach(t,function(t,o){e.push(t)})}else{t=this.scope.actJson.act.contentsTree.node;e.push(t)}return e},ActController.prototype.getProperty=function(e){for(var t=0;t<this.scope.actJson.act.properties.data.length;t++)if(this.scope.actJson.act.properties.data[t].property["@content"]==e)return this.scope.actJson.act.properties.data[t].value["@content"];return-1},ActController.prototype.xmlToJson=function(e){var t=!0;if(e.attributes&&e.attributes.length>0){var o;(t={})["@attributes"]={};for(var r=0;r<e.attributes.length;r++)o=e.attributes.item(r),t["@attributes"][o.nodeName]=o.nodeValue}if(e.hasChildNodes()){var n,s,i;!0===t&&(t={});for(var a=0;a<e.childNodes.length;a++)1==(7&(i=e.childNodes.item(a)).nodeType)?(n=i.nodeName,s=this.xmlToJson(i),t.hasOwnProperty(n)?(t[n].constructor!==Array&&(t[n]=[t[n]]),t[n].push(s)):t[n]=s):3==(i.nodeType-1|1)&&(n="@content",s=3===i.nodeType?i.nodeValue.replace(/^\s+|\s+$/g,""):i.nodeValue,t.hasOwnProperty(n)?t[n]+=s:4!==i.nodeType&&""===s||(t[n]=s))}return t},ActController.prototype.randomize=function(e){this.randomized=[],this.pool=[];for(var t=this.getContentsNode(),o=0;o<t.length;o++){var r=t[o];"true"==r["@attributes"].randomPool&&this.pool.push(r)}shuffleAr(this.pool);for(o=this.pool.length-1;o>=0;o--){"true"==(a=this.pool[o])["@attributes"].mandatory&&this.randomized.length<e&&this.randomized.push(this.pool.splice(o,1)[0])}for(;this.randomized.length<e&&this.pool.length>0;)this.randomized.push(this.pool.splice(Math.floor(Math.random()*this.pool.length),1)[0]);shuffleAr(this.randomized);var n=this.scope.navController.getContentByID(this.scope.currentContentID).rlc.filename["@content"],s=this.getContentsNode(),i=0;for(o=0;o<s.length;o++){var a;(a=s[o]).rlc.filename["@content"]==n&&(i=a["@attributes"].id)}var l=this.getContentsTreeNode(),c=0;for(o=0;o<l.length;o++){l[o]["@attributes"].contentid==i&&(c=o)}this.injectContents(c+1,this.randomized)},ActController.prototype.randomizeThemes=function(e){this.randomized=[],this.pool=[];for(var t=this.getContentsNode(),o=0;o<t.length;o++){"true"==(n=t[o])["@attributes"].randomPool&&this.pool.push(n)}shuffleAr(this.pool);for(o=0;o<e.length;o++){(s=e[o]).currentNb=0,s.themePool=[];for(var r=this.pool.length-1;r>=0;r--){var n;(n=this.pool[r])["@attributes"].theme==s.id&&(s.themePool.push(n),"true"==n["@attributes"].mandatory&&s.currentNb<s.nbRandom&&(this.randomized.push(this.pool.splice(r,1)[0]),s.currentNb++))}}for(o=0;o<e.length;o++)for(var s=e[o];s.currentNb<s.nbRandom&&s.themePool.length>0;)this.randomized.push(s.themePool.splice(Math.floor(Math.random()*s.themePool.length),1)[0]),s.currentNb++;shuffleAr(this.randomized);var i=this.scope.navController.getContentByID(this.scope.currentContentID).rlc.filename["@content"],a=this.getContentsNode(),l=0;for(o=0;o<a.length;o++){var c=a[o];c.rlc.filename["@content"]==i&&(l=c["@attributes"].id)}var u=this.getContentsTreeNode(),d=0;for(o=0;o<u.length;o++){u[o]["@attributes"].contentid==l&&(d=o)}this.injectContents(d+1,this.randomized)},ActController.prototype.clearRandomContents=function(){for(var e=this.scope.actJson.act.contentsTree.node,t=this.getContentsNode(),o=e.length-1;o>=0;o--){for(var r=e[o],n=null,s=0;s<t.length;s++){var i=t[s];r["@attributes"].contentid==i["@attributes"].id&&(n=i)}null!=n&&"true"==n["@attributes"].randomPool&&e.splice(o,1)}this.randomized=null},ActController.prototype.isRandomized=function(e){var t=!1,o=this.scope.actJson.act.contentsTree.node;if(e)var r=0;else{r=-1;for(var n=0;n<o.length;++n)if(o[n]["@attributes"].contentid==this.scope.currentContentID){r=n;break}}var s=this.getContentsNode();for(n=o.length-1;n>r;n--){for(var i=o[n],a=null,l=0;l<s.length;l++){var c=s[l];i["@attributes"].contentid==c["@attributes"].id&&(a=c)}null!=a&&"true"==a["@attributes"].randomPool&&(t=!0)}return t},ActController.prototype.injectContents=function(e,t){for(var o=t.length-1;o>=0;o--){for(var r=t[o],n=this.scope.actJson.act.contentsTree.node,s=r["@attributes"].id,i=n.length-1;i>0;i--){n[i]["@attributes"].contentid==r["@attributes"].id&&(s=this.copyContent(r["@attributes"].id))}var a={"@attributes":{}};a["@attributes"].contentid=s,this.scope.actJson.act.contentsTree.node.splice(e,0,a)}},ActController.prototype.replaceContents=function(e){this.scope.actJson.act.contentsTree.node=[];for(var t=0;t<e.length;t++){for(var o=e[t],r=this.scope.actJson.act.contentsTree.length-1;r>0;r--){this.scope.actJson.act.contentsTree[r]["@attributes"].contentid==e[t]&&(o=this.copyContent(e[t]))}var n={"@attributes":{}};n["@attributes"].contentid=o,this.scope.actJson.act.contentsTree.node.push(n)}},ActController.prototype.copyContent=function(e,t){var o=this.scope.navController.getContentByID(e),r=JSON.parse(JSON.stringify(o));return r["@attributes"].id=null!=t?t:this.scope.actJson.act.contents.content.length+1,r.seen=!1,r.copiedFrom=e,this.scope.actJson.act.contents.content.push(r),r["@attributes"].id},ActController.prototype.normalizeActNodes=function(){var e=this.scope.actJson.act.contentsTree.node;if(!(e instanceof Array)){var t=[];$.each(e,function(e,o){var r={};r[e]=o,t.push(r)}),this.scope.actJson.act.contentsTree.node=t}},goog.provide("solunea.meta.core.appRun");var app=angular.module("cannelle_app",["ngSanitize"]);app.run(function(e,t){for(var o in t.params)e[o]=t.params[o]}),goog.provide("solunea.meta.controlers.appController"),app.controller("cannelle_appCtrl",["$scope","$sce","$timeout","$window","$filter","$http",function(e,t,o,r,n,s,a){e.init=function(){e.childScope=null,e.setLocalisation(),e.setCustomSettings(),e.manageSafariBrowser(),e.total_time=0,e.navController=new NavController(e),e.lmsController=new LmsController(e),e.actController=new ActController(e),e.initializeColors(),e.manageRightToLeftLocales($("body")),e.alreadySeenPages=[],e.resize(),e.setLogo(),$("#meta").removeClass("waitUntilOpening")},e.isImage=function(e){try{var t=e.split(".").pop();return["pdf","fpx","pcd","j2c","j2k","jpx","jp2","jpeg","jpg","bmp","gif","tif","tiff","jfif","jif","png","svg"].includes(t)}catch(e){return!1}},e.manageSafariBrowser=function(){-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&$("body").addClass("safari")},e.setCustomSettings=function(){null!=typeof r.customSettings?e.customSettings=r.customSettings:e.setCustomSettingsWithoutFile()},e.refreshMathContent=function(){MathJax.hasOwnProperty("typeset")&&MathJax.typeset()},e.setLocalisation=function(){if(e.localisation=r["localisation_"+e.lang],null==e.localisation)throw new Error("Localisation '"+e.lang+"' does not exists.");document.documentElement.setAttribute("lang",e.lang)},e.setLocationForContent=function(t){e.getChildScope().selectedLocalisation=e.getChildScope().standalone?"fr":e.lang;var o=document.getElementById("content_displayer").contentWindow["localisation_"+e.getChildScope().selectedLocalisation];if(e.getChildScope().localisation=o,null==e.getChildScope().localisation)throw new Error("Localisation '"+e.getChildScope().selectedLocalisation+"' does not exists.");t.documentElement.setAttribute("lang",e.lang)},e.manageRightToLeftLocales=function(t){e.isRightToLeftLanguage()&&t.addClass("rtl")},e.manageContrastedColors=function(t){e.contrastedColors?t.addClass("accessibility"):t.removeClass("accessibility")},e.isRightToLeftLanguage=function(){return["ar","he"].includes(e.lang)},e.getCurrentContentTitle=function(){try{return e.navController.getContentByID(e.navController.getCurrentContentID()).title["@content"]}catch(e){return"iframe_content"}},e.setPublicationTitleOnHtmlTitle=function(){document.title=e.title},e.reactivateActionButtons=function(e){e.forEach(function(e){$(e).removeClass("hidden-btn")})},e.showFeedbackImage=function(){try{var t=!0;return""==e.getChildScope().feedbackFinal.feedbackImage&&(t=!1),"x_illus2_x.jpg"==e.getChildScope().feedbackFinal.feedbackImage&&(t=!1),t}catch(e){return!1}},e.displayFeedbackButton=function(){try{var t=e.showFeedbackImage(),o=""!=e.getChildScope().feedbackFinal.feedbackText;return e.showButton("feedback")&&t|o}catch(e){return!1}},e.getResourceType=function(e){var t=e.filename["@content"];return t.startsWith("https://")|t.startsWith("http://")?"url":"file"},e.getResourceSliced=function(e){for(var t,o,r=/(.*)\((.*)\)/gm;null!==(o=r.exec(e));)o.index===r.lastIndex&&r.lastIndex++,t={title:o[1],size:o[2]};return t},e.showScore=function(){var t=!1;return void 0!==e.getChildScope()&&"0"!==e.getChildScope().scoring&&(e.getChildScope().success&&(t=!0),e.getChildScope().tries>=e.getChildScope().nbtries&&(t=!0)),t},e.showPopTimer=function(){var t=!1,o=parseInt(e.getChildScope().timerPourEcran,10);Number.isInteger(o)&&o>0&&(e.getChildScope().alreadyDone||1!=e.getChildScope().hidepop&&(t=!0)),t?($("#pop").modal("show"),setTimeout(function(){$("#pop-timer-btn").focus()},250),e.manageTabularNavigationOnActionButtons(!1)):($("#pop").modal("hide"),e.manageTabularNavigationOnActionButtons(!0))},e.removeTimer=function(){$("#pop").modal("hide"),e.manageTabularNavigationOnActionButtons(!0),e.getChildScope().hasOwnProperty("removeTimer")&&e.getChildScope().removeTimer()},e.timerInterval=setInterval(function(){void 0!==e.getChildScope()&&!0===e.getChildScope().oK&&e.getChildScope().timerQuireste>0&&e.getChildScope().timerQuireste--,null!=document.getElementById("leTimer")&&e.getChildScope().timerQuireste<=10&&(e.getChildScope().timerQuireste%2==0?$("#leTimer").addClass("blink"):$("#leTimer").removeClass("blink")),void 0!==e.getChildScope()&&$("#leTimer").text(e.getChildScope().timerQuireste)},1e3),e.manageTabularNavigationOnActionButtons=function(e){var t=$('#action-buttons button[id^="btn-"]');$.each(t,function(t,o){e?$(this).removeAttr("tabindex"):$(this).attr("tabindex","-1")})},e.getCurrentContentName=function(){try{var t,o,r=e.frame.src;return null!==(o=/\/content\/(.*)_html/gm.exec(r))&&(t=o[1].toLowerCase()),t.replace("content/","")}catch(e){return""}},e.getConsigneLabel=function(t){var o,r;t?(r="label_consigne_"+e.getCurrentContentName()+"_fallback",o=e.getLocalisedString(r)):void 0!==e.getChildScope()&&(o=e.getChildScope().consigne);return o},e.getIconForPopTimerModal=function(){var t=e.getCurrentContentName();return""!=t?t:"activity"},e.getFeedback=function(){try{return t.trustAsHtml(e.getChildScope().feedbackFinal.feedbackText)}catch(e){return!1}},e.checkIfAContentIsDisplayed=function(){if(void 0===e.frameURL){var t=e.actJson.act.navigation.mainContent["@attributes"].contentid;e.navController.displayContent(t,!0)}},e.setCustomSettingsWithoutFile=function(){e.customSettings={forcedNavigation:0,showInstructionsInTheFirstDisplayOfEachActivityScreen:!1}},e.showButton=function(e){try{return document.getElementById("content_displayer").contentWindow.angular.element("body").scope().$$childHead.showButton(e)}catch(e){}},e.allTriesUsed=function(){var t=!1;return void 0!==e.getChildScope().tries&&void 0!==e.getChildScope().nbtries&&(t=e.getChildScope().tries<e.getChildScope().nbtries),t},e.setLogo=function(){var e="engine/img/"+getComputedStyle(document.documentElement).getPropertyValue("--logo").replace(/["']/g,"").trim();$("#logo-sommaire").attr("src",e),$("#logo-navbar").attr("src",e)},e.initializeColors=function(){e.contrastedColors?$("body").addClass("accessibility"):$("body").removeClass("accessibility")},e.enableAccessibleMode=function(){e.accessibleMode?e.accessibleMode=!1:e.accessibleMode=!0,null!=e.frame.contentWindow.angular.element("#container").scope().tries&&e.frame.contentWindow.angular.element("#container").scope().showAccessVersion()},e.loadContrastedColors=function(){e.contrastedColors?(e.contrastedColors=!1,$("#meta").removeClass("rgaa")):(e.contrastedColors=!0,$("#meta").addClass("rgaa"))},e.onActInited=function(){e.actController.normalizeActNodes(),e.title=e.actController.getProperty("_H1"),e.actController.loadManifest(),e.setPublicationTitleOnHtmlTitle(),e.$apply()},e.onManifestLoaded=function(){e.session_time=0,e.lmsController.init(e.scorm,e.scorm_version),e.$apply()},e.onLMSInited=function(){if(e.lmsController.retrieveProgression(),null!=e.locationToRetrieve)var t=e.locationToRetrieve;else t=e.actJson.act.navigation.mainContent["@attributes"].contentid;e.haveSound?(e.startContent=t,$("#modalSono").modal({show:!0}),$("#modalSono").on("shown",function(){$("#soundButton").focus()})):e.navController.displayContent(t,!0)},e.changeContentURL=function(o){$(".loader-container").show(),e.frameURL=t.trustAsResourceUrl(o)},e.iframeLoadedCallBack=function(t){$(".loader-container").hide(),e.timerPaused=!1,e.navController.onContentChanged(),e.frame=t[0],e.frame.contentWindow.setTracker(this),e.currentContentParams=e.frame.contentWindow.params,e.playIntroSound(),e.$apply()},e.playIntroSound=function(){if(null!=e.audio&&e.audio.pause(),null!=e.currentContentParams&&null!=e.currentContentParams.sound&&""!=e.currentContentParams.sound){var o=t.getTrustedResourceUrl(e.frameURL);o=o.split("/");var r="";for(i=0;i<o.length-1;i++)r+="/",r+=o[i];null==e.audio&&(e.audio=$("#audioPlayer").get(0)),void 0!==e.audio&&(e.audio.src="."+r+"/"+e.currentContentParams.sound,e.audio.play())}},e.pauseTimer=function(){e.timerPaused=!0},e.startSessionTimer=function(){e.timerPaused||(e.session_time+=100),o(e.startSessionTimer,100)},e.getLocalisedString=function(t){return null!=e.localisation[t]?e.localisation[t]:""},e.pushNotification=function(t,r,n){switch(e.current_notification=t,e.current_notification_type=r,r){case"warning":case"error":$("#Events").collapse("show");break;case"modal":$("#ModalCentered").modal("show")}null!=n&&0!=n&&(e.timeoutPromise=o(e.closeNotification,n))},e.closeNotification=function(){o.cancel(e.timeoutPromise),$("#Events").collapse("hide"),$("#ModalCentered").modal("hide")},e.nextContent=function(t){if(void 0===t)switch(e.customSettings.forcedNavigation){case 1:e.manageNextContentUnderCustomNavigation("supervised");break;case 2:e.manageNextContentUnderCustomNavigation("forced");break;default:e.goToNextContent()}else e.goToNextContent()},e.goToNextContent=function(){e.addPageToAlreadySeenPages(),e.removeToastMessages(),$(".collapse").collapse(),e.navController.nextContent()},e.manageNextContentUnderCustomNavigation=function(t){!0===e.getChildScope().isAllContentViewed()||e.pageHasAlreadyBeSeen()?e.goToNextContent():e.showForcedNavigationMessage(t,"next")},e.pageHasAlreadyBeSeen=function(){return-1!=e.alreadySeenPages.indexOf(e.currentContentID)},e.addPageToAlreadySeenPages=function(){-1==e.alreadySeenPages.indexOf(e.currentContentID)&&e.alreadySeenPages.push(e.currentContentID)},e.showForcedNavigationMessage=function(e,t){if("supervised"==e)switch(t){case"next":$("#supervised-navigation-btn-nextPage").show(),$("#supervised-navigation-btn-goToContent").hide();break;case"goToContent":$("#supervised-navigation-btn-nextPage").hide(),$("#supervised-navigation-btn-goToContent").show()}$("#"+e+"-navigation").toast("show")},e.removeToastMessages=function(){$(".toast").toast("hide")},e.forcedNavigationBackToPage=function(){e.disableNext=!1},e.previousContent=function(){e.removeToastMessages(),e.navController.previousContent()},e.displayContent=function(t){e.navController.displayContent(t)},e.displayMenu=function(t){if(e.canAccessToTargetContent(t))e.addPageToAlreadySeenPages(),$(".modal").modal("hide"),e.navController.displayContent(t);else switch(e.customSettings.forcedNavigation){case 1:e.showForcedNavigationMessage("supervised","goToContent"),e.goToPageViaSummary=t;break;case 2:e.showForcedNavigationMessage("forced","next")}},e.forceAccessToContent=function(){e.addPageToAlreadySeenPages(),$(".modal").modal("hide"),e.removeToastMessages(),$(".collapse").collapse(),e.navController.displayContent(e.goToPageViaSummary)},e.canAccessToTargetContent=function(t){switch(e.customSettings.forcedNavigation){case 0:return!0;case 1:case 2:return e.canAccessToTargetContentUnderSupervisedOrForcedNavigation(t);default:return!0}},e.canAccessToTargetContentUnderSupervisedOrForcedNavigation=function(t){var o,r,n;return o=!0===e.getChildScope().isAllContentViewed()||e.pageHasAlreadyBeSeen(),r=e.alreadySeenPages.includes(t),n=parseInt(t,10)==e.currentContentID-1,o&&r|n},e.isAllContentViewedForPage=function(t){return e.alreadySeenPages.includes(parseInt(t))?"watched":" "},e.isLinkToPageActivated=function(t){var o="";return 2!=e.customSettings.forcedNavigation||e.alreadySeenPages.includes(parseInt(t))||(o="linkDisabled"),o},e.getIconForLinkToPage=function(t){switch(e.customSettings.forcedNavigation){case 0:case 1:e.alreadySeenPages.includes(parseInt(t["@attributes"].id))&&(o="icon-checked");break;case 2:if(e.isCurrentPage(t))var o="icon-checked";else if(e.canAccessToTargetContentUnderForcedNavigation(parseInt(t["@attributes"].id)))if(e.alreadySeenPages.includes(parseInt(t["@attributes"].id)))o="icon-checked";else o=!1;else var o="linkDisabled";break;default:o=!1}return o},e.isCurrentPage=function(t){return e.navController.scope.currentContentID==parseInt(t["@attributes"].id)?"currentPage":""},e.lockMeta=function(){e.showPrev=!1,e.showNext=!1},e.unlockMeta=function(){e.navController.onContentChanged()},e.setScore=function(t,o){var r=e.navController.getContentByID(e.currentContentID);r.score=t,r.scoremax=o,e.lmsController.saveProgression()},e.setCurrentContentState=function(t){e.navController.getContentByID(e.currentContentID).backup=t},e.setInteraction=function(t){e.lmsController.setInteraction(t)},e.getCurrentContentState=function(){return e.navController.getContentByID(e.currentContentID).backup},e.getThemes=function(){return e.navController.getThemes()},e.getTotalTime=function(){return e.total_time+e.session_time},e.getMasteryScore=function(){return this.lmsController.searchMasteryScore(),this.lmsController.mastery_score},e.getPrevious=function(){return e.navController.getPrevious()},e.getMenu=function(){var t=[];if(null!=e.actJson){var o=e.actController.getMenuItemsNode();angular.forEach(o,function(o,r){var n=e.navController.getContentByID(o["@attributes"].contentId);null!=n&&null!=n["@attributes"]&&"bilan"!=n["@attributes"].type&&"quiz"!=n["@attributes"].type&&t.push(o)})}return t},e.getActiveMenu=function(t){if(parseInt(t["@attributes"].contentId)==e.currentContentID)return"active"},e.getResources=function(){return e.actController.getResourcesNode()},e.isBilanPage=function(){try{return void 0!==e.getChildScope().isBilanPage&&e.getChildScope().isBilanPage}catch(e){return!1}},e.getMaxAttempts=function(){if(1==e.isBilanPage())return e.getChildScope().maxAttempts},e.restartQuiz=function(){for(var t={score:0,scoremax:0},o=e.actController.getContentsNode(),r=0;r<o.length;r++){var n=o[r];"quiz"==n["@attributes"].type&&(isNaN(n.score)||isNaN(n.scoremax)||(t.score+=n.score,t.scoremax+=n.scoremax),n.backup=null,localStorage.removeItem(n["@attributes"].id))}t.time=e.getTotalTime(),e.navController.previousScore=t,e.clearRandom();var s=e.navController.getQuizStartID();e.navController.displayContent(s)},e.refreshProgress=function(){e.progress_percent=e.navController.getProgression()},e.startRandom=function(t){null==e.navController.firstRandomScreen&&(e.navController.firstRandomScreen=this.currentContentID),e.actController.isRandomized()||(null!=t.length&&t.length>0?e.actController.randomizeThemes(t):e.actController.randomize(t),e.navController.onContentChanged())},e.clearRandom=function(){e.actController.clearRandomContents()},e.getCurrentFrameSize=function(){var e={};return e.w=$("#content_displayer").width(),e.h=$("#content_displayer").height(),e},window.onbeforeunload=function(){e.lmsController.doLMSFinish()},e.getContentTitle=function(){var t="";return void 0!==e.getChildScope()&&(void 0!==e.getChildScope().exo_title?t=e.getChildScope().exo_title:void 0!==e.getChildScope().title?t=e.getChildScope().title:void 0!==e.getChildScope().statement&&(t=e.getChildScope().statement)),t},e.getScope=function(){try{return document.getElementById("content_displayer").contentWindow.angular.element("body").scope()}catch(e){}},e.getChildScope=function(){try{return e.getScope().$$childHead}catch(e){}},e.getContentDirectory=function(){try{var e=$("#content_displayer")[0].attributes.src.value.split("/");return e.pop(),e.join("/")}catch(e){}},e.setTitle=function(e){void 0!==e.title["@content"]?$("#page-title").text(e.title["@content"]):$("#page-title").text("")},e.showInstructionsInTheFirstDisplayOfThePage=function(){!0===e.customSettings.showInstructionsInTheFirstDisplayOfEachActivityScreen&&(e.pageHasAlreadyBeSeen()||e.displayConsigne())},e.displayConsigne=function(){var t=$("#consigne"),o=$("#btn-consigne");t.hasClass("show")?(t.toast("hide"),o.removeClass("active")):(t.toast("show"),o.addClass("active")),e.setFocus($("#consigne button"),600)},e.getConsigne=function(){return e.navController.getConsigne()},e.hideNavBar=function(){$("#sidebar").removeClass("active")},e.isMobileDevice=function(){var e=$(window).width(),t=window.innerHeight>window.innerWidth?"portrait":"landscape";return!(e>768&&"landscape"==t)},$(document).ready(function(){$(".toast").toast({autohide:!1}),$("#dismiss, .overlay").on("click",function(){$("#sidebar").removeClass("active"),$(".overlay").removeClass("active")}),$("#legende .close").on("click",function(){$(".collapsed")[0]?$("#legende").removeClass("shrink"):$("#legende").addClass("shrink")}),e.resize()}),window.onresize=function(){e.resize()},e.resize=function(){$(".sticky-md").css("top",$(".bandeau").height()/2+"px"),$("#legende").css("bottom",$("#action-buttons").height()+"px")},e.setFocus=function(e,t){setTimeout(function(){$(e).focus()},t)},e.setFocusWhenContentIsLoaded=function(t,o){(e.accessibleMode?t:o).focus()},e.getAriaLabelForItemCorrection=function(t){return t?e.getLocalisedString("accessibility_activity_item_label_correct"):e.getLocalisedString("accessibility_activity_item_label_incorrect")},e.hexToRgba=function(e,t){if(e.length<6){var o=e.substr(1,1);e=e.padEnd(7,o)}var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgba("+parseInt(r[1],16)+","+parseInt(r[2],16)+","+parseInt(r[3],16)+","+t+")"},e.gameStarted=function(){if(void 0!==e.getChildScope())return e.getChildScope().gameStarted},e.correction=function(){if(void 0!==e.getChildScope())return e.getChildScope().correction},e.success=function(){if(void 0!==e.getChildScope())return e.getChildScope().success},e.init()}]),app.directive("iframeOnload",function(){return function(e,t,o){t.on("load",function(){e.iframeLoadedCallBack(t)})}}),goog.provide("MetaCore"),goog.require("solunea.meta.core.appRun"),goog.require("solunea.meta.controlers.appController"),goog.require("solunea.meta.controlers.ActController"),goog.require("solunea.meta.controlers.NavController"),goog.require("solunea.meta.controlers.LmsController"),MetaCore=function(){this.version="2.0"};
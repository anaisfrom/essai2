//Compilation du 17/03/2021 - 17:38:56
var COMPILED=false;var goog=goog||{};goog.global=this;goog.DEBUG=true;goog.LOCALE="en";goog.TRUSTED_SITE=true;goog.provide=function(name){if(!COMPILED){if(goog.isProvided_(name))throw Error('Namespace "'+name+'" already declared.');delete goog.implicitNamespaces_[name];var namespace=name;while(namespace=namespace.substring(0,namespace.lastIndexOf("."))){if(goog.getObjectByName(namespace))break;goog.implicitNamespaces_[namespace]=true}}goog.exportPath_(name)};
goog.setTestOnly=function(opt_message){if(COMPILED&&!goog.DEBUG){opt_message=opt_message||"";throw Error("Importing test-only code into non-debug environment"+opt_message?": "+opt_message:".");}};if(!COMPILED){goog.isProvided_=function(name){return!goog.implicitNamespaces_[name]&&!!goog.getObjectByName(name)};goog.implicitNamespaces_={}}
goog.exportPath_=function(name,opt_object,opt_objectToExportTo){var parts=name.split(".");var cur=opt_objectToExportTo||goog.global;if(!(parts[0]in cur)&&cur.execScript)cur.execScript("var "+parts[0]);for(var part;parts.length&&(part=parts.shift());)if(!parts.length&&goog.isDef(opt_object))cur[part]=opt_object;else if(cur[part])cur=cur[part];else cur=cur[part]={}};
goog.getObjectByName=function(name,opt_obj){var parts=name.split(".");var cur=opt_obj||goog.global;for(var part;part=parts.shift();)if(goog.isDefAndNotNull(cur[part]))cur=cur[part];else return null;return cur};goog.globalize=function(obj,opt_global){var global=opt_global||goog.global;for(var x in obj)global[x]=obj[x]};
goog.addDependency=function(relPath,provides,requires){if(!COMPILED){var provide,require;var path=relPath.replace(/\\/g,"/");var deps=goog.dependencies_;for(var i=0;provide=provides[i];i++){deps.nameToPath[provide]=path;if(!(path in deps.pathToNames))deps.pathToNames[path]={};deps.pathToNames[path][provide]=true}for(var j=0;require=requires[j];j++){if(!(path in deps.requires))deps.requires[path]={};deps.requires[path][require]=true}}};goog.ENABLE_DEBUG_LOADER=true;
goog.require=function(name){if(!COMPILED){if(goog.isProvided_(name))return;if(goog.ENABLE_DEBUG_LOADER){var path=goog.getPathFromDeps_(name);if(path){goog.included_[path]=true;goog.writeScripts_();return}}var errorMessage="goog.require could not find: "+name;if(goog.global.console)goog.global.console["error"](errorMessage);throw Error(errorMessage);}};goog.basePath="";goog.global.CLOSURE_BASE_PATH;goog.global.CLOSURE_NO_DEPS;goog.global.CLOSURE_IMPORT_SCRIPT;goog.nullFunction=function(){};
goog.identityFunction=function(opt_returnValue,var_args){return opt_returnValue};goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(ctor){ctor.getInstance=function(){if(ctor.instance_)return ctor.instance_;if(goog.DEBUG)goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=ctor;return ctor.instance_=new ctor}};goog.instantiatedSingletons_=[];
if(!COMPILED&&goog.ENABLE_DEBUG_LOADER){goog.included_={};goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}};goog.inHtmlDocument_=function(){var doc=goog.global.document;return typeof doc!="undefined"&&"write"in doc};goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH){goog.basePath=goog.global.CLOSURE_BASE_PATH;return}else if(!goog.inHtmlDocument_())return;var doc=goog.global.document;var scripts=doc.getElementsByTagName("script");for(var i=scripts.length-
1;i>=0;--i){var src=scripts[i].src;var qmark=src.lastIndexOf("?");var l=qmark==-1?src.length:qmark;if(src.substr(l-7,7)=="base.js"){goog.basePath=src.substr(0,l-7);return}}};goog.importScript_=function(src){var importScript=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;if(!goog.dependencies_.written[src]&&importScript(src))goog.dependencies_.written[src]=true};goog.writeScriptTag_=function(src){if(goog.inHtmlDocument_()){var doc=goog.global.document;if(doc.readyState=="complete"){var isDeps=
/\bdeps.js$/.test(src);if(isDeps)return false;else throw Error('Cannot write "'+src+'" after document load');}doc.write('<script type="text/javascript" src="'+src+'"></'+"script>");return true}else return false};goog.writeScripts_=function(){var scripts=[];var seenScript={};var deps=goog.dependencies_;function visitNode(path){if(path in deps.written)return;if(path in deps.visited){if(!(path in seenScript)){seenScript[path]=true;scripts.push(path)}return}deps.visited[path]=true;if(path in deps.requires)for(var requireName in deps.requires[path])if(!goog.isProvided_(requireName))if(requireName in
deps.nameToPath)visitNode(deps.nameToPath[requireName]);else throw Error("Undefined nameToPath for "+requireName);if(!(path in seenScript)){seenScript[path]=true;scripts.push(path)}}for(var path in goog.included_)if(!deps.written[path])visitNode(path);for(var i=0;i<scripts.length;i++)if(scripts[i])goog.importScript_(goog.basePath+scripts[i]);else throw Error("Undefined script input");};goog.getPathFromDeps_=function(rule){if(rule in goog.dependencies_.nameToPath)return goog.dependencies_.nameToPath[rule];
else return null};goog.findBasePath_();if(!goog.global.CLOSURE_NO_DEPS)goog.importScript_(goog.basePath+"deps.js")}
goog.typeOf=function(value){var s=typeof value;if(s=="object")if(value){if(value instanceof Array)return"array";else if(value instanceof Object)return s;var className=Object.prototype.toString.call((value));if(className=="[object Window]")return"object";if(className=="[object Array]"||typeof value.length=="number"&&typeof value.splice!="undefined"&&typeof value.propertyIsEnumerable!="undefined"&&!value.propertyIsEnumerable("splice"))return"array";if(className=="[object Function]"||typeof value.call!=
"undefined"&&typeof value.propertyIsEnumerable!="undefined"&&!value.propertyIsEnumerable("call"))return"function"}else return"null";else if(s=="function"&&typeof value.call=="undefined")return"object";return s};goog.isDef=function(val){return val!==undefined};goog.isNull=function(val){return val===null};goog.isDefAndNotNull=function(val){return val!=null};goog.isArray=function(val){return goog.typeOf(val)=="array"};
goog.isArrayLike=function(val){var type=goog.typeOf(val);return type=="array"||type=="object"&&typeof val.length=="number"};goog.isDateLike=function(val){return goog.isObject(val)&&typeof val.getFullYear=="function"};goog.isString=function(val){return typeof val=="string"};goog.isBoolean=function(val){return typeof val=="boolean"};goog.isNumber=function(val){return typeof val=="number"};goog.isFunction=function(val){return goog.typeOf(val)=="function"};
goog.isObject=function(val){var type=typeof val;return type=="object"&&val!=null||type=="function"};goog.getUid=function(obj){return obj[goog.UID_PROPERTY_]||(obj[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.removeUid=function(obj){if("removeAttribute"in obj)obj.removeAttribute(goog.UID_PROPERTY_);try{delete obj[goog.UID_PROPERTY_]}catch(ex){}};goog.UID_PROPERTY_="closure_uid_"+(Math.random()*1E9>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;
goog.cloneObject=function(obj){var type=goog.typeOf(obj);if(type=="object"||type=="array"){if(obj.clone)return obj.clone();var clone=type=="array"?[]:{};for(var key in obj)clone[key]=goog.cloneObject(obj[key]);return clone}return obj};goog.bindNative_=function(fn,selfObj,var_args){return(fn.call.apply(fn.bind,arguments))};
goog.bindJs_=function(fn,selfObj,var_args){if(!fn)throw new Error;if(arguments.length>2){var boundArgs=Array.prototype.slice.call(arguments,2);return function(){var newArgs=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(newArgs,boundArgs);return fn.apply(selfObj,newArgs)}}else return function(){return fn.apply(selfObj,arguments)}};
goog.bind=function(fn,selfObj,var_args){if(Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1)goog.bind=goog.bindNative_;else goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};goog.partial=function(fn,var_args){var args=Array.prototype.slice.call(arguments,1);return function(){var newArgs=Array.prototype.slice.call(arguments);newArgs.unshift.apply(newArgs,args);return fn.apply(this,newArgs)}};
goog.mixin=function(target,source){for(var x in source)target[x]=source[x]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(script){if(goog.global.execScript)goog.global.execScript(script,"JavaScript");else if(goog.global.eval){if(goog.evalWorksForGlobals_==null){goog.global.eval("var _et_ = 1;");if(typeof goog.global["_et_"]!="undefined"){delete goog.global["_et_"];goog.evalWorksForGlobals_=true}else goog.evalWorksForGlobals_=false}if(goog.evalWorksForGlobals_)goog.global.eval(script);else{var doc=goog.global.document;var scriptElt=doc.createElement("script");scriptElt.type="text/javascript";
scriptElt.defer=false;scriptElt.appendChild(doc.createTextNode(script));doc.body.appendChild(scriptElt);doc.body.removeChild(scriptElt)}}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;goog.cssNameMapping_;goog.cssNameMappingStyle_;
goog.getCssName=function(className,opt_modifier){var getMapping=function(cssName){return goog.cssNameMapping_[cssName]||cssName};var renameByParts=function(cssName){var parts=cssName.split("-");var mapped=[];for(var i=0;i<parts.length;i++)mapped.push(getMapping(parts[i]));return mapped.join("-")};var rename;if(goog.cssNameMapping_)rename=goog.cssNameMappingStyle_=="BY_WHOLE"?getMapping:renameByParts;else rename=function(a){return a};if(opt_modifier)return className+"-"+rename(opt_modifier);else return rename(className)};
goog.setCssNameMapping=function(mapping,opt_style){goog.cssNameMapping_=mapping;goog.cssNameMappingStyle_=opt_style};goog.global.CLOSURE_CSS_NAME_MAPPING;if(!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING)goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING;goog.getMsg=function(str,opt_values){var values=opt_values||{};for(var key in values){var value=(""+values[key]).replace(/\$/g,"$$$$");str=str.replace(new RegExp("\\{\\$"+key+"\\}","gi"),value)}return str};
goog.getMsgWithFallback=function(a,b){return a};goog.exportSymbol=function(publicPath,object,opt_objectToExportTo){goog.exportPath_(publicPath,object,opt_objectToExportTo)};goog.exportProperty=function(object,publicName,symbol){object[publicName]=symbol};goog.inherits=function(childCtor,parentCtor){function tempCtor(){}tempCtor.prototype=parentCtor.prototype;childCtor.superClass_=parentCtor.prototype;childCtor.prototype=new tempCtor;childCtor.prototype.constructor=childCtor};
goog.base=function(me,opt_methodName,var_args){var caller=arguments.callee.caller;if(caller.superClass_)return caller.superClass_.constructor.apply(me,Array.prototype.slice.call(arguments,1));var args=Array.prototype.slice.call(arguments,2);var foundCaller=false;for(var ctor=me.constructor;ctor;ctor=ctor.superClass_&&ctor.superClass_.constructor)if(ctor.prototype[opt_methodName]===caller)foundCaller=true;else if(foundCaller)return ctor.prototype[opt_methodName].apply(me,args);if(me[opt_methodName]===
caller)return me.constructor.prototype[opt_methodName].apply(me,args);else throw Error("goog.base called from a method of one name "+"to a method of a different name");};goog.scope=function(fn){fn.call(goog.global)};goog.provide("solunea.meta.util.Base64");var Base64={};Base64.code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
Base64.encode=function(str,utf8encode){utf8encode=typeof utf8encode=="undefined"?false:utf8encode;var o1,o2,o3,bits,h1,h2,h3,h4,e=[],pad="",c,plain,coded;var b64=Base64.code;plain=utf8encode?Utf8.encode(str):str;c=plain.length%3;if(c>0)while(c++<3){pad+="=";plain+="\x00"}for(c=0;c<plain.length;c+=3){o1=plain.charCodeAt(c);o2=plain.charCodeAt(c+1);o3=plain.charCodeAt(c+2);bits=o1<<16|o2<<8|o3;h1=bits>>18&63;h2=bits>>12&63;h3=bits>>6&63;h4=bits&63;e[c/3]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+
b64.charAt(h4)}coded=e.join("");coded=coded.slice(0,coded.length-pad.length)+pad;return coded};
Base64.decode=function(str,utf8decode){utf8decode=typeof utf8decode=="undefined"?false:utf8decode;var o1,o2,o3,h1,h2,h3,h4,bits,d=[],plain,coded;var b64=Base64.code;coded=utf8decode?Utf8.decode(str):str;if(coded==null)return coded;for(var c=0;c<coded.length;c+=4){h1=b64.indexOf(coded.charAt(c));h2=b64.indexOf(coded.charAt(c+1));h3=b64.indexOf(coded.charAt(c+2));h4=b64.indexOf(coded.charAt(c+3));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>>16&255;o2=bits>>>8&255;o3=bits&255;d[c/4]=String.fromCharCode(o1,
o2,o3);if(h4==64)d[c/4]=String.fromCharCode(o1,o2);if(h3==64)d[c/4]=String.fromCharCode(o1)}plain=d.join("");return utf8decode?Utf8.decode(plain):plain};Base64.isValid=function(pString){var base64regex=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;if(base64regex.test(pString))return true;return false};goog.provide("solunea.meta.util.Strings");solunea.meta.util.Strings=function(pFunc){this.func=pFunc};var Strings=solunea.meta.util.Strings;Strings.pad=function(str,max){str=str.toString();return str.length<max?Strings.pad("0"+str,max):str};goog.provide("solunea.meta.util.Utf8");var Utf8={};Utf8.encode=function(strUni){var strUtf=strUni.replace(/[\u0080-\u07ff]/g,function(c){var cc=c.charCodeAt(0);return String.fromCharCode(192|cc>>6,128|cc&63)});strUtf=strUtf.replace(/[\u0800-\uffff]/g,function(c){var cc=c.charCodeAt(0);return String.fromCharCode(224|cc>>12,128|cc>>6&63,128|cc&63)});return strUtf};
Utf8.decode=function(strUtf){var strUni=strUtf.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(c){var cc=(c.charCodeAt(0)&15)<<12|(c.charCodeAt(1)&63)<<6|c.charCodeAt(2)&63;return String.fromCharCode(cc)});strUni=strUni.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(c){var cc=(c.charCodeAt(0)&31)<<6|c.charCodeAt(1)&63;return String.fromCharCode(cc)});return strUni};goog.provide("solunea.meta.controlers.lms.Saver_scorm_12");goog.require("solunea.meta.util.Strings");goog.require("solunea.meta.util.Base64");goog.require("solunea.meta.util.Utf8");solunea.meta.controlers.lms.Saver_scorm_12=function(pTracker,pLMSController){this.tracker=pTracker;this.lmsController=pLMSController};var Saver_scorm_12=solunea.meta.controlers.lms.Saver_scorm_12;
Saver_scorm_12.prototype.saveProgression=function(){this.tracker.doLMSSetValue("cmi.core.lesson_location",this.lmsController.scope.currentContentID);var sessionTime=this.lmsController.scope.session_time;var totalTime=this.lmsController.scope.total_time+this.lmsController.scope.session_time;this.tracker.doLMSSetValue("cmi.core.session_time",this.formatTimeForScorm(sessionTime));this.tracker.doLMSSetValue("cmi.core.total_time",this.formatTimeForScorm(totalTime));if(this.lmsController.scope.navController.getProgression()==
100){this.tracker.doLMSSetValue("cmi.core.lesson_status","completed");this.tracker.doLMSSetValue("cmi.core.exit","")}else if(this.tracker.doLMSGetValue("cmi.core.lesson_status")!="completed"){this.tracker.doLMSSetValue("cmi.core.lesson_status","incomplete");this.tracker.doLMSSetValue("cmi.core.exit","suspend")}var suspendDataObj=[];var node=this.lmsController.scope.actController.getContentsNode();for(var i=0;i<node.length;i++){var content=node[i];var contentObj={};contentObj.id=content["@attributes"].id;
contentObj.s=content.seen;if(content.copiedFrom!=null)contentObj.cf=content.copiedFrom;if(content.score!=null){contentObj.sc=content.score;contentObj.scm=content.scoremax}suspendDataObj.push(contentObj)}if(this.lmsController.scope.actController.isRandomized(true)){var randomizeObj=[];var tree=this.lmsController.scope.actController.getContentsTreeNode();for(var i=0;i<tree.length;i++)randomizeObj.push(tree[i]["@attributes"].contentid);suspendDataObj.push(randomizeObj)}var jsonSuspendData=JSON.stringify(suspendDataObj);
if(jsonSuspendData.length>=4096)this.lmsController.scope.pushNotification(this.lmsController.scope.getLocalisedString("message_lms_error_4","modal"));this.tracker.doLMSSetValue("cmi.suspend_data",Base64.encode(jsonSuspendData,true));if(this.lmsController.commitEnabled)this.tracker.doLMSCommit();this.lmsController.handleError()};Saver_scorm_12.prototype.doLMSFinish=function(){this.tracker.doLMSFinish()};
Saver_scorm_12.prototype.forceCompleted=function(){this.tracker.doLMSSetValue("cmi.core.lesson_status","completed");this.tracker.doLMSSetValue("cmi.core.exit","");if(this.lmsController.commitEnabled)this.tracker.doLMSCommit();this.lmsController.handleError()};
Saver_scorm_12.prototype.retrieveProgression=function(){var totalTime=this.tracker.doLMSGetValue("cmi.core.total_time");this.lmsController.scope.total_time=parseInt(this.formatTimeFromScorm(totalTime));if(isNaN(this.lmsController.scope.total_time))this.lmsController.scope.total_time=0;if(this.tracker.doLMSGetValue("cmi.core.lesson_location")!=""){this.lmsController.scope.locationToRetrieve=this.tracker.doLMSGetValue("cmi.core.lesson_location");this.lmsController.isProgressionRetrieval=true}if(Base64.isValid(this.tracker.doLMSGetValue("cmi.suspend_data")))var jsonSuspendData=
Base64.decode(this.tracker.doLMSGetValue("cmi.suspend_data"),true);else var jsonSuspendData=this.tracker.doLMSGetValue("cmi.suspend_data");if(jsonSuspendData!=null&&jsonSuspendData!=""){this.lmsController.isProgressionRetrieval=true;var suspendDataObj=JSON.parse(jsonSuspendData);var node=this.lmsController.scope.actController.getContentsNode();for(var i=0;i<node.length;i++){var content=node[i];for(var j=0;j<suspendDataObj.length;j++){var contentSuspendData=suspendDataObj[j];if(contentSuspendData.id!=
null){if(content["@attributes"].id==contentSuspendData.id){if(contentSuspendData.sc!=null){content.score=parseInt(contentSuspendData.sc);content.scoremax=parseInt(contentSuspendData.scm)}if(contentSuspendData.s)content.seen=true;else content.seen=false}}else var randomAR=contentSuspendData}}for(var j=0;j<suspendDataObj.length;j++){var contentSuspendData=suspendDataObj[j];if(contentSuspendData.id!=null&&contentSuspendData.cf!=null){this.lmsController.scope.actController.copyContent(contentSuspendData.cf,
contentSuspendData.id);var content=this.lmsController.scope.navController.getContentByID(contentSuspendData.id);if(contentSuspendData.sc!=null){content.score=parseInt(contentSuspendData.sc);content.scoremax=parseInt(contentSuspendData.scm)}if(contentSuspendData.s)content.seen=true;else content.seen=false;if(contentSuspendData.backup!=null)content.backup=contentSuspendData.backup}}if(randomAR!=null)this.lmsController.scope.actController.replaceContents(randomAR)}this.lmsController.handleError()};
Saver_scorm_12.prototype.saveSuccess=function(){var themes=this.lmsController.scope.navController.getThemes();var globalScore=0;var globalScoreMax=0;for(var i=0;i<themes.length;i++)if(themes[i].score!=null){globalScore+=themes[i].score;globalScoreMax+=themes[i].scoremax}var scorePercent=globalScore*100/globalScoreMax;this.lmsController.searchMasteryScore();if(scorePercent<this.lmsController.mastery_score)this.tracker.doLMSSetValue("cmi.core.lesson_status","failed");else this.tracker.doLMSSetValue("cmi.core.lesson_status",
"passed");this.tracker.doLMSSetValue("cmi.core.score.min","0");this.tracker.doLMSSetValue("cmi.core.score.max","100");this.tracker.doLMSSetValue("cmi.core.score.raw",scorePercent);if(this.lmsController.commitEnabled)this.tracker.doLMSCommit();this.lmsController.handleError()};
Saver_scorm_12.prototype.formatTimeForScorm=function(pTime){var seconds=Strings.pad(Math.floor(pTime/1E3%60),2);var minutes=Strings.pad(Math.floor(pTime/1E3/60%60),2);var hours=Strings.pad(Math.floor(pTime/1E3/3600),4);return hours+":"+minutes+":"+seconds+".00"};
Saver_scorm_12.prototype.formatTimeFromScorm=function(pTime){pTime=pTime.split(":");var hours=0;hours=parseInt(pTime[0]);hours=hours*36E5;var minutes=0;minutes=parseInt(pTime[1]);minutes=minutes*6E4;var seconds=0;seconds=parseInt(pTime[2].split(".")[0]);seconds=seconds*1E3;return hours+minutes+seconds};
Saver_scorm_12.prototype.searchMasteryScore=function(){var mastery_score=this.tracker.doLMSGetValue("cmi.student_data.mastery_score");if(mastery_score=="not implemented"||mastery_score==""||typeof mastery_score=="undefined"){mastery_score=null;if(this.lmsController.scope.manifestJson!=null){var searchMastery=Objects.searchInObject(this.lmsController.scope.manifestJson,"adlcp:masteryscore");if(searchMastery.length>0){mastery_score=searchMastery[0]["@content"];mastery_score=parseFloat(mastery_score)}}if(mastery_score==
null||mastery_score==""){mastery_score=null;var attribute=this.lmsController.scope.actJson.act.contentsTree["@attributes"].masteryScore;if(attribute==null)mastery_score=50;else mastery_score=attribute}}else{mastery_score=parseFloat(mastery_score);if(mastery_score<=1)mastery_score=mastery_score*100}return mastery_score};Saver_scorm_12.prototype.fullSuspendDataSupport=function(){return true};
Saver_scorm_12.prototype.getCorrectResponses=function(pInteractionObject){var interactionArray=[];var correctResponses="";var arrayOfResponse=[];var learningData=pInteractionObject.learningData;switch(pInteractionObject.type){case "clcassification":for(var i=0;i<learningData.length;i++){var obj=learningData[i];arrayOfResponse.push(obj.key.split("_")[1]+"."+obj.correct.split("_")[2])}correctResponses=arrayOfResponse.join(",");interactionArray.push(correctResponses);break;case "matching":for(var i=
0;i<learningData.length;i++){var obj=learningData[i];arrayOfResponse.push(obj.key.split("_")[1]+"."+obj.correct[0].split("_")[1])}correctResponses=arrayOfResponse.join(",");interactionArray.push(correctResponses);break;case "circle":case "choice":$.each(learningData,function(key,value){if(value.correct)arrayOfResponse.push(value.key.split("_")[1])});correctResponses=arrayOfResponse.join(",");interactionArray.push(correctResponses);break;case "fill-in":for(var i=0;i<learningData.learnerResponses.length;i++){var obj=
learningData.learnerResponses[i];arrayOfResponse=[];for(var j=0;j<obj.correct.length;j++){var response=obj.correct[j];response=response.replace("[","").replace("]","");arrayOfResponse.push(response)}correctResponses=arrayOfResponse.join(" ");interactionArray.push(correctResponses)}break;default:break}return interactionArray};
Saver_scorm_12.prototype.getStudentResponses=function(pInteractionObject){var studentResponses="";var arrayOfResponse=[];var learningData=pInteractionObject.learningData;switch(pInteractionObject.type){case "matching":for(var i=0;i<learningData.length;i++){var obj=learningData[i];if(obj.dockedTo!==null)if(obj.dockedTo.length>0)if(Array.isArray(obj.dockedTo))arrayOfResponse.push(obj.key+"[.]"+obj.dockedTo[0]);else arrayOfResponse.push(obj.key+"[.]"+obj.dockedTo)}studentResponses=arrayOfResponse.join(",");
break;case "circle":case "choice":$.each(learningData,function(key,value){if(value.selected)arrayOfResponse.push(value.key.split("_")[1])});studentResponses=arrayOfResponse.join(",");break;case "fill-in":$.each(learningData.resultMap,function(key,value){arrayOfResponse.push(value)});studentResponses=arrayOfResponse.join(" ");break;default:break}return studentResponses};
Saver_scorm_12.prototype.getScormInteractionType=function(pInteractionObject){switch(pInteractionObject.type){case "classification":return"matching";break;case "circle":case "derouler":return"choice";break;default:return pInteractionObject.type}};
Saver_scorm_12.prototype.setInteraction=function(pInteractionObject){var content=this.lmsController.scope.navController.getContentByID(this.lmsController.scope.currentContentID);if(content.backup.count==null){var nextInteractionCount=parseInt(this.tracker.doLMSGetValue("cmi.interactions._count"));content.backup.count=nextInteractionCount}if(typeof this.lmsController.scope.navController.scope.currentContentParams.items!="undefined"){var list=[];angular.forEach(this.lmsController.scope.navController.scope.currentContentParams.items,
function(value,key){list.push({"id":key,"description":{"fr":typeof value.value!="undefined"?value.value:value.text}})});this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".choices",list)}if(typeof this.lmsController.scope.navController.scope.currentContentParams.anchors!="undefined"){var anchorsList=[];angular.forEach(this.lmsController.scope.navController.scope.currentContentParams.anchors,function(value,key){anchorsList.push({"id":key,"description":{"fr":typeof value.value!="undefined"?
value.value:value.text}})});this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".target",anchorsList)}this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".id",content.backup.id);this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".description",pInteractionObject.description);pInteractionObject.type=this.getScormInteractionType(pInteractionObject);this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".type",pInteractionObject.type);
var correctResponsesArray=this.getCorrectResponses(pInteractionObject);for(var i=0;i<correctResponsesArray.length;i++){var obj=correctResponsesArray[i];this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".correct_responses."+i+".pattern",obj)}this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".student_response",this.getStudentResponses(pInteractionObject));if(pInteractionObject.success)this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".result",
"correct");else if(pInteractionObject.success===false)this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".result","wrong");else this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".result","neutral");this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".latency",this.formatTimeForScorm(content.backup.time*1E3));if(this.lmsController.commitEnabled)this.tracker.doLMSCommit();this.lmsController.handleError()};goog.provide("solunea.meta.controlers.lms.LMS_INJECT");solunea.meta.controlers.lms.LMS_INJECT=function(){};var LMS_INJECT=solunea.meta.controlers.lms.LMS_INJECT;var syfadisSendRequestPromise=null;
var newSyfadisSendRequest=function(action,param){clearTimeout(syfadisSendRequestPromise);var syfadisSendRequestPromise=setTimeout(function(){alert(angular.element($(".body").get(0)).scope().getLocalisedString("message_lms_error_5_syfadis"))},3E4);this.enter2("sendRequest",action,param);var reqDoc=null;var soapActionURI=null;if(action=="Initialize"){soapActionURI="http://www.techniques.org/escorte4js/Initialize";reqDoc=this.newDocument(window.parent.SOAPENV_ENVELOPE);var soapBodyElm=this.newElement(window.parent.SOAPENV_BODY,
window.parent.SOAP_ENVELOPE_NS,reqDoc);reqDoc.documentElement.appendChild(soapBodyElm);var initElm=this.newElement("Initialize",window.parent.ESCORTE4JS_NS,reqDoc);soapBodyElm.appendChild(initElm);if(this.courseId||this.scoId||this.learnerId||this.sessionId){var es4js=this.newElement(window.parent.ESCORTE4JS,window.parent.ESCORTE4JS_NS,reqDoc);this.setAttribute(es4js,"course",this.courseId);this.setAttribute(es4js,"sco",this.scoId);this.setAttribute(es4js,"learner",this.learnerId);this.setAttribute(es4js,
"session",this.sessionId);initElm.appendChild(es4js)}}else if(action=="Terminate"){soapActionURI="http://www.techniques.org/escorte4js/Terminate";this.escorte4js=this.escorte4js.parentNode.removeChild(this.escorte4js);var terminateElm=this.newElement("Terminate",window.parent.ESCORTE4JS_NS);terminateElm.appendChild(this.escorte4js);var soapBodyElm=this.getElement(this.doc.documentElement,window.parent.SOAPENV_BODY);this.removeChildren(soapBodyElm);soapBodyElm.appendChild(terminateElm);this.setAttribute(this.escorte4js,
"course",this.courseId);this.setAttribute(this.escorte4js,"sco",this.scoId);this.setAttribute(this.escorte4js,"learner",this.learnerId);this.setAttribute(this.escorte4js,"session",this.sessionId);this.setAttribute(this.escorte4js,"adlNavRequest",this.adlNavRequest);reqDoc=this.doc}else if(action=="Commit"){soapActionURI="http://www.techniques.org/escorte4js/Commit";if(this.escorte4js.parentNode!=null)this.escorte4js=this.escorte4js.parentNode.removeChild(this.escorte4js);var commitElm=this.newElement("Commit",
window.parent.ESCORTE4JS_NS);commitElm.appendChild(this.escorte4js);var soapBodyElm=this.getElement(this.doc.documentElement,window.parent.SOAPENV_BODY);this.removeChildren(soapBodyElm);soapBodyElm.appendChild(commitElm);this.setAttribute(this.escorte4js,"course",this.courseId);this.setAttribute(this.escorte4js,"sco",this.scoId);this.setAttribute(this.escorte4js,"learner",this.learnerId);this.setAttribute(this.escorte4js,"session",this.sessionId);this.setAttribute(this.escorte4js,"adlNavRequest",
null);reqDoc=this.doc}else if(action=="Quit"){soapActionURI="http://www.techniques.org/escorte4js/Quit";reqDoc=this.newDocument(window.parent.SOAPENV_ENVELOPE);var soapBodyElm=this.newElement(window.parent.SOAPENV_BODY,window.parent.SOAP_ENVELOPE_NS,reqDoc);reqDoc.documentElement.appendChild(soapBodyElm);var quitElm=this.newElement("Quit",window.parent.ESCORTE4JS_NS,reqDoc);soapBodyElm.appendChild(quitElm);if(this.courseId||this.learnerId||this.sessionId){var es4js=this.newElement(window.parent.ESCORTE4JS,
window.parent.ESCORTE4JS_NS,reqDoc);this.setAttribute(es4js,"course",this.courseId);this.setAttribute(es4js,"learner",this.learnerId);this.setAttribute(es4js,"session",this.sessionId);quitElm.appendChild(es4js)}}var xmlHttpReq=this.msxmlHttpProgId!=null?new ActiveXObject(this.msxmlHttpProgId):new XMLHttpRequest;var parent=this;xmlHttpReq.onreadystatechange=function(){var isErrorCode=window.parent.isHttpErrorCode(xmlHttpReq.status);if(xmlHttpReq.readyState==4){clearTimeout(syfadisSendRequestPromise);
if(typeof angular.element($(".body").get(0)).scope()!="undefined")angular.element($(".body").get(0)).scope().lmsController.commitCallback();else{var scope=angular.element("#meta").scope();var tries=0;while(scope==null&&tries<500){tries++;setTimeout(function(){scope=angular.element("#meta")},100)}if(scope!==null)scope.lmsController.commitCallback();else document.getElementById("ctl00_TabContent_Main_WindowView_IFrameSco").contentWindow.angular.element("#meta").scope().lmsController.commitCallback()}if(parent.DEBUG){parent.debug2("Received HTTP POST response from ["+
parent.soapAddressLocation+"] : "+window.parent.trim(xmlHttpReq.responseText));var respDoc=xmlHttpReq.responseXML;if(parent.DEBUG&&action=="Initialize")window.parent.syfLogger.receive(respDoc.documentElement)}var respDoc=xmlHttpReq.responseXML;var soapBodyElm=parent.getElement(respDoc.documentElement,window.parent.SOAPENV_BODY);var soapFaultElm=parent.getElement(soapBodyElm,window.parent.SOAPENV_FAULT);if(soapFaultElm==null)if(action=="Initialize"){parent.doc=respDoc;parent.escorte4js=parent.getElement(soapBodyElm,
window.parent.ESCORTE4JS);if(parent.escorte4js==null)if(soapBodyElm.hasChildNodes())parent.escorte4js=parent.getElement(soapBodyElm.childNodes[0],window.parent.ESCORTE4JS);if(parent.escorte4js!=null){var attrNode=parent.escorte4js.getAttributeNode("sco");if(attrNode!=null)parent.scoId=String(attrNode.nodeValue);attrNode=parent.escorte4js.getAttributeNode("course");if(attrNode!=null)parent.courseId=String(attrNode.nodeValue);attrNode=parent.escorte4js.getAttributeNode("learner");if(attrNode!=null)parent.learnerId=
String(attrNode.nodeValue);attrNode=parent.escorte4js.getAttributeNode("session");if(attrNode!=null)parent.sessionId=String(attrNode.nodeValue);parent.cocd=parent.getElement(parent.escorte4js,"cocd");if(parent.cocd!=null)parent.errorCode=window.parent.NO_ERROR;else{parent.errorCode=window.parent.GENERAL_INITIALIZATION_FAILURE;parent.errorDiag="Initialize request failed missing cocd:cocd element in SOAP body; response from server: "+xmlHttpReq.responseText;parent.error(action,param,parent.errorDiag)}}else{parent.errorCode=
window.parent.GENERAL_INITIALIZATION_FAILURE;parent.errorDiag="Initialize request failed, missing escorte4js element in SOAP body; response from server: "+xmlHttpReq.responseText;parent.error(action,param,parent.errorDiag)}}else if(action=="Terminate")parent.errorCode=window.parent.NO_ERROR;else if(action=="Commit")parent.errorCode=window.parent.NO_ERROR;else{if(action=="Quit")parent.errorCode=window.parent.NO_ERROR}else{parent.errorCode=parent.getElementText(soapFaultElm,"faultcode");if(parent.errorCode.indexOf("es4js:")==
0)parent.errorCode=parent.errorCode.substring(6);parent.errorDiag=parent.getElementText(soapFaultElm,"faultstring");parent.error(action,param,"Failed to "+action+" on the server due to: "+trim(parent.errorDiag))}}else if(isErrorCode){if(action=="Initialize")parent.errorCode=window.parent.GENERAL_INITIALIZATION_FAILURE;else if(action=="Terminate")parent.errorCode=window.parent.GENERAL_TERMINATION_FAILURE;else if(action=="Commit")parent.errorCode=window.parent.GENERAL_COMMIT_FAILURE;else parent.errorCode=
window.parent.GENERAL_EXCEPTION;parent.errorDiag=action+" request failed; response from server: ("+xmlHttpReq.status+") "+xmlHttpReq.statusText;parent.error(action,param,parent.errorDiag);window.parent.ScormHelper.alertUser()}};xmlHttpReq.open("POST",this.soapAddressLocation,false);xmlHttpReq.setRequestHeader("Content-type","text/xml; charset=utf-8");if(soapActionURI!=null)xmlHttpReq.setRequestHeader("SOAPAction",soapActionURI);if(this.browserType=="SFR"||this.browserType=="CHR"){var xmlBuf=new window.parent.eSCORTE4JS_XMLBuf;
var xmlStr=xmlBuf.xml2str(reqDoc);if(this.DEBUG)this.debug2("Safari is Sending HTTP POST request to ["+this.soapAddressLocation+"] :"+xmlStr);xmlHttpReq.send(xmlStr)}else{var xmlToPost=reqDoc;if(this.msxmlHttpProgId!=null)xmlToPost=reqDoc.xml;xmlHttpReq.send(xmlToPost)}if(window.parent.syfadis.config.googleAnalytics&&window.parent.syfadis.config.googleAnalytics.playerErrorEnabled)window.parent.ga("send","event","player",action,xmlHttpReq.status);this.exit("sendRequest",action);return this.errorCode};goog.provide("solunea.meta.controlers.lms.API_SCORM_2004");goog.require("solunea.meta.controlers.lms.LMS_INJECT");
solunea.meta.controlers.lms.API_SCORM_2004=function(pCurrWindow,pAPIFinder){this.API_NAME="API_1484_11";this.LOGGER=console;this._NoError=0;this._GeneralException=101;this._GeneralInitializationFailure=102;this._AlreadyInitialized=103;this._ContentInstanceTerminated=104;this._GeneralTerminationFailure=111;this._TerminationBefInitialization=112;this._TerminationAftInitialization=113;this._RetrieveDataBefInitialization=122;this._RetrieveDataAftInitialization=123;this._StoreDataBefInitialization=132;
this._StoreDataAftInitialization=133;this._CommitBefInitialization=142;this._CommitAftInitialization=143;this._GeneralArgumentError=201;this._GeneralGetFailure=301;this._GeneralSetFailure=351;this._GeneralCommitFailure=391;this._UndefinedDataModelElement=401;this._DataModelElementValNotInitialized=403;this._DataModelElementIsReadOnly=404;this._DataModelElementIsWriteOnly=405;this._DataModelElementTypeMismatch=406;this._DataModelElementValOutOfRange=407;this.commitAvaiable=true;this.apiHandle=null;
this.API=null;this.findAPITries=0;this.refCurrWindow=null;if(pCurrWindow!=null)this.refCurrWindow=pCurrWindow;else this.displayError(0);this.apiFinder=null;if(pAPIFinder!=null){this.apiFinder=pAPIFinder;this.apiFinder.setAPIName(this.API_NAME)}else this.displayError(1)};var API_SCORM_2004=solunea.meta.controlers.lms.API_SCORM_2004;API_SCORM_2004.prototype.displayError=function(pError,pDebug){if(pDebug)console.log(pError);else{this.currentErrorCode=pError;this.errorState=true}};
API_SCORM_2004.prototype.doLMSInitialize=function(){var api=this.getAPIHandle();if(api==null){this.displayError(2);return"false"}if(window.parent.SYFADIS_API_OBJECT!=null)window.parent.SYFADIS_API_OBJECT.sendRequest=newSyfadisSendRequest;var result=api.Initialize("");if(result.toString()!="true")this.displayError(3);result=this.checkErrorMessage(result);return result};
API_SCORM_2004.prototype.doLMSFinish=function(){var api=this.getAPIHandle();if(api==null){this.displayError(2);return"false"}else{var result=api.Terminate("");if(result.toString()!="true")this.displayError(3);result=this.checkErrorMessage(result)}return result};
API_SCORM_2004.prototype.doLMSGetValue=function(name){var api=this.getAPIHandle();if(api==null){this.displayError(2);return""}else{var value=api.GetValue(name);var errCode=this.doLMSGetLastError();if(errCode!=this._NoError)this.displayError(3);else return value.toString()}};API_SCORM_2004.prototype.doLMSSetValue=function(name,value){var api=this.getAPIHandle();if(api==null){this.displayError(2);return}else{var result=api.SetValue(name,value);if(result.toString()!="true"){this.displayError(3);return}}return result.toString()};
API_SCORM_2004.prototype.doLMSCommit=function(){var api=this.getAPIHandle();if(api==null){this.displayError(2);return"false"}else{var result=api.Commit("");if(result!="true")this.displayError(3);else{this.commitAvaiable=false;var parent=this;clearTimeout(this.commitAvaiableTimer);this.commitAvaiableTimer=setTimeout(function(){parent.commitAvaiable=true},32E3);this.closeSendingDataToLMSModal(0)}result=this.checkErrorMessage(result)}return result};
API_SCORM_2004.prototype.closeSendingDataToLMSModal=function(calls){var nbMaxCalls=10;var _self=this;if($("#sendingDataToLMSModal").is(":visible"))setTimeout(function(){$("#sendingDataToLMSModal").modal("hide");_self.closeSendingDataToLMSModal(0)},250);else if(calls<nbMaxCalls){calls++;setTimeout(function(){_self.closeSendingDataToLMSModal(calls)},250)}};API_SCORM_2004.prototype.isCommitAvaiable=function(){return this.commitAvaiable};
API_SCORM_2004.prototype.doLMSGetLastError=function(){var api=this.getAPIHandle();if(api==null){this.displayError(2);return"false"}return api.GetLastError().toString()};API_SCORM_2004.prototype.doLMSGetErrorString=function(errorCode){var api=this.getAPIHandle();if(api==null){this.displayError(2);return"false"}return api.GetErrorString(errorCode).toString()};API_SCORM_2004.prototype.doLMSGetDiagnostic=function(errorCode){var api=this.getAPIHandle();if(api==null)this.displayError(2);return api.GetDiagnostic(errorCode).toString()};
API_SCORM_2004.prototype.LMSIsInitialized=function(){var api=this.getAPIHandle();if(api==null){this.displayError(2);return false}else{var value=api.GetValue("cmi.learner_name");var errCode=api.GetLastError().toString();if(errCode==this._NotInitialized)return false;else return true}};
API_SCORM_2004.prototype.errorHandler=function(){var api=this.getAPIHandle();if(api==null){this.displayError(2);return}var errCode=this.doLMSGetLastError();if(errCode!=this._NoError){var errDescription=this.doLMSGetErrorString(errCode);errDescription+="\n";errDescription+=this.doLMSGetDiagnostic(errCode);this.displayError(3)}return errCode};API_SCORM_2004.prototype.getAPIHandle=function(){if(this.apiHandle==null)this.apiHandle=this.apiFinder.getAPI(this.refCurrWindow);return this.apiHandle};
API_SCORM_2004.prototype.checkErrorMessage=function(pMessage){if(pMessage.indexOf("true")!=-1)return"true";else return"false"};API_SCORM_2004.prototype.toString=function(){return"[API_SCORM_2004]"};goog.provide("solunea.meta.controlers.lms.Saver_scorm_local");solunea.meta.controlers.lms.Saver_scorm_local=function(pLMSController){this.lmsController=pLMSController};var Saver_scorm_local=solunea.meta.controlers.lms.Saver_scorm_local;Saver_scorm_local.prototype.saveProgression=function(){};Saver_scorm_local.prototype.retrieveProgression=function(){};Saver_scorm_local.prototype.saveSuccess=function(){};
Saver_scorm_local.prototype.formatTimeForScorm=function(pTime){var seconds=Math.floor(pTime/1E3%60);var minutes=Math.floor(pTime/1E3/60%60);var hours=Math.floor(pTime/1E3/3600);var scormTime="PT";if(pTime>0){if(hours>0)scormTime=scormTime+hours+"H";if(minutes>0)scormTime=scormTime+minutes+"M";if(seconds>=0)scormTime=scormTime+seconds+"S"}else scormTime=scormTime+"0S";return scormTime};
Saver_scorm_local.prototype.formatTimeFromScorm=function(pTime){var tIdx=pTime.indexOf("T");if(tIdx>-1){var tPeriod=pTime.substr(tIdx+1);var h=null;var m=null;var s=null;var tmpNumChars="";var i=0;var nbChars=pTime.length;while(i<nbChars){var character=pTime.substr(i,1);if(isNaN(character)){switch(character){case "h":case "H":h=tmpNumChars;break;case "n":case "M":m=tmpNumChars;break;case "s":case "S":s=tmpNumChars;break}tmpNumChars=""}else tmpNumChars=tmpNumChars+character;i++}}var hours=0;if(h!=
null){hours=parseInt(h);hours=hours*36E5}var minutes=0;if(m!=null){minutes=parseInt(m);minutes=minutes*6E4}var seconds=0;if(s!=null){seconds=parseInt(s);seconds=seconds*1E3}return hours+minutes+seconds};
Saver_scorm_local.prototype.searchMasteryScore=function(){var mastery_score=null;if(this.lmsController.scope.manifestJson!=null){var searchMastery=Objects.searchInObject(this.lmsController.scope.manifestJson,"imsss:minNormalizedMeasure");if(searchMastery.length>0){mastery_score=searchMastery[0]["@content"];mastery_score=parseFloat(mastery_score)*100}}if((mastery_score==null||mastery_score=="")&&this.lmsController.scope.manifestJson!=null){var searchMastery=Objects.searchInObject(this.lmsController.scope.manifestJson,
"adlcp:masteryscore");if(searchMastery.length>0){mastery_score=searchMastery[0]["@content"];mastery_score=parseFloat(mastery_score)}}if(mastery_score==null||mastery_score==""){mastery_score=null;var attribute=this.lmsController.scope.actJson.act.contentsTree["@attributes"].masteryScore;if(attribute==null)mastery_score=50;else mastery_score=attribute}return mastery_score};Saver_scorm_local.prototype.fullSuspendDataSupport=function(){return false};Saver_scorm_local.prototype.setInteraction=function(pInteractionObject){};goog.provide("solunea.meta.util.Objects");solunea.meta.util.Objects=function(pFunc){this.func=pFunc};var Objects=solunea.meta.util.Objects;Objects.searchInObject=function(obj,key){var objects=[];for(var i in obj){if(!obj.hasOwnProperty(i))continue;if(i==key)objects.push(obj[i]);else if(typeof obj[i]=="object")objects=objects.concat(Objects.searchInObject(obj[i],key))}return objects};goog.provide("solunea.meta.util.Delegate");solunea.meta.util.Delegate=function(pFunc){this.func=pFunc};var Delegate=solunea.meta.util.Delegate;Delegate.prototype.createDelegate=function(pObj){return Delegate.create(pObj,this.func)};Delegate.create=function(pObj,pFunc){var f=function(){var target=arguments.callee.target;var func=arguments.callee.func;return func.apply(target,arguments)};f.target=pObj;f.func=pFunc;return f};goog.provide("solunea.meta.controlers.lms.API_SCORM_FINDER");solunea.meta.controlers.lms.API_SCORM_FINDER=function(){this._API_NAME=null};var API_SCORM_FINDER=solunea.meta.controlers.lms.API_SCORM_FINDER;API_SCORM_FINDER.prototype.findAPIinFrame=function(win){var frameAPI=null;if(win.length>0)for(var i=0;i<win.length;i++){var winframe=win.frames[i];if(winframe[this._API_NAME]!=null){frameAPI=winframe;break}}return frameAPI};
API_SCORM_FINDER.prototype.findAPI=function(win){var theAPI=win[this._API_NAME];if(theAPI==null){var winFrame=this.findAPIinFrame(win);if(winFrame!=null)theAPI=winFrame[this._API_NAME]}return theAPI};
API_SCORM_FINDER.prototype.find=function(win){var theAPI=null;theAPI=this.findAPI(win);if(theAPI==null)if(win.parent!=null&&win.parent!=win){this.findAPIParent++;if(this.findAPIParent>7)alert("Error finding API -- too deeply nested parent.");else theAPI=this.find(win.parent)}if(theAPI==null)if(win.opener!=null&&win.opener!=win){this.findAPIOpener++;if(this.findAPIOpener>7)alert("Error finding API -- too deeply nested opener.");else theAPI=this.find(win.opener)}return theAPI};
API_SCORM_FINDER.prototype.getAPI=function(pFromWindow){this.findAPIParent=0;this.findAPIOpener=0;var theAPI=null;if(this._API_NAME!=null)if(pFromWindow!=null)theAPI=this.find(pFromWindow);else alert("API_SCORM.getAPI(); - window reference missing");else alert("API_SCORM.getAPI(); - API name missing");return theAPI};API_SCORM_FINDER.prototype.setAPIName=function(name){this._API_NAME=name};goog.provide("solunea.meta.controlers.lms.Saver_scorm_2004");goog.require("solunea.meta.util.Base64");solunea.meta.controlers.lms.Saver_scorm_2004=function(pTracker,pLMSController){this.tracker=pTracker;this.lmsController=pLMSController};var Saver_scorm_2004=solunea.meta.controlers.lms.Saver_scorm_2004;
Saver_scorm_2004.prototype.saveProgression=function(){this.tracker.doLMSSetValue("cmi.location",this.lmsController.scope.currentContentID);var sessionTime=this.lmsController.scope.session_time;var totalTime=this.lmsController.scope.total_time+this.lmsController.scope.session_time;this.tracker.doLMSSetValue("cmi.session_time",this.formatTimeForScorm(sessionTime));this.tracker.doLMSSetValue("cmi.total_time",this.formatTimeForScorm(totalTime));var condition;if(this.lmsController.scope.completionMode===
"completeIfFailed")condition=this.lmsController.scope.navController.getProgression()==100;else if(this.lmsController.scope.completionMode==="incompleteIfFailed")condition=this.tracker.doLMSGetValue("cmi.success_status")=="passed";if(condition){this.tracker.doLMSSetValue("cmi.completion_status","completed");this.tracker.doLMSSetValue("cmi.exit","suspend")}else{var completion=this.tracker.doLMSGetValue("cmi.success_status")=="passed"?"completed":"incomplete";this.tracker.doLMSSetValue("cmi.completion_status",
completion);this.tracker.doLMSSetValue("cmi.exit","suspend")}var quiz=this.lmsController.scope.navController.getQuiz();if(quiz.length==0){if(this.lmsController.scope.completionMode==="incompleteIfFailed"&&this.lmsController.scope.navController.getProgression()==100)this.tracker.doLMSSetValue("cmi.completion_status","completed");this.tracker.doLMSSetValue("cmi.success_status","unknown")}else if(this.tracker.doLMSGetValue("cmi.success_status")!="passed"&&this.tracker.doLMSGetValue("cmi.success_status")!=
"failed")this.tracker.doLMSSetValue("cmi.success_status","unknown");var suspendDataObj=[];var node=this.lmsController.scope.actController.getContentsNode();for(var i=0;i<node.length;i++){var content=node[i];var contentObj={};contentObj.id=content["@attributes"].id;contentObj.s=content.seen;if(content.copiedFrom!=null)contentObj.cf=content.copiedFrom;if(content.score!=null){contentObj.sc=content.score;contentObj.scm=content.scoremax}if(content.backup!=null)contentObj.backup=content.backup;suspendDataObj.push(contentObj)}if(this.lmsController.scope.actController.isRandomized(true)){var randomizeObj=
[];var tree=this.lmsController.scope.actController.getContentsTreeNode();for(var i=0;i<tree.length;i++)randomizeObj.push(tree[i]["@attributes"].contentid);suspendDataObj.push(randomizeObj)}var jsonSuspendData=JSON.stringify(suspendDataObj);this.tracker.doLMSSetValue("cmi.suspend_data",Base64.encode(jsonSuspendData,true));if(this.lmsController.commitEnabled)this.tracker.doLMSCommit();this.lmsController.handleError()};Saver_scorm_2004.prototype.doLMSFinish=function(){this.tracker.doLMSFinish()};
Saver_scorm_2004.prototype.forceCompleted=function(){if(this.lmsController.scope.completionMode==="completeIfFailed"){this.tracker.doLMSSetValue("cmi.completion_status","completed");this.tracker.doLMSSetValue("cmi.exit","suspend");if(this.lmsController.commitEnabled)this.tracker.doLMSCommit();this.lmsController.handleError()}else if(this.lmsController.scope.completionMode==="incompleteIfFailed");};
Saver_scorm_2004.prototype.retrieveProgression=function(){var totalTime=this.tracker.doLMSGetValue("cmi.total_time");this.lmsController.scope.total_time=parseInt(this.formatTimeFromScorm(totalTime));if(isNaN(this.lmsController.scope.total_time))this.lmsController.scope.total_time=0;if(this.tracker.doLMSGetValue("cmi.location")!=""){this.lmsController.scope.locationToRetrieve=this.tracker.doLMSGetValue("cmi.location");this.lmsController.isProgressionRetrieval=true}if(Base64.isValid(this.tracker.doLMSGetValue("cmi.suspend_data")))var jsonSuspendData=
Base64.decode(this.tracker.doLMSGetValue("cmi.suspend_data"),true);else var jsonSuspendData=this.tracker.doLMSGetValue("cmi.suspend_data");if(jsonSuspendData!=null&&jsonSuspendData!=""){this.lmsController.isProgressionRetrieval=true;var suspendDataObj=JSON.parse(jsonSuspendData);var node=this.lmsController.scope.actController.getContentsNode();for(var i=0;i<node.length;i++){var content=node[i];for(var j=0;j<suspendDataObj.length;j++){var contentSuspendData=suspendDataObj[j];if(contentSuspendData.id!=
null){if(contentSuspendData.id!=null&&content["@attributes"].id==contentSuspendData.id){if(contentSuspendData.sc!=null){content.score=parseInt(contentSuspendData.sc);content.scoremax=parseInt(contentSuspendData.scm)}if(contentSuspendData.s)content.seen=true;else content.seen=false;if(contentSuspendData.backup!=null)content.backup=contentSuspendData.backup}}else var randomAR=contentSuspendData}}for(var j=0;j<suspendDataObj.length;j++){var contentSuspendData=suspendDataObj[j];if(contentSuspendData.id!=
null&&contentSuspendData.cf!=null){this.lmsController.scope.actController.copyContent(contentSuspendData.cf,contentSuspendData.id);var content=this.lmsController.scope.navController.getContentByID(contentSuspendData.id);if(contentSuspendData.sc!=null){content.score=parseInt(contentSuspendData.sc);content.scoremax=parseInt(contentSuspendData.scm)}if(contentSuspendData.s)content.seen=true;else content.seen=false;if(contentSuspendData.backup!=null)content.backup=contentSuspendData.backup}}if(randomAR!=
null)this.lmsController.scope.actController.replaceContents(randomAR)}this.lmsController.handleError()};
Saver_scorm_2004.prototype.saveSuccess=function(){var themes=this.lmsController.scope.navController.getThemes();var globalScore=0;var globalScoreMax=0;for(var i=0;i<themes.length;i++)if(themes[i].score!=null){globalScore+=themes[i].score;globalScoreMax+=themes[i].scoremax}var scorePercent=globalScore*100/globalScoreMax;this.lmsController.searchMasteryScore();if(scorePercent<this.lmsController.mastery_score)this.tracker.doLMSSetValue("cmi.success_status","failed");else this.tracker.doLMSSetValue("cmi.success_status",
"passed");this.tracker.doLMSSetValue("cmi.score.min","0");this.tracker.doLMSSetValue("cmi.score.max","100");this.tracker.doLMSSetValue("cmi.score.raw",scorePercent);this.tracker.doLMSSetValue("cmi.score.scaled",(scorePercent/100).toFixed(2));if(this.lmsController.commitEnabled)this.tracker.doLMSCommit();this.lmsController.handleError()};
Saver_scorm_2004.prototype.formatTimeForScorm=function(pTime){var seconds=Math.floor(pTime/1E3%60);var minutes=Math.floor(pTime/1E3/60%60);var hours=Math.floor(pTime/1E3/3600);var scormTime="PT";if(pTime>0){if(hours>0)scormTime=scormTime+hours+"H";if(minutes>0)scormTime=scormTime+minutes+"M";if(seconds>=0)scormTime=scormTime+seconds+"S"}else scormTime=scormTime+"0S";return scormTime};
Saver_scorm_2004.prototype.formatTimeFromScorm=function(pTime){var tIdx=pTime.indexOf("T");if(tIdx>-1){var tPeriod=pTime.substr(tIdx+1);var h=null;var m=null;var s=null;var tmpNumChars="";var i=0;var nbChars=pTime.length;while(i<nbChars){var character=pTime.substr(i,1);if(isNaN(character)){switch(character){case "h":case "H":h=tmpNumChars;break;case "n":case "M":m=tmpNumChars;break;case "s":case "S":s=tmpNumChars;break}tmpNumChars=""}else tmpNumChars=tmpNumChars+character;i++}}var hours=0;if(h!=null){hours=
parseInt(h);hours=hours*36E5}var minutes=0;if(m!=null){minutes=parseInt(m);minutes=minutes*6E4}var seconds=0;if(s!=null){seconds=parseInt(s);seconds=seconds*1E3}return hours+minutes+seconds};
Saver_scorm_2004.prototype.searchMasteryScore=function(){var mastery_score=this.tracker.doLMSGetValue("cmi.scaled_passing_score");if(mastery_score=="not implemented"||mastery_score==""||typeof mastery_score=="undefined"){mastery_score=null;if(this.lmsController.scope.manifestJson!=null){var searchMastery=Objects.searchInObject(this.lmsController.scope.manifestJson,"imsss:minNormalizedMeasure");if(searchMastery.length>0){mastery_score=searchMastery[0]["@content"];mastery_score=parseFloat(mastery_score)*
100}}if(mastery_score==null||mastery_score==""){mastery_score=null;var attribute=this.lmsController.scope.actJson.act.contentsTree["@attributes"].masteryScore;if(attribute==null)mastery_score=50;else mastery_score=attribute}}else{mastery_score=parseFloat(mastery_score);if(mastery_score<=1)mastery_score=mastery_score*100}return mastery_score};Saver_scorm_2004.prototype.fullSuspendDataSupport=function(){return true};
Saver_scorm_2004.prototype.getCorrectResponses=function(pInteractionObject){var interactionArray=[];var correctResponses="";var arrayOfResponse=[];var learningData=pInteractionObject.learningData;switch(pInteractionObject.type){case "classification":for(var i=0;i<learningData.length;i++){var obj=learningData[i];arrayOfResponse.push(obj.key+"[.]"+obj.correct)}correctResponses=arrayOfResponse.join("[,]");interactionArray.push(correctResponses);break;case "matching":for(var i=0;i<learningData.length;i++){var obj=
learningData[i];arrayOfResponse.push(obj.key+"[.]"+obj.correct[0])}correctResponses=arrayOfResponse.join("[,]");interactionArray.push(correctResponses);break;case "circle":case "choice":$.each(learningData,function(key,value){if(value.correct)arrayOfResponse.push(value.key)});correctResponses=arrayOfResponse.join("[,]");interactionArray.push(correctResponses);break;case "fill-in":var correctResponsesArray=[];for(var i=0;i<learningData.learnerResponses.length;i++){var obj=learningData.learnerResponses[i];
arrayOfResponse=[];for(var j=0;j<obj.correct.length;j++){var response=obj.correct[j];response=response.replace("[","").replace("]","");arrayOfResponse.push(response)}correctResponses=arrayOfResponse.join("|#|");correctResponsesArray.push(correctResponses)}interactionArray.push("{case_matters:"+learningData.useCase+"}"+correctResponsesArray.join("[,]"));break;default:break}return interactionArray};
Saver_scorm_2004.prototype.getStudentResponses=function(pInteractionObject){var studentResponses="";var arrayOfResponse=[];var learningData=pInteractionObject.learningData;switch(pInteractionObject.type){case "matching":for(var i=0;i<learningData.length;i++){var obj=learningData[i];if(obj.dockedTo!==null)if(obj.dockedTo.length>0)if(Array.isArray(obj.dockedTo))arrayOfResponse.push(obj.key+"[.]"+obj.dockedTo[0]);else arrayOfResponse.push(obj.key+"[.]"+obj.dockedTo)}studentResponses=arrayOfResponse.join("[,]");
break;case "circle":case "choice":$.each(learningData,function(key,value){if(value.selected)arrayOfResponse.push(value.key)});studentResponses=arrayOfResponse.join("[,]");break;case "fill-in":$.each(learningData.resultMap,function(key,value){arrayOfResponse.push(value)});studentResponses=arrayOfResponse.join("[,]");studentResponses="{case_matters:"+learningData.useCase+"}"+studentResponses;break;default:break}return studentResponses};
Saver_scorm_2004.prototype.getScormInteractionType=function(pInteractionObject){switch(pInteractionObject.type){case "classification":return"matching";break;case "circle":case "derouler":return"choice";break;default:return pInteractionObject.type}};
Saver_scorm_2004.prototype.setInteraction=function(pInteractionObject){var content=this.lmsController.scope.navController.getContentByID(this.lmsController.scope.currentContentID);if(content.backup.count==null){var nextInteractionCount=parseInt(this.tracker.doLMSGetValue("cmi.interactions._count"));content.backup.count=nextInteractionCount}if(typeof this.lmsController.scope.navController.scope.currentContentParams.items!="undefined"){var list=[];angular.forEach(this.lmsController.scope.navController.scope.currentContentParams.items,
function(value,key){list.push({"id":key,"description":{"fr":typeof value.value!="undefined"?value.value:value.text}})});this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".choices",list)}if(typeof this.lmsController.scope.navController.scope.currentContentParams.anchors!="undefined"){var anchorsList=[];angular.forEach(this.lmsController.scope.navController.scope.currentContentParams.anchors,function(value,key){anchorsList.push({"id":key,"description":{"fr":typeof value.value!="undefined"?
value.value:value.text}})});this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".target",anchorsList)}this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".id",content.backup.id);this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".description",pInteractionObject.description);pInteractionObject.type=this.getScormInteractionType(pInteractionObject);this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".type",pInteractionObject.type);
var correctResponsesArray=this.getCorrectResponses(pInteractionObject);for(var i=0;i<correctResponsesArray.length;i++){var obj=correctResponsesArray[i];this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".correct_responses."+i+".pattern",obj)}this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".learner_response",this.getStudentResponses(pInteractionObject));if(pInteractionObject.success)this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".result",
"correct");else if(pInteractionObject.success===false)this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".result","incorrect");else this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".result","neutral");this.tracker.doLMSSetValue("cmi.interactions."+content.backup.count+".latency",this.formatTimeForScorm(content.backup.time*1E3));if(this.lmsController.commitEnabled)this.tracker.doLMSCommit();this.lmsController.handleError()};goog.provide("solunea.meta.controlers.lms.API_SCORM_12");
solunea.meta.controlers.lms.API_SCORM_12=function(pCurrWindow,pAPIFinder){this.API_NAME="API";this.LOGGER=console;this._NoError=0;this._GeneralException=101;this._ServerBusy=102;this._InvalidArgumentError=201;this._ElementCannotHaveChildren=202;this._ElementIsNotAnArray=203;this._NotInitialized=301;this._NotImplementedError=401;this._InvalidSetValue=402;this._ElementIsReadOnly=403;this._ElementIsWriteOnly=404;this._IncorrectDataType=405;this.commitAvaiable=true;this.apiHandle=null;this.API=null;this.findAPITries=
0;this.refCurrWindow=null;if(pCurrWindow!=null)this.refCurrWindow=pCurrWindow;else this.displayError("# API_SCORM_12(); - r\ufffdf\ufffdrence vers la fen\ufffdtre courante manquante - impossible de localiser l'API de communication");this.apiFinder=null;if(pAPIFinder!=null){this.apiFinder=pAPIFinder;this.apiFinder.setAPIName(this.API_NAME)}else this.displayError("# API_SCORM_12(); - l'api Finder est manquant - impossible de localiser l'API de communication")};var API_SCORM_12=solunea.meta.controlers.lms.API_SCORM_12;
API_SCORM_12.prototype.displayError=function(pError,pDebug){if(pDebug)console.log(pError);else{this.currentErrorCode=pError;this.errorState=true}};API_SCORM_12.prototype.doLMSInitialize=function(){var api=this.getAPIHandle();if(api==null){this.displayError(2);return"false"}if(window.parent.SYFADIS_API_OBJECT!=null)window.parent.SYFADIS_API_OBJECT.sendRequest=newSyfadisSendRequest;var result=api.LMSInitialize("");if(result.toString()!="true")this.displayError(3);return result.toString()};
API_SCORM_12.prototype.doLMSFinish=function(){var api=this.getAPIHandle();if(api==null){this.displayError(2);return"false"}else{var result=api.LMSFinish("");if(result.toString()!="true")this.displayError(3)}return result.toString()};API_SCORM_12.prototype.doLMSGetValue=function(name){var api=this.getAPIHandle();if(api==null){this.displayError(2);return"false"}else{var value=api.LMSGetValue(name);var errCode=this.doLMSGetLastError();if(errCode!=this._NoError){this.displayError(3);return"false"}else return value.toString()}};
API_SCORM_12.prototype.doLMSSetValue=function(name,value){var api=this.getAPIHandle();if(api==null){this.displayError(2);return"false"}else{var words=name.split(".");if(words[1]==="interactions"&&words[3]==="description")return true;else{var result=api.LMSSetValue(name,value);if(result.toString()!="true"){this.displayError(3);return"false"}}}return result.toString()};
API_SCORM_12.prototype.doLMSCommit=function(){var api=this.getAPIHandle();if(api==null){this.displayError(2);return"false"}else{var result=api.LMSCommit("");if(result!="true"){this.displayError(3);return"false"}else{this.commitAvaiable=false;var parent=this;clearTimeout(this.commitAvaiableTimer);this.commitAvaiableTimer=setTimeout(function(){parent.commitAvaiable=true},32E3);this.closeSendingDataToLMSModal(0)}}return result.toString()};
API_SCORM_12.prototype.closeSendingDataToLMSModal=function(calls){var nbMaxCalls=10;var _self=this;if($("#sendingDataToLMSModal").is(":visible"))setTimeout(function(){$("#sendingDataToLMSModal").modal("hide");_self.closeSendingDataToLMSModal(0)},250);else if(calls<nbMaxCalls){calls++;setTimeout(function(){_self.closeSendingDataToLMSModal(calls)},250)}};API_SCORM_12.prototype.isCommitAvaiable=function(){return this.commitAvaiable};
API_SCORM_12.prototype.doLMSGetLastError=function(){var api=this.getAPIHandle();if(api==null){this.displayError(2);return"false"}return api.LMSGetLastError().toString()};API_SCORM_12.prototype.doLMSGetErrorString=function(errorCode){var api=this.getAPIHandle();if(api==null){this.displayError(2);return"false"}return api.LMSGetErrorString(errorCode).toString()};API_SCORM_12.prototype.doLMSGetDiagnostic=function(errorCode){var api=this.getAPIHandle();if(api==null){this.displayError(2);return"false"}return api.LMSGetDiagnostic(errorCode).toString()};
API_SCORM_12.prototype.LMSIsInitialized=function(){var api=this.getAPIHandle();if(api==null){this.displayError(2);return"false"}else{var value=api.LMSGetValue("cmi.core.student_name");var errCode=this.doLMSGetLastError();if(errCode==this._NotInitialized)return false;else return true}};
API_SCORM_12.prototype.errorHandler=function(){var api=this.getAPIHandle();if(api==null){this.displayError(2);return}var errCode=this.doLMSGetLastError();if(errCode!=this._NoError){var errDescription=this.doLMSGetErrorString(errCode);errDescription+="\n";errDescription+=this.doLMSGetDiagnostic(errCode);this.displayError(3)}return errCode};API_SCORM_12.prototype.getAPIHandle=function(){if(this.apiHandle==null)this.apiHandle=this.apiFinder.getAPI(this.refCurrWindow);return this.apiHandle};
API_SCORM_12.prototype.toString=function(){return"[API_SCORM_12]"};goog.provide("solunea.meta.controlers.LmsController");goog.require("solunea.meta.controlers.lms.API_SCORM_2004");goog.require("solunea.meta.controlers.lms.API_SCORM_12");goog.require("solunea.meta.controlers.lms.API_SCORM_FINDER");goog.require("solunea.meta.controlers.lms.Saver_scorm_2004");goog.require("solunea.meta.controlers.lms.Saver_scorm_12");goog.require("solunea.meta.controlers.lms.Saver_scorm_local");goog.require("solunea.meta.util.Delegate");goog.require("solunea.meta.util.Objects");
solunea.meta.controlers.LmsController=function(pScope){this.scope=pScope};var LmsController=solunea.meta.controlers.LmsController;
LmsController.prototype.init=function(pLMSActivated,pLMSType){this.lmsActivated=pLMSActivated;this.lmsType=pLMSType;this.isProgressionRetrieval=false;this.enableCommit(true);if(this.lmsActivated){this.scope.pushNotification(this.scope.getLocalisedString("message_connection_lms"),"modal");switch(this.lmsType){case "scorm_2004":this.tracker=new API_SCORM_2004(window,new API_SCORM_FINDER);this.saver=new Saver_scorm_2004(this.tracker,this);if(this.tracker.doLMSInitialize()=="false"){if(confirm(this.scope.getLocalisedString("message_no_lms"))){this.init(!this.scope.scorm,
this.lmsType);this.scope.$apply()}}else this.waitForLMS();break;case "scorm_12":this.tracker=new API_SCORM_12(window,new API_SCORM_FINDER);this.saver=new Saver_scorm_12(this.tracker,this);if(this.tracker.doLMSInitialize()=="false"){if(confirm(this.scope.getLocalisedString("message_no_lms"))){this.init(!this.scope.scorm,this.lmsType);this.scope.$apply()}}else this.waitForLMS();break;default:this.lmsActivated=false;this.saver=new Saver_scorm_local(this);this.scope.pushNotification(this.scope.getLocalisedString("message_connection_lms_unknown"),
"modal")}}else{this.saver=new Saver_scorm_local(this);this.scope.startSessionTimer();this.scope.closeNotification();this.searchMasteryScore();this.scope.onLMSInited()}};LmsController.prototype.waitForLMS=function(){if(!this.handleError())if(this.tracker.LMSIsInitialized()){this.scope.startSessionTimer();this.scope.closeNotification();this.searchMasteryScore();this.scope.onLMSInited()}else setTimeout(Delegate.create(this,this.waitForLMS),100)};
LmsController.prototype.searchMasteryScore=function(){this.mastery_score=this.saver.searchMasteryScore()};LmsController.prototype.enableCommit=function(pDisable){this.commitEnabled=pDisable};
LmsController.prototype.saveAndWait=function(){if(!this.scope.waitForCommit&&this.lmsActivated){this.enableCommit(false);this.forceCompleted();if(this.scope.$parent.completionMode==="completeIfFailed"){this.saveProgression();this.saveSuccess()}else if(this.scope.$parent.completionMode==="incompleteIfFailed"){this.saveSuccess();this.saveProgression()}this.scope.waitForCommit=true;this.commitAndWait()}};
LmsController.prototype.commitAndWait=function(){if(window.parent.SYFADIS_API_OBJECT==null){this.saver.tracker.doLMSCommit();this.commitCallback()}else if(this.saver.tracker.isCommitAvaiable()){this.saver.tracker.doLMSCommit();if(!this.scope.waitForCommit)this.commitCallback()}else{var parent=this;this.commitTimeout=setTimeout(function(){parent.commitAndWait()},1E3)}};LmsController.prototype.commitCallback=function(){this.enableCommit(true);this.scope.waitForCommit=false;this.scope.$apply()};
LmsController.prototype.forceCompleted=function(){if(this.lmsActivated&&this.tracker.LMSIsInitialized())this.saver.forceCompleted()};LmsController.prototype.saveProgression=function(){if(this.lmsActivated&&this.tracker.LMSIsInitialized()){this.saver.saveProgression();if(!this.saver.fullSuspendDataSupport())this.saveBackupToLocalStorage()}};LmsController.prototype.saveSuccess=function(){if(this.lmsActivated&&this.tracker.LMSIsInitialized())this.saver.saveSuccess()};
LmsController.prototype.doLMSFinish=function(){if(this.lmsActivated&&this.tracker.LMSIsInitialized())this.tracker.doLMSFinish()};LmsController.prototype.retrieveProgression=function(){if(this.lmsActivated&&this.tracker.LMSIsInitialized()){this.saver.retrieveProgression();if(!this.saver.fullSuspendDataSupport())this.getBackupFromLocalStorage()}};
LmsController.prototype.saveBackupToLocalStorage=function(){var node=this.scope.actController.getContentsNode();for(var i=0;i<node.length;i++){var content=node[i];if(content.backup!=null)localStorage.setItem(content["@attributes"].id,JSON.stringify(content.backup))}};
LmsController.prototype.getBackupFromLocalStorage=function(){var node=this.scope.actController.getContentsNode();for(var i=0;i<node.length;i++){var content=node[i];var contentBackup=JSON.parse(localStorage.getItem(content["@attributes"].id));if(contentBackup!=null)content.backup=contentBackup}};LmsController.prototype.setInteraction=function(pInteractionObject){if(this.lmsActivated&&this.tracker.LMSIsInitialized())this.saver.setInteraction(pInteractionObject)};
LmsController.prototype.handleError=function(){if(this.tracker.errorState&&this.tracker.doLMSGetErrorString(this.tracker.doLMSGetLastError())!="No error"){var error=this.scope.getLocalisedString("message_lms_error_"+this.tracker.currentErrorCode);if(this.tracker.currentErrorCode==3)this.scope.$apply();else{this.scope.pushNotification(error,"modal");this.scope.$apply()}if(this.tracker.LMSIsInitialized())console.log(error+" - "+this.tracker.doLMSGetErrorString(this.tracker.doLMSGetLastError()));else console.log(error);
this.tracker.errorState=false;return true}else{this.tracker.errorState=false;this.scope.closeNotification();this.scope.$apply()}return false};goog.provide("solunea.meta.controlers.NavController");solunea.meta.controlers.NavController=function(pScope){this.scope=pScope};var NavController=solunea.meta.controlers.NavController;
NavController.prototype.displayContent=function(pContentID,noAnim,pDirection){this.scope.stopCurrentAudio();var parent=this;this.scope.currentContentID=parseInt(pContentID);var content=this.getContentByID(pContentID);content.seen=true;var contentChanged=false;if(noAnim)this.scope.changeContentURL(content.rlc.filename["@content"]);else{$(".wrapper").removeClass("content_anim_in").removeClass("next").removeClass("prev");$(".wrapper").addClass("content_anim_out");if(pDirection=="next")$(".wrapper").addClass("next");
else if(pDirection=="prev")$(".wrapper").addClass("prev");setTimeout(function(){parent.scope.showLoading=true;parent.scope.changeContentURL(content.rlc.filename["@content"]);parent.scope.$apply()},500)}};NavController.prototype.getContentByID=function(pContentID){var node=this.scope.actController.getContentsNode();for(var i=0;i<node.length;i++)if(parseInt(node[i]["@attributes"].id)==parseInt(pContentID))return node[i];return-1};
NavController.prototype.nextContent=function(){var currentContentPosition=this.getCurrentContentPosition();var nextContent=this.scope.actJson.act.contentsTree.node[currentContentPosition+1];this.scope.showNext=false;if(nextContent!=null)this.displayContent(nextContent["@attributes"].contentid,false,"next")};
NavController.prototype.previousContent=function(){var currentContentPosition=this.getCurrentContentPosition();var prevContent=this.scope.actJson.act.contentsTree.node[currentContentPosition-1];if(prevContent!=null)this.displayContent(prevContent["@attributes"].contentid,false,"prev")};
NavController.prototype.onContentChanged=function(){this.scope.showLoading=false;$(".wrapper").removeClass("content_anim_out");$(".wrapper").addClass("content_anim_in");var currentContentPosition=this.getCurrentContentPosition();this.scope.showPrev=true;this.scope.showNext=true;if(currentContentPosition==0)this.scope.showPrev=false;if(this.scope.navController.isContentLastContent(currentContentPosition))this.scope.showNext=false;var currentContent=this.getContentByID(this.scope.currentContentID);
if(currentContent["@attributes"].type==="bilan"|this.scope.navController.isContentLastContent(currentContentPosition)){if(this.scope.lmsController.isProgressionRetrieval===true)this.scope.lmsController.isProgressionRetrieval=false;else if(this.scope.$parent.scorm===true)$("#sendingDataToLMSModal").modal("show");this.scope.lmsController.saveAndWait()}else{this.scope.lmsController.saveProgression();this.scope.lmsController.isProgressionRetrieval=false}this.scope.refreshProgress()};
NavController.prototype.isContentLastContent=function(content){return content>=this.scope.actJson.act.contentsTree.node.length-1};NavController.prototype.getCurrentContentPosition=function(){var currentContentPosition=0;if(typeof this.scope.actJson!="undefined"){var node=this.scope.actJson.act.contentsTree.node;for(var i=0;i<node.length;i++)if(parseInt(node[i]["@attributes"].contentid)==this.scope.currentContentID){currentContentPosition=i;break}}return currentContentPosition};
NavController.prototype.getCurrentContentID=function(){var currentContentPosition=this.getCurrentContentPosition();var currentContent=this.scope.actJson.act.contentsTree.node[currentContentPosition];var currentContentID=currentContent["@attributes"].contentid;return currentContentID};
NavController.prototype.getQuizStartID=function(){var quizStartID=0;var node=this.scope.actJson.act.contentsTree.node;for(var i=0;i<node.length;i++){var content=this.getContentByID(node[i]["@attributes"].contentid);if(content["@attributes"].type=="quiz"){quizStartID=content["@attributes"].id;break}if(quizStartID<this.firstRandomScreen)quizStartID=this.firstRandomScreen}return quizStartID};
NavController.prototype.getThemes=function(){var themes=[];var node=this.scope.actController.getContentsNodeInTree();for(var i=0;i<node.length;i++){var content=node[i];if(content["@attributes"].type=="quiz"&&content.backup!=null){var currentTheme=content["@attributes"].theme;var alreadyExists=false;for(var j=0;j<themes.length;j++)if(themes[j].id==currentTheme){alreadyExists=true;themes[j].score+=content.score;themes[j].scoremax+=content.scoremax;themes[j].time+=content.backup.time}if(!alreadyExists){var theme=
{};theme.score=content.score;theme.scoremax=content.scoremax;theme.time=content.backup.time;theme.id=currentTheme;themes.push(theme)}}}return themes};NavController.prototype.getQuiz=function(){var quiz=[];var node=this.scope.actController.getContentsNode();for(var i=0;i<node.length;i++){var content=node[i];if(content["@attributes"].type=="quiz")quiz.push(content)}return quiz};NavController.prototype.getPrevious=function(){return this.previousScore};
NavController.prototype.getProgression=function(){var seen=0;var total=0;var contentsTree=this.scope.actJson.act.contentsTree.node;var contents=this.scope.actController.getContentsNode();for(var i=0;i<contentsTree.length;i++){var obj1=contentsTree[i];var contentItem=null;for(var j=0;j<contents.length;j++){var obj=contents[j];if(obj1["@attributes"].contentid==obj["@attributes"].id)contentItem=obj}if(contentItem!=null)if(contentItem.seen)seen++;total++}return seen*100/total};goog.provide("solunea.meta.controlers.ActController");solunea.meta.controlers.ActController=function(pScope){var parent=this;this.scope=pScope;$.ajax({url:pScope.act,dataType:"xml",success:function(data){var json=parent.xmlToJson(data);pScope.actJson=json;pScope.onActInited();pScope.checkIfAContentIsDisplayed()}})};var ActController=solunea.meta.controlers.ActController;
ActController.prototype.loadManifest=function(){if(this.scope.scorm){var parent=this;$.ajax({url:"imsmanifest.xml",dataType:"xml",success:function(data){var json=parent.xmlToJson(data);parent.scope.manifestJson=json;parent.scope.onManifestLoaded()}})}else this.scope.onManifestLoaded()};
ActController.prototype.getMenuItemsNode=function(){var retArray=[];try{if(this.scope.actJson!=null)if(this.scope.actJson.act.menus.menu.item.length!=null){var ar=this.scope.actJson.act.menus.menu.item;angular.forEach(ar,function(item,key){retArray.push(item)})}else{var ar=this.scope.actJson.act.menus.menu.item;retArray.push(ar)}}catch(e){}return retArray};
ActController.prototype.getResourcesNode=function(){var retArray=[];if(this.scope.actJson!=null&&this.scope.actJson.act.resources.resource!=null){if(this.scope.actJson.act.resources.resource.length!=null)var ar=this.scope.actJson.act.resources.resource;else var ar=this.scope.actJson.act.resources;angular.forEach(ar,function(item,key){retArray.push(item)})}return retArray};
ActController.prototype.getContentsNodeInTree=function(){var retArray=[];var contentsTree=this.scope.actJson.act.contentsTree.node;var contents=this.getContentsNode();for(var i=0;i<contentsTree.length;i++){var obj1=contentsTree[i];var contentItem=null;for(var j=0;j<contents.length;j++){var obj=contents[j];if(obj1["@attributes"].contentid==obj["@attributes"].id)contentItem=obj}if(contentItem!=null)retArray.push(contentItem)}return retArray};
ActController.prototype.getContentsNode=function(){var retArray=[];if(this.scope.actJson!=null){if(this.scope.actJson.act.contents.content.length!=null)var ar=this.scope.actJson.act.contents.content;else var ar=this.scope.actJson.act.contents;angular.forEach(ar,function(item,key){retArray.push(item)})}return retArray};
ActController.prototype.getContentsTreeNode=function(){var retArray=[];if(this.scope.actJson!=null)if(this.scope.actJson.act.contents.content.length!=null){var ar=this.scope.actJson.act.contentsTree.node;angular.forEach(ar,function(item,key){retArray.push(item)})}else{var ar=this.scope.actJson.act.contentsTree.node;retArray.push(ar)}return retArray};
ActController.prototype.getProperty=function(pName){for(var i=0;i<this.scope.actJson.act.properties.data.length;i++)if(this.scope.actJson.act.properties.data[i].property["@content"]==pName)return this.scope.actJson.act.properties.data[i].value["@content"];return-1};
ActController.prototype.xmlToJson=function(oXMLNode){var vResult=true;if(oXMLNode.attributes&&oXMLNode.attributes.length>0){var iAttrib;vResult={};vResult["@attributes"]={};for(var iAttrId=0;iAttrId<oXMLNode.attributes.length;iAttrId++){iAttrib=oXMLNode.attributes.item(iAttrId);vResult["@attributes"][iAttrib.nodeName]=iAttrib.nodeValue}}if(oXMLNode.hasChildNodes()){var iKey,iValue,iXMLChild;if(vResult===true)vResult={};for(var iChild=0;iChild<oXMLNode.childNodes.length;iChild++){iXMLChild=oXMLNode.childNodes.item(iChild);
if((iXMLChild.nodeType&7)===1){iKey=iXMLChild.nodeName;iValue=this.xmlToJson(iXMLChild);if(vResult.hasOwnProperty(iKey)){if(vResult[iKey].constructor!==Array)vResult[iKey]=[vResult[iKey]];vResult[iKey].push(iValue)}else vResult[iKey]=iValue}else if((iXMLChild.nodeType-1|1)===3){iKey="@content";iValue=iXMLChild.nodeType===3?iXMLChild.nodeValue.replace(/^\s+|\s+$/g,""):iXMLChild.nodeValue;if(vResult.hasOwnProperty(iKey))vResult[iKey]+=iValue;else if(iXMLChild.nodeType===4||iValue!=="")vResult[iKey]=
iValue}}}return vResult};
ActController.prototype.randomize=function(pNb){this.randomized=[];this.pool=[];var node=this.getContentsNode();for(var i=0;i<node.length;i++){var content=node[i];if(content["@attributes"].randomPool=="true")this.pool.push(content)}shuffleAr(this.pool);for(var i=this.pool.length-1;i>=0;i--){var obj=this.pool[i];if(obj["@attributes"].mandatory=="true"&&this.randomized.length<pNb)this.randomized.push(this.pool.splice(i,1)[0])}while(this.randomized.length<pNb&&this.pool.length>0)this.randomized.push(this.pool.splice(Math.floor(Math.random()*
this.pool.length),1)[0]);shuffleAr(this.randomized);var randomFilename=this.scope.navController.getContentByID(this.scope.currentContentID).rlc.filename["@content"];var contents=this.getContentsNode();var randomContentID=0;for(var i=0;i<contents.length;i++){var obj=contents[i];if(obj.rlc.filename["@content"]==randomFilename)randomContentID=obj["@attributes"].id}var contentsTree=this.getContentsTreeNode();var position=0;for(var i=0;i<contentsTree.length;i++){var obj1=contentsTree[i];if(obj1["@attributes"].contentid==
randomContentID)position=i}this.injectContents(position+1,this.randomized)};
ActController.prototype.randomizeThemes=function(pThemes){this.randomized=[];this.pool=[];var node=this.getContentsNode();for(var i=0;i<node.length;i++){var content=node[i];if(content["@attributes"].randomPool=="true")this.pool.push(content)}shuffleAr(this.pool);for(var i=0;i<pThemes.length;i++){var theme=pThemes[i];theme.currentNb=0;theme.themePool=[];for(var j=this.pool.length-1;j>=0;j--){var content=this.pool[j];if(content["@attributes"].theme==theme.id){theme.themePool.push(content);if(content["@attributes"].mandatory==
"true"&&theme.currentNb<theme.nbRandom){this.randomized.push(this.pool.splice(j,1)[0]);theme.currentNb++}}}}for(var i=0;i<pThemes.length;i++){var theme=pThemes[i];while(theme.currentNb<theme.nbRandom&&theme.themePool.length>0){this.randomized.push(theme.themePool.splice(Math.floor(Math.random()*theme.themePool.length),1)[0]);theme.currentNb++}}shuffleAr(this.randomized);var randomFilename=this.scope.navController.getContentByID(this.scope.currentContentID).rlc.filename["@content"];var contents=this.getContentsNode();
var randomContentID=0;for(var i=0;i<contents.length;i++){var obj=contents[i];if(obj.rlc.filename["@content"]==randomFilename)randomContentID=obj["@attributes"].id}var contentsTree=this.getContentsTreeNode();var position=0;for(var i=0;i<contentsTree.length;i++){var obj1=contentsTree[i];if(obj1["@attributes"].contentid==randomContentID)position=i}this.injectContents(position+1,this.randomized)};
ActController.prototype.clearRandomContents=function(){var contentsTree=this.scope.actJson.act.contentsTree.node;var contents=this.getContentsNode();for(var i=contentsTree.length-1;i>=0;i--){var obj1=contentsTree[i];var contentItem=null;for(var j=0;j<contents.length;j++){var obj=contents[j];if(obj1["@attributes"].contentid==obj["@attributes"].id)contentItem=obj}if(contentItem!=null)if(contentItem["@attributes"].randomPool=="true")contentsTree.splice(i,1)}this.randomized=null};
ActController.prototype.isRandomized=function(pGlobal){var randomized=false;var contentsTree=this.scope.actJson.act.contentsTree.node;var parent=this;if(pGlobal)var lastIndexToSearch=0;else{var lastIndexToSearch=-1;for(var i=0;i<contentsTree.length;++i)if(contentsTree[i]["@attributes"].contentid==parent.scope.currentContentID){lastIndexToSearch=i;break}}var contents=this.getContentsNode();for(var i=contentsTree.length-1;i>lastIndexToSearch;i--){var obj1=contentsTree[i];var contentItem=null;for(var j=
0;j<contents.length;j++){var obj=contents[j];if(obj1["@attributes"].contentid==obj["@attributes"].id)contentItem=obj}if(contentItem!=null)if(contentItem["@attributes"].randomPool=="true")randomized=true}return randomized};
ActController.prototype.injectContents=function(pPosition,pContents){for(var i=pContents.length-1;i>=0;i--){var obj=pContents[i];var contentsTree=this.scope.actJson.act.contentsTree.node;var newContentID=obj["@attributes"].id;for(var j=contentsTree.length-1;j>0;j--){var obj1=contentsTree[j];if(obj1["@attributes"].contentid==obj["@attributes"].id)newContentID=this.copyContent(obj["@attributes"].id)}var contentTreeObj={};contentTreeObj["@attributes"]={};contentTreeObj["@attributes"].contentid=newContentID;
this.scope.actJson.act.contentsTree.node.splice(pPosition,0,contentTreeObj)}};
ActController.prototype.replaceContents=function(pContents){this.scope.actJson.act.contentsTree.node=[];for(var i=0;i<pContents.length;i++){var newContentID=pContents[i];for(var j=this.scope.actJson.act.contentsTree.length-1;j>0;j--){var obj1=this.scope.actJson.act.contentsTree[j];if(obj1["@attributes"].contentid==pContents[i])newContentID=this.copyContent(pContents[i])}var contentTreeObj={};contentTreeObj["@attributes"]={};contentTreeObj["@attributes"].contentid=newContentID;this.scope.actJson.act.contentsTree.node.push(contentTreeObj)}};
ActController.prototype.copyContent=function(pContentID,pForceNewID){var content=this.scope.navController.getContentByID(pContentID);var copiedContent=JSON.parse(JSON.stringify(content));if(pForceNewID!=null)copiedContent["@attributes"].id=pForceNewID;else copiedContent["@attributes"].id=this.scope.actJson.act.contents.content.length+1;copiedContent.seen=false;copiedContent.copiedFrom=pContentID;this.scope.actJson.act.contents.content.push(copiedContent);return copiedContent["@attributes"].id};
ActController.prototype.normalizeActNodes=function(){var contentsTree=this.scope.actJson.act.contentsTree.node;if(!(contentsTree instanceof Array)){var x=[];$.each(contentsTree,function(i,n){var toto={};toto[i]=n;x.push(toto)});this.scope.actJson.act.contentsTree.node=x}};function shuffleAr(a){var j,x,i;for(i=a.length;i;i--){j=Math.floor(Math.random()*i);x=a[i-1];a[i-1]=a[j];a[j]=x}}
function searchIndex(pContentToSearch,pArray){var index=-1;for(var i=0;i<pArray.length;++i)if(pArray[i].name==pContentToSearch){index=i;break}};goog.provide("solunea.meta.core.appRun");var app=angular.module("cannelle_app",["ngSanitize"]);app.run(function($rootScope,$window){for(var param in $window.params)$rootScope[param]=$window.params[param]});goog.provide("solunea.meta.controlers.appController");
app.controller("cannelle_appCtrl",["$scope","$sce","$timeout","$window","$filter","$http",function($scope,$sce,$timeout,$window,$filter,$http,$rootScope){$scope.init=function(){$scope.childScope=null;$scope.setLocalisation();$scope.setCustomSettings();$scope.manageSafariBrowser();$scope.total_time=0;$scope.navController=new NavController($scope);$scope.lmsController=new LmsController($scope);$scope.actController=new ActController($scope);$scope.initializeColors();$scope.manageRightToLeftLocales($("body"));
$scope.alreadySeenPages=[];$scope.resize();$scope.setLogo();$("#meta").removeClass("waitUntilOpening");$scope.initializeAudio()};$scope.isIE11=function(){return!!window.MSInputMethodContext&&!!document.documentMode};$scope.initializeAudio=function(){try{if($scope.isIE11())$("#audio-player").hide();else $scope.audioPlayer=new AudioPlayer("#audio-player")}catch(e){console.error("Une erreur est survenue pendant l'initialisation de l'audio.");console.error(e)}};$scope.manageSafariBrowser=function(){if(navigator.userAgent.indexOf("Safari")!=
-1&&navigator.userAgent.indexOf("Chrome")==-1)$("body").addClass("safari")};$scope.setCustomSettings=function(){if(typeof $window["customSettings"]!=undefined)$scope.customSettings=$window["customSettings"];else $scope.setCustomSettingsWithoutFile()};$scope.refreshMathContent=function(){if(MathJax.hasOwnProperty("typeset"))MathJax.typeset()};$scope.setLocalisation=function(){$scope.localisation=$window["localisation_"+$scope.lang];if($scope.localisation==null)throw new Error("Localisation '"+$scope.lang+
"' does not exists.");document.documentElement.setAttribute("lang",$scope.lang);$scope.setLangForThaleiaPublicationOVerlay()};$scope.setLangForThaleiaPublicationOVerlay=function(){try{if(window.frameElement!==null)window.frameElement.parentElement.parentElement.parentElement.setAttribute("lang",$scope.lang)}catch(e){}};$scope.setLocationForContent=function(elem){$scope.getChildScope().selectedLocalisation=!$scope.getChildScope().standalone?$scope.lang:"fr";var contentWindow=document.getElementById("content_displayer").contentWindow,
localisation="localisation_"+$scope.getChildScope().selectedLocalisation,contentLocalisation=contentWindow[localisation];$scope.getChildScope().localisation=contentLocalisation;if($scope.getChildScope().localisation==null)throw new Error("Localisation '"+$scope.getChildScope().selectedLocalisation+"' does not exists.");elem.documentElement.setAttribute("lang",$scope.lang)};$scope.manageRightToLeftLocales=function(elem){if($scope.isRightToLeftLanguage())elem.addClass("rtl")};$scope.manageContrastedColors=
function(elem){$scope.contrastedColors?elem.addClass("accessibility"):elem.removeClass("accessibility")};$scope.isRightToLeftLanguage=function(){var rtlLocales=["ar","he"];return rtlLocales.includes($scope.lang)};$scope.getCurrentContentTitle=function(){try{return $scope.navController.getContentByID($scope.navController.getCurrentContentID()).title["@content"]}catch(e){return"iframe_content"}};$scope.setPublicationTitleOnHtmlTitle=function(){document.title=$scope.title};$scope.reactivateActionButtons=
function(buttons){buttons.forEach(function(button){$(button).removeClass("hidden-btn")})};$scope.showFeedbackImage=function(){try{var show=true;if($scope.getChildScope().feedbackFinal.feedbackImage=="")show=false;if($scope.getChildScope().feedbackFinal.feedbackImage=="x_illus2_x.jpg")show=false;return show}catch(e){return false}};$scope.displayFeedbackButton=function(){try{var displayButton;var feedbackImage=$scope.showFeedbackImage();var feedbackText=$scope.getChildScope().feedbackFinal.feedbackText!=
"";var showButton=$scope.showButton("feedback");displayButton=showButton&&feedbackImage|feedbackText;return displayButton}catch(e){return false}};$scope.getResourceType=function(raw){var type;var resource=raw["filename"]["@content"];if(resource.startsWith("https://")|resource.startsWith("http://"))type="url";else type="file";return type};$scope.getResourceSliced=function(resource){var data;var regex=/(.*)\((.*)\)/gm;var m;while((m=regex.exec(resource))!==null){if(m.index===regex.lastIndex)regex.lastIndex++;
data={title:m[1],size:m[2]}}return data};$scope.showScore=function(){var show=false;if(typeof $scope.getChildScope()!="undefined")if($scope.getChildScope().scoring!=="0"){if($scope.getChildScope().success)show=true;if($scope.getChildScope().tries>=$scope.getChildScope().nbtries)show=true}return show};$scope.showPopTimer=function(){var show=false;var parsedToIntTimer=parseInt($scope.getChildScope().timerPourEcran,10);var isInt=Number.isInteger(parsedToIntTimer);var isPositive=parsedToIntTimer>0;if(isInt&&
isPositive)if(!$scope.getChildScope().alreadyDone)if($scope.getChildScope().hidepop!=true)show=true;if(show){$("#pop").modal("show");setTimeout(function(){$("#pop-timer-btn").focus()},250);$scope.manageTabularNavigationOnActionButtons(false)}else{$("#pop").modal("hide");$scope.manageTabularNavigationOnActionButtons(true)}};$scope.isImage=function(filename){try{var imgExtensions=["bmp","fpx","gif","j2c","j2k","jfif","jif","jp2","jpeg","jpg","jpx","pcd","png","svg","tif","tiff","webp"],fileExtension=
filename.split(".").pop();return imgExtensions.includes(fileExtension)}catch(e){return false}};$scope.closePopTimerModal=function(){$("#pop").modal("hide");if($scope.audioPlayer!=null)if($scope.audioPlayer.getTrack()!=null)$scope.audioPlayer.play();$scope.manageTabularNavigationOnActionButtons(true);if($scope.getChildScope().hasOwnProperty("removeTimer"))$scope.getChildScope().removeTimer()};$scope.timerInterval=setInterval(function(){if(typeof $scope.getChildScope()!="undefined")if($scope.getChildScope().oK===
true)if($scope.getChildScope().timerQuireste>0)$scope.getChildScope().timerQuireste--;if(document.getElementById("leTimer")!=null)if($scope.getChildScope().timerQuireste<=10)if($scope.getChildScope().timerQuireste%2===0)$("#leTimer").addClass("blink");else $("#leTimer").removeClass("blink");if(typeof $scope.getChildScope()!="undefined")$("#leTimer").text($scope.getChildScope().timerQuireste)},1E3);$scope.manageTabularNavigationOnActionButtons=function(activateTabularNavigation){var actionButtons=
$('#action-buttons button[id^="btn-"]');$.each(actionButtons,function(index,element){activateTabularNavigation?$(this).removeAttr("tabindex"):$(this).attr("tabindex","-1")})};$scope.getCurrentContentName=function(){try{var content;var str=$scope.frame.src;var regex=/\/content\/(.*)_html/gm;var m;if((m=regex.exec(str))!==null)content=m[1].toLowerCase();return content.replace("content/","")}catch(e){return""}};$scope.getConsigneLabel=function(){var consigne;if($scope.accessibleMode||$scope.isMobileDevice()){var content;
var label;content=$scope.getCurrentContentName();label="label_consigne_"+content+"_fallback";consigne=$scope.getLocalisedString(label)}else if(typeof $scope.getChildScope()!="undefined")consigne=$scope.getChildScope().consigne;return consigne};$scope.getIconForPopTimerModal=function(){var tmp=$scope.getCurrentContentName();return tmp!=""?tmp:"activity"};$scope.getFeedback=function(){try{return $sce.trustAsHtml($scope.getChildScope().feedbackFinal.feedbackText)}catch(e){return false}};$scope.checkIfAContentIsDisplayed=
function(){if(typeof $scope.frameURL=="undefined"){var startContentID=$scope.actJson.act.navigation.mainContent["@attributes"].contentid;$scope.navController.displayContent(startContentID,true)}};$scope.setCustomSettingsWithoutFile=function(){$scope.customSettings={forcedNavigation:0,showInstructionsInTheFirstDisplayOfEachActivityScreen:false,contents:{classification:{itemsImgDisplayStyle:"rectangle"}}}};$scope.showButton=function(button){try{return document.getElementById("content_displayer").contentWindow.angular.element("body").scope().$$childHead.showButton(button)}catch(error){}};
$scope.allTriesUsed=function(){var displayBtn=false;if(typeof $scope.getChildScope().tries!="undefined"&&typeof $scope.getChildScope().nbtries!="undefined")displayBtn=$scope.getChildScope().tries<$scope.getChildScope().nbtries;return displayBtn};$scope.setLogo=function(){var raw=getComputedStyle(document.documentElement).getPropertyValue("--logo");var filename=raw.replace(/["']/g,"");var filename=filename.trim();var path="engine/img/"+filename;$("#logo-sommaire").attr("src",path);$("#logo-navbar").attr("src",
path)};$scope.initializeColors=function(){if($scope.contrastedColors)$("body").addClass("accessibility");else $("body").removeClass("accessibility")};$scope.enableAccessibleMode=function(){$scope.accessibleMode=!$scope.accessibleMode;$("#switchAccessibilityBtn").attr("title",$scope.getAccessibleButtonLabel()).tooltip("_fixTitle").tooltip("show");if($scope.frame.contentWindow.angular.element("#container").scope().tries!=null)$scope.frame.contentWindow.angular.element("#container").scope().showAccessVersion()};
$scope.loadContrastedColors=function(){if($scope.contrastedColors){$scope.contrastedColors=false;$("#meta").removeClass("rgaa")}else{$scope.contrastedColors=true;$("#meta").addClass("rgaa")}$("#switchContrastedColorsBtn").attr("title",$scope.getContrastedColorsButtonLabel()).tooltip("_fixTitle").tooltip("show");$("#content_displayer").get(0).contentDocument.location.reload()};$scope.onActInited=function(){$scope.actController.normalizeActNodes();$scope.title=$scope.actController.getProperty("_H1");
$scope.actController.loadManifest();$scope.setPublicationTitleOnHtmlTitle();$scope.$apply()};$scope.onManifestLoaded=function(){$scope.session_time=0;$scope.lmsController.init($scope.scorm,$scope.scorm_version);$scope.$apply()};$scope.onLMSInited=function(){$scope.lmsController.retrieveProgression();if($scope.locationToRetrieve!=null)var startContentID=$scope.locationToRetrieve;else var startContentID=$scope.actJson.act.navigation.mainContent["@attributes"].contentid;if($scope.haveSound){$scope.startContent=
startContentID;$("#modalSono").modal({show:true});$("#modalSono").on("shown",function(){$("#soundButton").focus()})}else $scope.navController.displayContent(startContentID,true)};$scope.changeContentURL=function(pURL){$(".loader-container").show();$scope.frameURL=$sce.trustAsResourceUrl(pURL)};$scope.iframeLoadedCallBack=function(pFrame){$(".loader-container").hide();$scope.timerPaused=false;$scope.navController.onContentChanged();$scope.frame=pFrame[0];$scope.frame.contentWindow.setTracker(this);
$scope.currentContentParams=$scope.frame.contentWindow.params;$scope.playIntroSound();$scope.$apply()};$scope.playIntroSound=function(){try{if($scope.currentContentParams!=null&&$scope.currentContentParams.sound!=null&&$scope.currentContentParams.sound!==""){var url=$sce.getTrustedResourceUrl($scope.frameURL);url=url.split("/");var path="";for(i=0;i<url.length-1;i++){path+="/";path+=url[i]}var track="."+path+"/"+$scope.currentContentParams.sound;if($scope.isIE11()){$("#navbar").append('<audio controls id="audioPlayerForIE11"></audio>');
var audio=$("#audioPlayerForIE11").get(0);audio.src="."+path+"/"+$scope.currentContentParams.sound;audio.play()}else{$scope.audioPlayer.setTrack(track);if($scope.currentContentParams.timerPourEcran!==0)$scope.audioPlayer.play()}}}catch(e){console.error("Une erreur est survenue pendant la lecture de l'audio d'un \u00e9cran.");console.error(e)}};$scope.stopCurrentAudio=function(){try{if($scope.isIE11())$("#audioPlayerForIE11").remove();if(!$scope.isIE11())if($scope.audioPlayer.getTrack()!=null)$scope.audioPlayer.deleteCurrentTrack()}catch(e){console.error("Une erreur est survenue pendant l'arr\u00eat de l'audio d'un \u00e9cran.");
console.error(e)}};$scope.pauseTimer=function(){$scope.timerPaused=true};$scope.startSessionTimer=function(){if(!$scope.timerPaused)$scope.session_time+=100;$timeout($scope.startSessionTimer,100)};$scope.getLocalisedString=function(pID){if($scope.localisation[pID]!=null)return $scope.localisation[pID];else return""};$scope.pushNotification=function(pText,pType,pTimer){$scope.current_notification=pText;$scope.current_notification_type=pType;switch(pType){case "warning":case "error":$("#Events").collapse("show");
break;case "modal":$("#ModalCentered").modal("show");break;default:}if(pTimer!=null&&pTimer!=0)$scope.timeoutPromise=$timeout($scope.closeNotification,pTimer)};$scope.closeNotification=function(){$timeout.cancel($scope.timeoutPromise);$("#Events").collapse("hide");$("#ModalCentered").modal("hide")};$scope.nextContent=function(forceAccessToNextPage){if(forceAccessToNextPage===undefined)switch($scope.customSettings.forcedNavigation){case 1:$scope.manageNextContentUnderCustomNavigation("supervised");
break;case 2:$scope.manageNextContentUnderCustomNavigation("forced");break;default:$scope.goToNextContent()}else $scope.goToNextContent()};$scope.goToNextContent=function(){$scope.addPageToAlreadySeenPages();$scope.removeToastMessages();$(".collapse").collapse();$scope.navController.nextContent()};$scope.manageNextContentUnderCustomNavigation=function(navigationType){if($scope.getChildScope().isAllContentViewed()===true||$scope.pageHasAlreadyBeSeen())$scope.goToNextContent();else $scope.showForcedNavigationMessage(navigationType,
"next")};$scope.pageHasAlreadyBeSeen=function(){return $scope.alreadySeenPages.indexOf($scope.currentContentID)!=-1};$scope.addPageToAlreadySeenPages=function(){if($scope.alreadySeenPages.indexOf($scope.currentContentID)==-1)$scope.alreadySeenPages.push($scope.currentContentID)};$scope.showForcedNavigationMessage=function(navigationType,btn){if(navigationType=="supervised")switch(btn){case "next":$("#supervised-navigation-btn-nextPage").show();$("#supervised-navigation-btn-goToContent").hide();break;
case "goToContent":$("#supervised-navigation-btn-nextPage").hide();$("#supervised-navigation-btn-goToContent").show();break}$("#"+navigationType+"-navigation").toast("show")};$scope.removeToastMessages=function(){$(".toast").toast("hide")};$scope.forcedNavigationBackToPage=function(){$scope.disableNext=false};$scope.previousContent=function(){$scope.removeToastMessages();$scope.navController.previousContent()};$scope.displayContent=function(id){$scope.navController.displayContent(id)};$scope.displayMenu=
function(pContentID){if($scope.canAccessToTargetContent(pContentID)){$scope.addPageToAlreadySeenPages();$(".modal").modal("hide");$scope.navController.displayContent(pContentID)}else switch($scope.customSettings.forcedNavigation){case 1:$scope.showForcedNavigationMessage("supervised","goToContent");$scope.goToPageViaSummary=pContentID;break;case 2:$scope.showForcedNavigationMessage("forced","next");break}};$scope.forceAccessToContent=function(){$scope.addPageToAlreadySeenPages();$(".modal").modal("hide");
$scope.removeToastMessages();$(".collapse").collapse();$scope.navController.displayContent($scope.goToPageViaSummary)};$scope.canAccessToTargetContent=function(pContentID){switch($scope.customSettings.forcedNavigation){case 0:return true;case 1:case 2:return $scope.canAccessToTargetContentUnderSupervisedOrForcedNavigation(pContentID);default:return true}};$scope.canAccessToTargetContentUnderSupervisedOrForcedNavigation=function(pContentID){var canLeaveCurrentPage;var canAccessTargetPage;var alreadySeenTargetPage;
var targetPageIsNextPage;var authorized;canLeaveCurrentPage=$scope.getChildScope().isAllContentViewed()===true||$scope.pageHasAlreadyBeSeen();alreadySeenTargetPage=$scope.alreadySeenPages.includes(pContentID);targetPageIsNextPage=parseInt(pContentID,10)==$scope.currentContentID-1;canAccessTargetPage=alreadySeenTargetPage|targetPageIsNextPage;authorized=canLeaveCurrentPage&&canAccessTargetPage;return authorized};$scope.isAllContentViewedForPage=function(page){return $scope.alreadySeenPages.includes(parseInt(page))?
"watched":" "};$scope.isLinkToPageActivated=function(page){var result="";if($scope.customSettings.forcedNavigation==2&&!$scope.alreadySeenPages.includes(parseInt(page)))result="linkDisabled";return result};$scope.getIconForLinkToPage=function(page){var icon;switch($scope.customSettings.forcedNavigation){case 0:if($scope.alreadySeenPages.includes(parseInt(page["@attributes"].id)))icon="icon-checked";break;case 1:if($scope.alreadySeenPages.includes(parseInt(page["@attributes"].id)))icon="icon-checked";
break;case 2:if($scope.isCurrentPage(page))var icon="icon-checked";else if(!$scope.canAccessToTargetContentUnderForcedNavigation(parseInt(page["@attributes"].id)))var icon="linkDisabled";else if($scope.alreadySeenPages.includes(parseInt(page["@attributes"].id)))var icon="icon-checked";else icon=false;break;default:icon=false}return icon};$scope.isCurrentPage=function(page){return $scope.navController.scope.currentContentID==parseInt(page["@attributes"].id)?"currentPage":""};$scope.lockMeta=function(){$scope.showPrev=
false;$scope.showNext=false};$scope.unlockMeta=function(){$scope.navController.onContentChanged()};$scope.setScore=function(pScore,pScoremax){var currentContent=$scope.navController.getContentByID($scope.currentContentID);currentContent.score=pScore;currentContent.scoremax=pScoremax;$scope.lmsController.saveProgression()};$scope.setCurrentContentState=function(pBackup){var currentContent=$scope.navController.getContentByID($scope.currentContentID);currentContent.backup=pBackup};$scope.setInteraction=
function(pInteractionObject){$scope.lmsController.setInteraction(pInteractionObject)};$scope.getCurrentContentState=function(){var currentContent=$scope.navController.getContentByID($scope.currentContentID);return currentContent.backup};$scope.getThemes=function(){return $scope.navController.getThemes()};$scope.getTotalTime=function(){var totalTime=$scope.total_time+$scope.session_time;return totalTime};$scope.getMasteryScore=function(){this.lmsController.searchMasteryScore();return this.lmsController.mastery_score};
$scope.getPrevious=function(){return $scope.navController.getPrevious()};$scope.getMenu=function(){var menu=[];if($scope.actJson!=null){var node=$scope.actController.getMenuItemsNode();angular.forEach(node,function(menuitem,key){var item=$scope.navController.getContentByID(menuitem["@attributes"].contentId);if(item!=null&&item["@attributes"]!=null&&item["@attributes"].type!="bilan"&&item["@attributes"].type!="quiz")menu.push(menuitem)})}return menu};$scope.getActiveMenu=function(pMenuItem){if(parseInt(pMenuItem["@attributes"].contentId)==
$scope.currentContentID)return"active disabled"};$scope.getResources=function(){return $scope.actController.getResourcesNode()};$scope.isBilanPage=function(){try{if(typeof $scope.getChildScope().isBilanPage!="undefined")return $scope.getChildScope().isBilanPage;else return false}catch(error){return false}};$scope.getMaxAttempts=function(){if($scope.isBilanPage()==true)return $scope.getChildScope().maxAttempts};$scope.restartQuiz=function(){var globalScore={};globalScore.score=0;globalScore.scoremax=
0;var node=$scope.actController.getContentsNode();for(var i=0;i<node.length;i++){var content=node[i];if(content["@attributes"].type=="quiz"){if(!(isNaN(content.score)||isNaN(content.scoremax))){globalScore.score+=content.score;globalScore.scoremax+=content.scoremax}content.backup=null;localStorage.removeItem(content["@attributes"].id)}}globalScore.time=$scope.getTotalTime();$scope.navController.previousScore=globalScore;$scope.clearRandom();var quizStartID=$scope.navController.getQuizStartID();$scope.navController.displayContent(quizStartID)};
$scope.refreshProgress=function(){$scope.progress_percent=$scope.navController.getProgression()};$scope.startRandom=function(pRules){if($scope.navController.firstRandomScreen==null)$scope.navController.firstRandomScreen=this.currentContentID;if(!$scope.actController.isRandomized()){if(pRules.length!=null&&pRules.length>0)$scope.actController.randomizeThemes(pRules);else $scope.actController.randomize(pRules);$scope.navController.onContentChanged()}};$scope.clearRandom=function(){$scope.actController.clearRandomContents()};
$scope.getCurrentFrameSize=function(){var obj={};obj.w=$("#content_displayer").width();obj.h=$("#content_displayer").height();return obj};window.onbeforeunload=function(){$scope.lmsController.doLMSFinish()};$scope.getContentTitle=function(){var title="";if(typeof $scope.getChildScope()!="undefined")if(typeof $scope.getChildScope().exo_title!="undefined")title=$scope.getChildScope().exo_title;else if(typeof $scope.getChildScope().title!="undefined")title=$scope.getChildScope().title;else if(typeof $scope.getChildScope().statement!=
"undefined")title=$scope.getChildScope().statement;return title};$scope.getScope=function(){try{return document.getElementById("content_displayer").contentWindow.angular.element("body").scope()}catch(error){}};$scope.getChildScope=function(){try{return $scope.getScope().$$childHead}catch(error){}};$scope.getContentDirectory=function(){try{var dir=$("#content_displayer")[0].attributes.src.value;var the_arr=dir.split("/");the_arr.pop();return the_arr.join("/")}catch(e){}};$scope.setTitle=function(content){if(typeof content["title"]["@content"]!=
"undefined")$("#page-title").text(content["title"]["@content"]);else $("#page-title").text("")};$scope.showInstructionsInTheFirstDisplayOfThePage=function(){if($scope.customSettings.showInstructionsInTheFirstDisplayOfEachActivityScreen===true)if(!$scope.pageHasAlreadyBeSeen())$scope.displayConsigne()};$scope.displayConsigne=function(){var consigne=$("#consigne"),btnConsigne=$("#btn-consigne");if(consigne.hasClass("show")){consigne.toast("hide");btnConsigne.removeClass("active")}else{consigne.toast("show");
btnConsigne.addClass("active")}$scope.setFocus($("#consigne button"),600)};$scope.getConsigne=function(){return $scope.navController.getConsigne()};$scope.hideNavBar=function(){$("#sidebar").removeClass("active")};$scope.isMobileDevice=function(){var width=$(window).width();var orientation=window.innerHeight>window.innerWidth?"portrait":"landscape";return width<769&&orientation!=="landscape"};$(document).ready(function(){$(".toast").toast({autohide:false});$("#dismiss, .overlay").on("click",function(){$("#sidebar").removeClass("active");
$(".overlay").removeClass("active")});$scope.resize();var $exampleModal=$("#feedbackModal"),$exampleModalClose=$(".btn-close");$exampleModal.on("shown.bs.modal",function(){document.activeElement.blur();$exampleModalClose.focus()})});window.onresize=function(){$scope.resize()};$scope.resize=function(){$(".sticky-md").css("top",$(".bandeau").height()/2+"px");$("#legende").css("bottom",$("#action-buttons").height()+"px")};$scope.setFocus=function(element,delay){setTimeout(function(){$(element).focus()},
delay)};$scope.setFocusWhenContentIsLoaded=function(accessibleElement,baseElement){var elem=$scope.accessibleMode?accessibleElement:baseElement;elem.focus()};$scope.getAriaLabelForItemCorrection=function(correct){if(correct)return $scope.getLocalisedString("accessibility_activity_item_label_correct");else return $scope.getLocalisedString("accessibility_activity_item_label_incorrect")};$scope.hexToRgba=function(hex,opacity){if(hex.length<6){var character=hex.substr(1,1);hex=hex.padEnd(7,character)}var result=
/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return"rgba("+parseInt(result[1],16)+","+parseInt(result[2],16)+","+parseInt(result[3],16)+","+opacity+")"};$scope.gameStarted=function(){if(typeof $scope.getChildScope()!="undefined")return $scope.getChildScope().gameStarted};$scope.correction=function(){if(typeof $scope.getChildScope()!="undefined")return $scope.getChildScope().correction};$scope.success=function(){if(typeof $scope.getChildScope()!="undefined")return $scope.getChildScope().success};
$scope.isCorrectionButtonNeedToBeDisplayed=function(){switch($scope.getChildScope().scoring){case "Par question r\u00e9pondu":if(!$scope.getChildScope().success)return true;break;case "Par choix":if($scope.getChildScope().score!==$scope.getChildScope().scoremax)return true;break;case "aucun":if(!$scope.getChildScope().success)return true;break}return false};$scope.getAccessibleButtonLabel=function(){if($scope.accessibleMode)return $scope.getLocalisedString("aria_rgaa_normal");else return $scope.getLocalisedString("aria_rgaa_accessible")};
$scope.getContrastedColorsButtonLabel=function(){if($scope.contrastedColors)return $scope.getLocalisedString("aria_rgaa_contrast_normal");else return $scope.getLocalisedString("aria_rgaa_contrast")};$scope.init()}]);app.directive("iframeOnload",function(){return function(scope,element,attrs){element.on("load",function(){scope.iframeLoadedCallBack(element)})}});goog.provide("MetaCore");goog.require("solunea.meta.core.appRun");goog.require("solunea.meta.controlers.appController");goog.require("solunea.meta.controlers.ActController");goog.require("solunea.meta.controlers.NavController");goog.require("solunea.meta.controlers.LmsController");MetaCore=function(){this.version="2.0"};
